<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.7"/>
<title>DChat: src/dchat.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">DChat
   &#160;<span id="projectnumber">0.2</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.7 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('dchat_8c.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">dchat.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>This file is the main file for DChat and contains, besides the main function, several core functions.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdint.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;stdarg.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;arpa/inet.h&gt;</code><br />
<code>#include &lt;errno.h&gt;</code><br />
<code>#include &lt;netinet/in.h&gt;</code><br />
<code>#include &lt;pthread.h&gt;</code><br />
<code>#include &lt;readline/readline.h&gt;</code><br />
<code>#include &lt;sys/select.h&gt;</code><br />
<code>#include &lt;sys/socket.h&gt;</code><br />
<code>#include &lt;signal.h&gt;</code><br />
<code>#include &lt;unistd.h&gt;</code><br />
<code>#include &lt;getopt.h&gt;</code><br />
<code>#include &quot;dchat_h/dchat.h&quot;</code><br />
<code>#include &quot;dchat_h/types.h&quot;</code><br />
<code>#include &quot;dchat_h/decoder.h&quot;</code><br />
<code>#include &quot;dchat_h/contact.h&quot;</code><br />
<code>#include &quot;dchat_h/cmdinterpreter.h&quot;</code><br />
<code>#include &quot;dchat_h/network.h&quot;</code><br />
<code>#include &quot;dchat_h/log.h&quot;</code><br />
<code>#include &quot;dchat_h/util.h&quot;</code><br />
<code>#include &quot;dchat_h/option.h&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for dchat.c:</div>
<div class="dyncontent">
<div class="center"><img src="dchat_8c__incl.png" border="0" usemap="#src_2dchat_8c" alt=""/></div>
<map name="src_2dchat_8c" id="src_2dchat_8c">
<area shape="rect" id="node17" href="dchat_8h_source.html" title="dchat_h/dchat.h" alt="" coords="564,80,681,107"/><area shape="rect" id="node18" href="types_8h_source.html" title="types.h" alt="" coords="1663,229,1728,256"/><area shape="rect" id="node20" href="network_8h_source.html" title="network.h" alt="" coords="1055,304,1135,331"/><area shape="rect" id="node21" href="decoder_8h_source.html" title="dchat_h/decoder.h" alt="" coords="1759,155,1891,181"/><area shape="rect" id="node22" href="contact_8h_source.html" title="dchat_h/contact.h" alt="" coords="1915,155,2041,181"/><area shape="rect" id="node23" href="cmdinterpreter_8h_source.html" title="dchat_h/cmdinterpreter.h" alt="" coords="1599,80,1769,107"/><area shape="rect" id="node24" href="option_8h_source.html" title="option.h" alt="" coords="1551,155,1620,181"/><area shape="rect" id="node25" href="log_8h_source.html" title="dchat_h/log.h" alt="" coords="1421,80,1523,107"/><area shape="rect" id="node27" href="util_8h_source.html" title="dchat_h/util.h" alt="" coords="2029,80,2131,107"/></map>
</div>
</div>
<p><a href="dchat_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a3c04138a5bfe5d72780bb7e82a18e627"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a3c04138a5bfe5d72780bb7e82a18e627"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>main</b> (int argc, char **argv)</td></tr>
<tr class="separator:a3c04138a5bfe5d72780bb7e82a18e627"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2933fe4bc8ee9a166f16bfedc289c200"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dchat_8c.html#a2933fe4bc8ee9a166f16bfedc289c200">init_global_config</a> (<a class="el" href="structdchat__conf.html">dchat_conf_t</a> *<a class="el" href="dchat_8c.html#a5497dfcbcfecec06aaf63df011c70f83">cnf</a>)</td></tr>
<tr class="memdesc:a2933fe4bc8ee9a166f16bfedc289c200"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes basic fields of the global dchat configuration.  <a href="#a2933fe4bc8ee9a166f16bfedc289c200">More...</a><br /></td></tr>
<tr class="separator:a2933fe4bc8ee9a166f16bfedc289c200"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2e6eac0d08a08fc6a415f2b341f54719"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dchat_8c.html#a2e6eac0d08a08fc6a415f2b341f54719">init_listening</a> (<a class="el" href="structdchat__conf.html">dchat_conf_t</a> *<a class="el" href="dchat_8c.html#a5497dfcbcfecec06aaf63df011c70f83">cnf</a>, char *address)</td></tr>
<tr class="memdesc:a2e6eac0d08a08fc6a415f2b341f54719"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes the listening socket.  <a href="#a2e6eac0d08a08fc6a415f2b341f54719">More...</a><br /></td></tr>
<tr class="separator:a2e6eac0d08a08fc6a415f2b341f54719"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a583f39d55fad939e8a234407340e92ca"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dchat_8c.html#a583f39d55fad939e8a234407340e92ca">init_threads</a> (<a class="el" href="structdchat__conf.html">dchat_conf_t</a> *<a class="el" href="dchat_8c.html#a5497dfcbcfecec06aaf63df011c70f83">cnf</a>)</td></tr>
<tr class="memdesc:a583f39d55fad939e8a234407340e92ca"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes neccessary internal ressources like threads and pipes.  <a href="#a583f39d55fad939e8a234407340e92ca">More...</a><br /></td></tr>
<tr class="separator:a583f39d55fad939e8a234407340e92ca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a103bc702ed34e7ba88e166b169cfe464"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dchat_8c.html#a103bc702ed34e7ba88e166b169cfe464">destroy</a> (<a class="el" href="structdchat__conf.html">dchat_conf_t</a> *<a class="el" href="dchat_8c.html#a5497dfcbcfecec06aaf63df011c70f83">cnf</a>)</td></tr>
<tr class="memdesc:a103bc702ed34e7ba88e166b169cfe464"><td class="mdescLeft">&#160;</td><td class="mdescRight">Frees all global config resources used.  <a href="#a103bc702ed34e7ba88e166b169cfe464">More...</a><br /></td></tr>
<tr class="separator:a103bc702ed34e7ba88e166b169cfe464"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7fbc5e4f614e5e82b3a1fc5224f1855a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dchat_8c.html#a7fbc5e4f614e5e82b3a1fc5224f1855a">terminate</a> (int sig)</td></tr>
<tr class="memdesc:a7fbc5e4f614e5e82b3a1fc5224f1855a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Signal handler function used for termination.  <a href="#a7fbc5e4f614e5e82b3a1fc5224f1855a">More...</a><br /></td></tr>
<tr class="separator:a7fbc5e4f614e5e82b3a1fc5224f1855a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af26d1f15348f568261ddb15d886dbaff"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dchat_8c.html#af26d1f15348f568261ddb15d886dbaff">handle_local_input</a> (<a class="el" href="structdchat__conf.html">dchat_conf_t</a> *<a class="el" href="dchat_8c.html#a5497dfcbcfecec06aaf63df011c70f83">cnf</a>, char *line)</td></tr>
<tr class="memdesc:af26d1f15348f568261ddb15d886dbaff"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles local user input.  <a href="#af26d1f15348f568261ddb15d886dbaff">More...</a><br /></td></tr>
<tr class="separator:af26d1f15348f568261ddb15d886dbaff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2cbf2aad21d016dd4852369423d86270"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dchat_8c.html#a2cbf2aad21d016dd4852369423d86270">handle_remote_input</a> (<a class="el" href="structdchat__conf.html">dchat_conf_t</a> *<a class="el" href="dchat_8c.html#a5497dfcbcfecec06aaf63df011c70f83">cnf</a>, int n)</td></tr>
<tr class="memdesc:a2cbf2aad21d016dd4852369423d86270"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles PDUs received from a remote client.  <a href="#a2cbf2aad21d016dd4852369423d86270">More...</a><br /></td></tr>
<tr class="separator:a2cbf2aad21d016dd4852369423d86270"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae2c246a2244b6435d0b307f0e893b0c6"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dchat_8c.html#ae2c246a2244b6435d0b307f0e893b0c6">handle_local_conn_request</a> (<a class="el" href="structdchat__conf.html">dchat_conf_t</a> *<a class="el" href="dchat_8c.html#a5497dfcbcfecec06aaf63df011c70f83">cnf</a>, char *onion_id, uint16_t port)</td></tr>
<tr class="memdesc:ae2c246a2244b6435d0b307f0e893b0c6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles local connection requests from the user.  <a href="#ae2c246a2244b6435d0b307f0e893b0c6">More...</a><br /></td></tr>
<tr class="separator:ae2c246a2244b6435d0b307f0e893b0c6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5c79a63478c0df6d16f70940e53338d1"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dchat_8c.html#a5c79a63478c0df6d16f70940e53338d1">handle_remote_conn_request</a> (<a class="el" href="structdchat__conf.html">dchat_conf_t</a> *<a class="el" href="dchat_8c.html#a5497dfcbcfecec06aaf63df011c70f83">cnf</a>)</td></tr>
<tr class="memdesc:a5c79a63478c0df6d16f70940e53338d1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles connection requests from a remote client.  <a href="#a5c79a63478c0df6d16f70940e53338d1">More...</a><br /></td></tr>
<tr class="separator:a5c79a63478c0df6d16f70940e53338d1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a297b3a9a3e921bc25e5559de4c7dcaea"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dchat_8c.html#a297b3a9a3e921bc25e5559de4c7dcaea">cleanup_th_new_conn</a> (void *arg)</td></tr>
<tr class="memdesc:a297b3a9a3e921bc25e5559de4c7dcaea"><td class="mdescLeft">&#160;</td><td class="mdescRight">Cleanup ressources used by the thread <code>conn_th</code> holded by the global config.  <a href="#a297b3a9a3e921bc25e5559de4c7dcaea">More...</a><br /></td></tr>
<tr class="separator:a297b3a9a3e921bc25e5559de4c7dcaea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a20c922556a3f5ba773faf2b38fc16750"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dchat_8c.html#a20c922556a3f5ba773faf2b38fc16750">th_new_conn</a> (<a class="el" href="structdchat__conf.html">dchat_conf_t</a> *<a class="el" href="dchat_8c.html#a5497dfcbcfecec06aaf63df011c70f83">cnf</a>)</td></tr>
<tr class="memdesc:a20c922556a3f5ba773faf2b38fc16750"><td class="mdescLeft">&#160;</td><td class="mdescRight">Thread function that reads an onion address from a pipe and connects to this address.  <a href="#a20c922556a3f5ba773faf2b38fc16750">More...</a><br /></td></tr>
<tr class="separator:a20c922556a3f5ba773faf2b38fc16750"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0a9fd273c9490e8cf99a08da3cfab690"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dchat_8c.html#a0a9fd273c9490e8cf99a08da3cfab690">th_new_input</a> (<a class="el" href="structdchat__conf.html">dchat_conf_t</a> *<a class="el" href="dchat_8c.html#a5497dfcbcfecec06aaf63df011c70f83">cnf</a>)</td></tr>
<tr class="memdesc:a0a9fd273c9490e8cf99a08da3cfab690"><td class="mdescLeft">&#160;</td><td class="mdescRight">Thread function that reads from stdin until the user hits enter.  <a href="#a0a9fd273c9490e8cf99a08da3cfab690">More...</a><br /></td></tr>
<tr class="separator:a0a9fd273c9490e8cf99a08da3cfab690"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab40992a684f2718a616237fd50fe9be5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dchat_8c.html#ab40992a684f2718a616237fd50fe9be5">cleanup_th_main_loop</a> (void *arg)</td></tr>
<tr class="memdesc:ab40992a684f2718a616237fd50fe9be5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Cleanup ressources used by the thread <code>select_th</code> holded by the global config.  <a href="#ab40992a684f2718a616237fd50fe9be5">More...</a><br /></td></tr>
<tr class="separator:ab40992a684f2718a616237fd50fe9be5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a39d1655c3815d6db5026c52870b45776"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dchat_8c.html#a39d1655c3815d6db5026c52870b45776">th_main_loop</a> (<a class="el" href="structdchat__conf.html">dchat_conf_t</a> *<a class="el" href="dchat_8c.html#a5497dfcbcfecec06aaf63df011c70f83">cnf</a>)</td></tr>
<tr class="memdesc:a39d1655c3815d6db5026c52870b45776"><td class="mdescLeft">&#160;</td><td class="mdescRight">Main chat loop of this client.  <a href="#a39d1655c3815d6db5026c52870b45776">More...</a><br /></td></tr>
<tr class="separator:a39d1655c3815d6db5026c52870b45776"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a5497dfcbcfecec06aaf63df011c70f83"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a5497dfcbcfecec06aaf63df011c70f83"></a>
<a class="el" href="structdchat__conf.html">dchat_conf_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dchat_8c.html#a5497dfcbcfecec06aaf63df011c70f83">cnf</a></td></tr>
<tr class="memdesc:a5497dfcbcfecec06aaf63df011c70f83"><td class="mdescLeft">&#160;</td><td class="mdescRight">global dchat configuration structure <br /></td></tr>
<tr class="separator:a5497dfcbcfecec06aaf63df011c70f83"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This file is the main file for DChat and contains, besides the main function, several core functions. </p>
<p>Core functions are:</p>
<p>-) Handler for accepting connections</p>
<p>-) Handler for user input</p>
<p>-) Handler for remote data</p>
<p>-) Handler for file sharing </p>

<p>Definition in file <a class="el" href="dchat_8c_source.html">dchat.c</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ab40992a684f2718a616237fd50fe9be5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void cleanup_th_main_loop </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>arg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Cleanup ressources used by the thread <code>select_th</code> holded by the global config. </p>
<p>Closes the listening port, every contact file descriptor and the reading pipe end of <code>user_input</code> and <code>cl_change</code>. </p>

<p>Definition at line <a class="el" href="dchat_8c_source.html#l00920">920</a> of file <a class="el" href="dchat_8c_source.html">dchat.c</a>.</p>

</div>
</div>
<a class="anchor" id="a297b3a9a3e921bc25e5559de4c7dcaea"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void cleanup_th_new_conn </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>arg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Cleanup ressources used by the thread <code>conn_th</code> holded by the global config. </p>
<p>Closes the reading pipe <code>connect_fd</code> and the writing pipe end of <code>cl_change</code> stored in the global config. </p>
<p>close pipes used for in <code>th_new_conn</code> </p>

<p>Definition at line <a class="el" href="dchat_8c_source.html#l00758">758</a> of file <a class="el" href="dchat_8c_source.html">dchat.c</a>.</p>

</div>
</div>
<a class="anchor" id="a103bc702ed34e7ba88e166b169cfe464"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void destroy </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdchat__conf.html">dchat_conf_t</a> *&#160;</td>
          <td class="paramname"><em>cnf</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Frees all global config resources used. </p>
<p>Closes all open file descriptors, sockets, pipes and mutexes stored within the global config. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cnf</td><td>Global dchat config </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="dchat_8c_source.html#l00428">428</a> of file <a class="el" href="dchat_8c_source.html">dchat.c</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dchat_8c_a103bc702ed34e7ba88e166b169cfe464_cgraph.png" border="0" usemap="#dchat_8c_a103bc702ed34e7ba88e166b169cfe464_cgraph" alt=""/></div>
<map name="dchat_8c_a103bc702ed34e7ba88e166b169cfe464_cgraph" id="dchat_8c_a103bc702ed34e7ba88e166b169cfe464_cgraph">
<area shape="rect" id="node2" href="log_8c.html#aadc76aa2a75bd302883a2bb571a42033" title="Returns the ansi escape code string for clearing the current line in a terminal. " alt="" coords="121,5,231,32"/><area shape="rect" id="node3" href="log_8c.html#ae3ea2f374cda4c473cbd22f83dc6b64f" title="Retruns the ansi escape code string for carriage return . " alt="" coords="143,56,209,83"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ae2c246a2244b6435d0b307f0e893b0c6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int handle_local_conn_request </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdchat__conf.html">dchat_conf_t</a> *&#160;</td>
          <td class="paramname"><em>cnf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>onion_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>port</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handles local connection requests from the user. </p>
<p>Connects to the remote client with the given onion address, who will be added as contact. This new contact will be sent that all of our known contacts as specified in the DChat protocol. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cnf</td><td>Pointer to global configuration holding the contactlist </td></tr>
    <tr><td class="paramname">onion_id</td><td>Destination onion address to connect to </td></tr>
    <tr><td class="paramname">port</td><td>Destination port to connect to </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The index where the contact has been added in the contactlist, -1 on error </dd></dl>

<p>Definition at line <a class="el" href="dchat_8c_source.html#l00677">677</a> of file <a class="el" href="dchat_8c_source.html">dchat.c</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dchat_8c_ae2c246a2244b6435d0b307f0e893b0c6_cgraph.png" border="0" usemap="#dchat_8c_ae2c246a2244b6435d0b307f0e893b0c6_cgraph" alt=""/></div>
<map name="dchat_8c_ae2c246a2244b6435d0b307f0e893b0c6_cgraph" id="dchat_8c_ae2c246a2244b6435d0b307f0e893b0c6_cgraph">
<area shape="rect" id="node2" href="network_8c.html#abd951e9fd43b0ec9248ca6ec43398c6b" title="Creates a TOR socket. " alt="" coords="240,1262,368,1289"/><area shape="rect" id="node6" href="log_8c.html#aba81f1b639baac0f96848d9cb3a3b207" title="Log a message together with a string representation of errno as error. " alt="" coords="623,1402,702,1429"/><area shape="rect" id="node10" href="contact_8c.html#a6777b1a477207c7bbc9e560cf9caabed" title="Adds a new contact to the local contactlist. " alt="" coords="257,1161,351,1188"/><area shape="rect" id="node13" href="contact_8c.html#a625b0742c9e1cbd35146d35ecbf25282" title="Sends local contactlist to a contact. " alt="" coords="250,946,358,973"/><area shape="rect" id="node3" href="log_8c.html#a021b18b681712d42cb07c99171691a84" title="Log a message. " alt="" coords="1139,1110,1211,1137"/><area shape="rect" id="node5" href="network_8c.html#a77de9c9eb5a8ea2a6da108270bd7417e" title="Connects to a remote socket using the given socket address. " alt="" coords="443,1364,530,1390"/><area shape="rect" id="node7" href="network_8c.html#abd49b4a8eb0f62dc3be6755729d672b8" title="Writes a SOCKS PDU to the given socket. " alt="" coords="433,1262,540,1289"/><area shape="rect" id="node8" href="network_8c.html#a0ace1062fab444c73177e0552e019425" title="Reads a SOCKS response PDU from the given socket. " alt="" coords="434,1161,539,1188"/><area shape="rect" id="node9" href="network_8c.html#abd3d58b10c19c6d550b6e6aa86c9dc5c" title="Parses given status and returns its corresponding status message. " alt="" coords="417,1212,557,1238"/><area shape="rect" id="node4" href="log_8c.html#a38678da7483f269b8c96f83a8f45ef12" title="Log a message to a file. " alt="" coords="1304,1110,1387,1137"/><area shape="rect" id="node11" href="contact_8c.html#a0de7073d40f7447f933e334054d432d8" title="Resizes the contactlist. " alt="" coords="917,1110,1045,1137"/><area shape="rect" id="node12" href="log_8c.html#a677da14e8c4326bde43622f233f1ead3" title="Prints an error message and terminates this program. " alt="" coords="1151,448,1198,474"/><area shape="rect" id="node14" href="decoder_8c.html#abaf80c220fd915287452a6baa5b05e2e" title="Initializes a DChat PDU with the given values. " alt="" coords="927,1009,1036,1036"/><area shape="rect" id="node20" href="contact_8c.html#ac15f4eb395316547db5ceba947a2f3b9" title="Converts a contact into a string. " alt="" coords="919,857,1043,884"/><area shape="rect" id="node21" href="decoder_8c.html#af4aaf258b8866187ed65d6d1c23083cb" title="Converts a PDU to a string that will be written to a file descriptor. " alt="" coords="447,477,527,504"/><area shape="rect" id="node15" href="decoder_8c.html#a8a64791a4f610ecaff285d91512ea927" title="Checks if the given version is a valid and supported DChat version. " alt="" coords="1116,1006,1233,1033"/><area shape="rect" id="node16" href="decoder_8c.html#a2960a3c598ee607801fc333b5d1cfce9" title="Checks if the given Content&#45;Type number is a valid DChat Content&#45;Type. " alt="" coords="1099,1057,1250,1084"/><area shape="rect" id="node17" href="network_8c.html#a139629f69df293ba1da88fea96af5e5e" title="Checks wether the given onion&#45;id is a valid onion address. " alt="" coords="1121,818,1228,845"/><area shape="rect" id="node18" href="network_8c.html#a53aa686284d28600afef0e06d7ab3d54" title="Checks wether the given port is a valid TCP port. " alt="" coords="1126,894,1223,921"/><area shape="rect" id="node19" href="decoder_8c.html#a338364bcfd88f32a9b162c4e12bd3cad" title="Checks if the given nickname is a valid DChat nickname. " alt="" coords="1109,949,1240,976"/><area shape="rect" id="node22" href="decoder_8c.html#aed8d6a7e8b9b368fa54d7af2f2a5231e" title="Initializes a DChat V1 structure containing all available and supported headers of the DChat V1 proto..." alt="" coords="769,502,869,529"/><area shape="rect" id="node42" href="decoder_8c.html#a92bdcc4d06ae8c3fb41f6f0489a44891" title="Crafts a DChat header string. " alt="" coords="605,452,720,478"/><area shape="rect" id="node23" href="decoder_8c.html#a42be8c12ff007b95a9a98175c1738d0c" title="Parses the given value to a supported version of DChat and sets, if valid, its value in the PDU struc..." alt="" coords="926,452,1037,478"/><area shape="rect" id="node24" href="decoder_8c.html#ae08df473fb28e4f06044d50f8428eafc" title="Converts the version field in the PDU to a string and sets the address of the given value parameter t..." alt="" coords="926,198,1037,225"/><area shape="rect" id="node25" href="decoder_8c.html#af7a1420a7b9ce8077005793d5baa48b3" title="Parses the given value to a supported content&#45;type of DChat and sets, if valid, its value in the PDU ..." alt="" coords="928,553,1035,580"/><area shape="rect" id="node27" href="decoder_8c.html#a9ba39a2b36836a7dc2dbe548cd02c21f" title="Converts the content&#45;type field in the PDU to a string and sets the address of the given value parame..." alt="" coords="928,401,1035,428"/><area shape="rect" id="node28" href="decoder_8c.html#a186b736b428ee1ba79bc538a560a9e28" title="Parses the given value to a content&#45;length and sets its value, if valid, in the given PDU structure..." alt="" coords="929,654,1034,681"/><area shape="rect" id="node30" href="decoder_8c.html#aa34bd8632014a3a135df77c5786bda6d" title="Converts the content&#45;length field in the PDU to a string and sets the address of the given value para..." alt="" coords="929,502,1034,529"/><area shape="rect" id="node31" href="decoder_8c.html#ace47761936ccffbfbac61e6905d8333d" title="Parses the given value to an onion address and sets its value , if valid, in the given PDU structure..." alt="" coords="926,806,1037,833"/><area shape="rect" id="node32" href="decoder_8c.html#a019debfd4003c322fba5003b6c191129" title="Converts the onion&#45;id field in the PDU to a string and sets the address of the given value parameter ..." alt="" coords="926,604,1037,630"/><area shape="rect" id="node33" href="decoder_8c.html#a93c5fb5eadf28693c56b187748a284b9" title="Parses the given value to a listening port and sets its value, if valid, in the given PDU structure..." alt="" coords="926,958,1037,985"/><area shape="rect" id="node34" href="decoder_8c.html#ac89711a42de87d7b24f7e598b0167f85" title="Converts the listening&#45;port field in the PDU to a string and sets the address of the given value para..." alt="" coords="926,705,1037,732"/><area shape="rect" id="node35" href="decoder_8c.html#a8a21bca3a0374aeda651aba069d0bfb4" title="Parses the given value to a nickname and sets its value, if valid, in the given PDU structure..." alt="" coords="927,756,1036,782"/><area shape="rect" id="node36" href="decoder_8c.html#a5f3472fbd176480725e69578245d3c61" title="Converts the nickname field in the PDU to a string and sets the address of the given value parameter ..." alt="" coords="927,908,1036,934"/><area shape="rect" id="node37" href="decoder_8c.html#ad1fb16f98ba7cba1d0e8394a0a825214" title="Parses the given value to a struct tm and sets its value, if valid, in the given PDU structure..." alt="" coords="926,300,1037,326"/><area shape="rect" id="node38" href="decoder_8c.html#ab124906e75a01fb9448bf33eac5906da" title="Converts the sent field in the PDU to a string and sets the address of the given value parameter to t..." alt="" coords="926,97,1037,124"/><area shape="rect" id="node40" href="decoder_8c.html#aa8ff1abc0a14ba58a3c7bfd5cc81fc1f" title="Parses the given value to a server field and sets its value, if valid, in the given PDU structure..." alt="" coords="926,249,1037,276"/><area shape="rect" id="node41" href="decoder_8c.html#affa9e2c054d9f619c3cf426a4a2ed9c7" title="Converts the server field in the PDU to a string and sets the address of the given value parameter to..." alt="" coords="926,350,1037,377"/><area shape="rect" id="node26" href="decoder_8c.html#ab89ef1994dd9e9d401b4c0d5feb594b2" title="Initializes a content&#45;types structure with all available content&#45;types in DChat. " alt="" coords="1109,523,1240,564"/><area shape="rect" id="node29" href="decoder_8c.html#a4ecd7cbbbe72098afc1bd5508067d8e4" title="Checks if the given Content&#45;Length is a valid DChat Content&#45;Length. " alt="" coords="1094,610,1255,637"/><area shape="rect" id="node39" href="util_8c.html#a14252469532ecf356f22412644467eba" title="Checks wether n successive bytes in the memory pointed by ptr are 0. " alt="" coords="1146,97,1203,124"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="af26d1f15348f568261ddb15d886dbaff"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int handle_local_input </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdchat__conf.html">dchat_conf_t</a> *&#160;</td>
          <td class="paramname"><em>cnf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>line</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handles local user input. </p>
<p>Interpretes the given line and reacts correspondently to it. If the line is a command it will be executed, otherwise it will be treated as text message and send to all known contacts stored in the contactlist in the global configuration. </p><dl class="section see"><dt>See also</dt><dd><a class="el" href="decoder_8c.html#af4aaf258b8866187ed65d6d1c23083cb" title="Converts a PDU to a string that will be written to a file descriptor. ">write_pdu()</a> </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cnf</td><td>Pointer to global configuration </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, -1 on error </dd></dl>

<p>Definition at line <a class="el" href="dchat_8c_source.html#l00484">484</a> of file <a class="el" href="dchat_8c_source.html">dchat.c</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dchat_8c_af26d1f15348f568261ddb15d886dbaff_cgraph.png" border="0" usemap="#dchat_8c_af26d1f15348f568261ddb15d886dbaff_cgraph" alt=""/></div>
<map name="dchat_8c_af26d1f15348f568261ddb15d886dbaff_cgraph" id="dchat_8c_af26d1f15348f568261ddb15d886dbaff_cgraph">
<area shape="rect" id="node2" href="cmdinterpreter_8c.html#a2fa3c6d0d37d8092bb7065361ac25bd0" title="Parses the given string and executes it if it is a command. " alt="" coords="351,271,439,297"/><area shape="rect" id="node5" href="log_8c.html#a021b18b681712d42cb07c99171691a84" title="Log a message. " alt="" coords="880,93,952,120"/><area shape="rect" id="node13" href="decoder_8c.html#abaf80c220fd915287452a6baa5b05e2e" title="Initializes a DChat PDU with the given values. " alt="" coords="673,245,783,272"/><area shape="rect" id="node17" href="decoder_8c.html#ac0e7619d80bc7c53c88b1e893eb00df5" title="Initializes the content of a DChat PDU with the given value. " alt="" coords="315,1208,475,1235"/><area shape="rect" id="node18" href="decoder_8c.html#af4aaf258b8866187ed65d6d1c23083cb" title="Converts a PDU to a string that will be written to a file descriptor. " alt="" coords="187,651,267,677"/><area shape="rect" id="node40" href="decoder_8c.html#ade270b4d1100adbdffbb22fdd5635737" title="Frees all resources dynamically allocated for a PDU structure. " alt="" coords="189,752,264,779"/><area shape="rect" id="node3" href="cmdinterpreter_8c.html#a910a5c62ab4a4c2976b6892e8c5e7cac" title="Initializes a commands structure with all available in&#45;chat commands and its executable functions..." alt="" coords="534,144,613,171"/><area shape="rect" id="node12" href="log_8c.html#a677da14e8c4326bde43622f233f1ead3" title="Prints an error message and terminates this program. " alt="" coords="893,853,939,880"/><area shape="rect" id="node4" href="cmdinterpreter_8c.html#afe98f05a74bf03fd79e915b594de9bb5" title="Prints help. " alt="" coords="690,93,766,120"/><area shape="rect" id="node7" href="cmdinterpreter_8c.html#a81ef7494b366e90638a9cbd26a3c69c6" title="Connects to a remote host. " alt="" coords="689,195,767,221"/><area shape="rect" id="node11" href="cmdinterpreter_8c.html#a6ca8cd86038b9b3a2bc718b17dd87c86" title="Lists alls contacts within the local contactlist. " alt="" coords="693,144,763,171"/><area shape="rect" id="node6" href="log_8c.html#a38678da7483f269b8c96f83a8f45ef12" title="Log a message to a file. " alt="" coords="1048,473,1131,500"/><area shape="rect" id="node8" href="util_8c.html#aec599e83690b143e509ae4dd566fa5aa" title="Removes leading whitespaces. " alt="" coords="833,144,999,171"/><area shape="rect" id="node9" href="network_8c.html#a53aa686284d28600afef0e06d7ab3d54" title="Checks wether the given port is a valid TCP port. " alt="" coords="867,347,965,373"/><area shape="rect" id="node10" href="network_8c.html#a139629f69df293ba1da88fea96af5e5e" title="Checks wether the given onion&#45;id is a valid onion address. " alt="" coords="863,296,969,323"/><area shape="rect" id="node14" href="decoder_8c.html#a8a64791a4f610ecaff285d91512ea927" title="Checks if the given version is a valid and supported DChat version. " alt="" coords="857,195,975,221"/><area shape="rect" id="node15" href="decoder_8c.html#a2960a3c598ee607801fc333b5d1cfce9" title="Checks if the given Content&#45;Type number is a valid DChat Content&#45;Type. " alt="" coords="841,245,991,272"/><area shape="rect" id="node16" href="decoder_8c.html#a338364bcfd88f32a9b162c4e12bd3cad" title="Checks if the given nickname is a valid DChat nickname. " alt="" coords="851,495,981,521"/><area shape="rect" id="node19" href="decoder_8c.html#aed8d6a7e8b9b368fa54d7af2f2a5231e" title="Initializes a DChat V1 structure containing all available and supported headers of the DChat V1 proto..." alt="" coords="523,676,623,703"/><area shape="rect" id="node39" href="decoder_8c.html#a92bdcc4d06ae8c3fb41f6f0489a44891" title="Crafts a DChat header string. " alt="" coords="337,701,452,728"/><area shape="rect" id="node20" href="decoder_8c.html#a42be8c12ff007b95a9a98175c1738d0c" title="Parses the given value to a supported version of DChat and sets, if valid, its value in the PDU struc..." alt="" coords="673,448,783,475"/><area shape="rect" id="node21" href="decoder_8c.html#ae08df473fb28e4f06044d50f8428eafc" title="Converts the version field in the PDU to a string and sets the address of the given value parameter t..." alt="" coords="673,904,783,931"/><area shape="rect" id="node22" href="decoder_8c.html#af7a1420a7b9ce8077005793d5baa48b3" title="Parses the given value to a supported content&#45;type of DChat and sets, if valid, its value in the PDU ..." alt="" coords="675,651,781,677"/><area shape="rect" id="node24" href="decoder_8c.html#a9ba39a2b36836a7dc2dbe548cd02c21f" title="Converts the content&#45;type field in the PDU to a string and sets the address of the given value parame..." alt="" coords="675,752,781,779"/><area shape="rect" id="node25" href="decoder_8c.html#a186b736b428ee1ba79bc538a560a9e28" title="Parses the given value to a content&#45;length and sets its value, if valid, in the given PDU structure..." alt="" coords="675,1208,781,1235"/><area shape="rect" id="node27" href="decoder_8c.html#aa34bd8632014a3a135df77c5786bda6d" title="Converts the content&#45;length field in the PDU to a string and sets the address of the given value para..." alt="" coords="675,1157,781,1184"/><area shape="rect" id="node28" href="decoder_8c.html#ace47761936ccffbfbac61e6905d8333d" title="Parses the given value to an onion address and sets its value , if valid, in the given PDU structure..." alt="" coords="673,296,783,323"/><area shape="rect" id="node29" href="decoder_8c.html#a019debfd4003c322fba5003b6c191129" title="Converts the onion&#45;id field in the PDU to a string and sets the address of the given value parameter ..." alt="" coords="673,397,783,424"/><area shape="rect" id="node30" href="decoder_8c.html#a93c5fb5eadf28693c56b187748a284b9" title="Parses the given value to a listening port and sets its value, if valid, in the given PDU structure..." alt="" coords="673,347,783,373"/><area shape="rect" id="node31" href="decoder_8c.html#ac89711a42de87d7b24f7e598b0167f85" title="Converts the listening&#45;port field in the PDU to a string and sets the address of the given value para..." alt="" coords="673,600,783,627"/><area shape="rect" id="node32" href="decoder_8c.html#a8a21bca3a0374aeda651aba069d0bfb4" title="Parses the given value to a nickname and sets its value, if valid, in the given PDU structure..." alt="" coords="673,549,783,576"/><area shape="rect" id="node33" href="decoder_8c.html#a5f3472fbd176480725e69578245d3c61" title="Converts the nickname field in the PDU to a string and sets the address of the given value parameter ..." alt="" coords="673,701,783,728"/><area shape="rect" id="node34" href="decoder_8c.html#ad1fb16f98ba7cba1d0e8394a0a825214" title="Parses the given value to a struct tm and sets its value, if valid, in the given PDU structure..." alt="" coords="673,499,783,525"/><area shape="rect" id="node35" href="decoder_8c.html#ab124906e75a01fb9448bf33eac5906da" title="Converts the sent field in the PDU to a string and sets the address of the given value parameter to t..." alt="" coords="673,803,783,829"/><area shape="rect" id="node37" href="decoder_8c.html#aa8ff1abc0a14ba58a3c7bfd5cc81fc1f" title="Parses the given value to a server field and sets its value, if valid, in the given PDU structure..." alt="" coords="673,955,783,981"/><area shape="rect" id="node38" href="decoder_8c.html#affa9e2c054d9f619c3cf426a4a2ed9c7" title="Converts the server field in the PDU to a string and sets the address of the given value parameter to..." alt="" coords="673,853,783,880"/><area shape="rect" id="node23" href="decoder_8c.html#ab89ef1994dd9e9d401b4c0d5feb594b2" title="Initializes a content&#45;types structure with all available content&#45;types in DChat. " alt="" coords="851,690,981,731"/><area shape="rect" id="node26" href="decoder_8c.html#a4ecd7cbbbe72098afc1bd5508067d8e4" title="Checks if the given Content&#45;Length is a valid DChat Content&#45;Length. " alt="" coords="835,1183,997,1209"/><area shape="rect" id="node36" href="util_8c.html#a14252469532ecf356f22412644467eba" title="Checks wether n successive bytes in the memory pointed by ptr are 0. " alt="" coords="887,803,945,829"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a5c79a63478c0df6d16f70940e53338d1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int handle_remote_conn_request </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdchat__conf.html">dchat_conf_t</a> *&#160;</td>
          <td class="paramname"><em>cnf</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handles connection requests from a remote client. </p>
<p>Accepts a connection from a remote client and so that a new chat session will be established between this and the remote host. Moreover the remote host will be added as new contact in the contactlist and the local contactlist will be sent to him. </p><dl class="section see"><dt>See also</dt><dd><a class="el" href="contact_8c.html#a6777b1a477207c7bbc9e560cf9caabed" title="Adds a new contact to the local contactlist. ">add_contact()</a> </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cnf</td><td>Pointer to global configuration </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>return value of function add_contact, or -1 on error </dd></dl>

<p>Definition at line <a class="el" href="dchat_8c_source.html#l00722">722</a> of file <a class="el" href="dchat_8c_source.html">dchat.c</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dchat_8c_a5c79a63478c0df6d16f70940e53338d1_cgraph.png" border="0" usemap="#dchat_8c_a5c79a63478c0df6d16f70940e53338d1_cgraph" alt=""/></div>
<map name="dchat_8c_a5c79a63478c0df6d16f70940e53338d1_cgraph" id="dchat_8c_a5c79a63478c0df6d16f70940e53338d1_cgraph">
<area shape="rect" id="node2" href="log_8c.html#aba81f1b639baac0f96848d9cb3a3b207" title="Log a message together with a string representation of errno as error. " alt="" coords="358,5,437,32"/><area shape="rect" id="node4" href="contact_8c.html#a6777b1a477207c7bbc9e560cf9caabed" title="Adds a new contact to the local contactlist. " alt="" coords="207,1101,302,1128"/><area shape="rect" id="node6" href="log_8c.html#a021b18b681712d42cb07c99171691a84" title="Log a message. " alt="" coords="1019,1171,1091,1197"/><area shape="rect" id="node8" href="contact_8c.html#a625b0742c9e1cbd35146d35ecbf25282" title="Sends local contactlist to a contact. " alt="" coords="201,1025,309,1052"/><area shape="rect" id="node3" href="log_8c.html#a38678da7483f269b8c96f83a8f45ef12" title="Log a message to a file. " alt="" coords="1184,512,1267,539"/><area shape="rect" id="node5" href="contact_8c.html#a0de7073d40f7447f933e334054d432d8" title="Resizes the contactlist. " alt="" coords="797,1171,925,1197"/><area shape="rect" id="node7" href="log_8c.html#a677da14e8c4326bde43622f233f1ead3" title="Prints an error message and terminates this program. " alt="" coords="1031,512,1078,539"/><area shape="rect" id="node9" href="decoder_8c.html#abaf80c220fd915287452a6baa5b05e2e" title="Initializes a DChat PDU with the given values. " alt="" coords="807,1069,916,1096"/><area shape="rect" id="node15" href="contact_8c.html#ac15f4eb395316547db5ceba947a2f3b9" title="Converts a contact into a string. " alt="" coords="799,968,923,995"/><area shape="rect" id="node16" href="decoder_8c.html#af4aaf258b8866187ed65d6d1c23083cb" title="Converts a PDU to a string that will be written to a file descriptor. " alt="" coords="357,537,437,564"/><area shape="rect" id="node10" href="decoder_8c.html#a8a64791a4f610ecaff285d91512ea927" title="Checks if the given version is a valid and supported DChat version. " alt="" coords="996,1069,1113,1096"/><area shape="rect" id="node11" href="decoder_8c.html#a2960a3c598ee607801fc333b5d1cfce9" title="Checks if the given Content&#45;Type number is a valid DChat Content&#45;Type. " alt="" coords="979,1120,1130,1147"/><area shape="rect" id="node12" href="network_8c.html#a139629f69df293ba1da88fea96af5e5e" title="Checks wether the given onion&#45;id is a valid onion address. " alt="" coords="1001,917,1108,944"/><area shape="rect" id="node13" href="network_8c.html#a53aa686284d28600afef0e06d7ab3d54" title="Checks wether the given port is a valid TCP port. " alt="" coords="1006,968,1103,995"/><area shape="rect" id="node14" href="decoder_8c.html#a338364bcfd88f32a9b162c4e12bd3cad" title="Checks if the given nickname is a valid DChat nickname. " alt="" coords="989,1019,1120,1045"/><area shape="rect" id="node17" href="decoder_8c.html#aed8d6a7e8b9b368fa54d7af2f2a5231e" title="Initializes a DChat V1 structure containing all available and supported headers of the DChat V1 proto..." alt="" coords="649,563,749,589"/><area shape="rect" id="node37" href="decoder_8c.html#a92bdcc4d06ae8c3fb41f6f0489a44891" title="Crafts a DChat header string. " alt="" coords="485,512,600,539"/><area shape="rect" id="node18" href="decoder_8c.html#a42be8c12ff007b95a9a98175c1738d0c" title="Parses the given value to a supported version of DChat and sets, if valid, its value in the PDU struc..." alt="" coords="806,867,917,893"/><area shape="rect" id="node19" href="decoder_8c.html#ae08df473fb28e4f06044d50f8428eafc" title="Converts the version field in the PDU to a string and sets the address of the given value parameter t..." alt="" coords="806,360,917,387"/><area shape="rect" id="node20" href="decoder_8c.html#af7a1420a7b9ce8077005793d5baa48b3" title="Parses the given value to a supported content&#45;type of DChat and sets, if valid, its value in the PDU ..." alt="" coords="808,613,915,640"/><area shape="rect" id="node22" href="decoder_8c.html#a9ba39a2b36836a7dc2dbe548cd02c21f" title="Converts the content&#45;type field in the PDU to a string and sets the address of the given value parame..." alt="" coords="808,563,915,589"/><area shape="rect" id="node23" href="decoder_8c.html#a186b736b428ee1ba79bc538a560a9e28" title="Parses the given value to a content&#45;length and sets its value, if valid, in the given PDU structure..." alt="" coords="809,157,914,184"/><area shape="rect" id="node25" href="decoder_8c.html#aa34bd8632014a3a135df77c5786bda6d" title="Converts the content&#45;length field in the PDU to a string and sets the address of the given value para..." alt="" coords="809,208,914,235"/><area shape="rect" id="node26" href="decoder_8c.html#ace47761936ccffbfbac61e6905d8333d" title="Parses the given value to an onion address and sets its value , if valid, in the given PDU structure..." alt="" coords="806,917,917,944"/><area shape="rect" id="node27" href="decoder_8c.html#a019debfd4003c322fba5003b6c191129" title="Converts the onion&#45;id field in the PDU to a string and sets the address of the given value parameter ..." alt="" coords="806,664,917,691"/><area shape="rect" id="node28" href="decoder_8c.html#a93c5fb5eadf28693c56b187748a284b9" title="Parses the given value to a listening port and sets its value, if valid, in the given PDU structure..." alt="" coords="806,1019,917,1045"/><area shape="rect" id="node29" href="decoder_8c.html#ac89711a42de87d7b24f7e598b0167f85" title="Converts the listening&#45;port field in the PDU to a string and sets the address of the given value para..." alt="" coords="806,715,917,741"/><area shape="rect" id="node30" href="decoder_8c.html#a8a21bca3a0374aeda651aba069d0bfb4" title="Parses the given value to a nickname and sets its value, if valid, in the given PDU structure..." alt="" coords="807,411,916,437"/><area shape="rect" id="node31" href="decoder_8c.html#a5f3472fbd176480725e69578245d3c61" title="Converts the nickname field in the PDU to a string and sets the address of the given value parameter ..." alt="" coords="807,816,916,843"/><area shape="rect" id="node32" href="decoder_8c.html#ad1fb16f98ba7cba1d0e8394a0a825214" title="Parses the given value to a struct tm and sets its value, if valid, in the given PDU structure..." alt="" coords="806,765,917,792"/><area shape="rect" id="node33" href="decoder_8c.html#ab124906e75a01fb9448bf33eac5906da" title="Converts the sent field in the PDU to a string and sets the address of the given value parameter to t..." alt="" coords="806,259,917,285"/><area shape="rect" id="node35" href="decoder_8c.html#aa8ff1abc0a14ba58a3c7bfd5cc81fc1f" title="Parses the given value to a server field and sets its value, if valid, in the given PDU structure..." alt="" coords="806,461,917,488"/><area shape="rect" id="node36" href="decoder_8c.html#affa9e2c054d9f619c3cf426a4a2ed9c7" title="Converts the server field in the PDU to a string and sets the address of the given value parameter to..." alt="" coords="806,512,917,539"/><area shape="rect" id="node21" href="decoder_8c.html#ab89ef1994dd9e9d401b4c0d5feb594b2" title="Initializes a content&#45;types structure with all available content&#45;types in DChat. " alt="" coords="989,585,1120,626"/><area shape="rect" id="node24" href="decoder_8c.html#a4ecd7cbbbe72098afc1bd5508067d8e4" title="Checks if the given Content&#45;Length is a valid DChat Content&#45;Length. " alt="" coords="974,183,1135,209"/><area shape="rect" id="node34" href="util_8c.html#a14252469532ecf356f22412644467eba" title="Checks wether n successive bytes in the memory pointed by ptr are 0. " alt="" coords="1026,259,1083,285"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a2cbf2aad21d016dd4852369423d86270"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int handle_remote_input </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdchat__conf.html">dchat_conf_t</a> *&#160;</td>
          <td class="paramname"><em>cnf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>n</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handles PDUs received from a remote client. </p>
<p>Reads in a PDU from a certain contact file descriptor and interpretes its headers and handles its content. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cnf</td><td>Pointer to global configuration holding the contactlist </td></tr>
    <tr><td class="paramname">n</td><td>Index of contact in the respective contactlist </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>length of bytes read, 0 on EOF or -1 in case of error </dd></dl>

<p>Definition at line <a class="el" href="dchat_8c_source.html#l00540">540</a> of file <a class="el" href="dchat_8c_source.html">dchat.c</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dchat_8c_a2cbf2aad21d016dd4852369423d86270_cgraph.png" border="0" usemap="#dchat_8c_a2cbf2aad21d016dd4852369423d86270_cgraph" alt=""/></div>
<map name="dchat_8c_a2cbf2aad21d016dd4852369423d86270_cgraph" id="dchat_8c_a2cbf2aad21d016dd4852369423d86270_cgraph">
<area shape="rect" id="node2" href="decoder_8c.html#ac5566b29faaf60fb8c68a3d97d3fadc3" title="Read a whole DChat PDU from a file descriptor. " alt="" coords="223,1109,302,1136"/><area shape="rect" id="node4" href="log_8c.html#a677da14e8c4326bde43622f233f1ead3" title="Prints an error message and terminates this program. " alt="" coords="1017,1515,1063,1541"/><area shape="rect" id="node27" href="log_8c.html#a021b18b681712d42cb07c99171691a84" title="Log a message. " alt="" coords="1004,375,1076,401"/><area shape="rect" id="node28" href="log_8c.html#ab43cc6f8c6c043d052ebcfebd33023e9" title="Prints a chat message to a file descriptor. " alt="" coords="203,144,323,171"/><area shape="rect" id="node33" href="contact_8c.html#aa0681254b16e6d20d63a03aed84c12e2" title="Checks the local contactlist for duplicates. " alt="" coords="201,743,325,769"/><area shape="rect" id="node36" href="contact_8c.html#a56a9992b188f855108c72588953fe8a6" title="Deletes a contact from the local contactlist. " alt="" coords="633,333,724,360"/><area shape="rect" id="node38" href="contact_8c.html#a2161fbd1e0fc61c762f08bb102e54ab8" title="Contacts transferred via PDU will be added to the contactlist. " alt="" coords="201,667,324,693"/><area shape="rect" id="node50" href="decoder_8c.html#ade270b4d1100adbdffbb22fdd5635737" title="Frees all resources dynamically allocated for a PDU structure. " alt="" coords="225,1971,300,1997"/><area shape="rect" id="node3" href="decoder_8c.html#a9a4f2d2d79d140c5d1bcb5be3bc82e0e" title="Read a line terminated with \n from a file descriptor. " alt="" coords="640,1869,717,1896"/><area shape="rect" id="node6" href="decoder_8c.html#acdc394373c1cbcfa66f99a9a4579e5c8" title="Decodes a string into a DChat header. " alt="" coords="409,1363,524,1389"/><area shape="rect" id="node5" href="log_8c.html#a38678da7483f269b8c96f83a8f45ef12" title="Log a message to a file. " alt="" coords="1141,603,1224,629"/><area shape="rect" id="node7" href="decoder_8c.html#aee415a9aa4d7252364a6aed14d8d1a50" title="Checks if the given string is terminated with &#160;&#160;or &#160;&#160;respectively. " alt="" coords="609,1337,749,1364"/><area shape="rect" id="node8" href="decoder_8c.html#aed8d6a7e8b9b368fa54d7af2f2a5231e" title="Initializes a DChat V1 structure containing all available and supported headers of the DChat V1 proto..." alt="" coords="629,1388,729,1415"/><area shape="rect" id="node9" href="decoder_8c.html#a42be8c12ff007b95a9a98175c1738d0c" title="Parses the given value to a supported version of DChat and sets, if valid, its value in the PDU struc..." alt="" coords="813,1109,923,1136"/><area shape="rect" id="node10" href="decoder_8c.html#ae08df473fb28e4f06044d50f8428eafc" title="Converts the version field in the PDU to a string and sets the address of the given value parameter t..." alt="" coords="813,1515,923,1541"/><area shape="rect" id="node11" href="decoder_8c.html#af7a1420a7b9ce8077005793d5baa48b3" title="Parses the given value to a supported content&#45;type of DChat and sets, if valid, its value in the PDU ..." alt="" coords="815,1160,921,1187"/><area shape="rect" id="node12" href="decoder_8c.html#a9ba39a2b36836a7dc2dbe548cd02c21f" title="Converts the content&#45;type field in the PDU to a string and sets the address of the given value parame..." alt="" coords="815,1565,921,1592"/><area shape="rect" id="node13" href="decoder_8c.html#a186b736b428ee1ba79bc538a560a9e28" title="Parses the given value to a content&#45;length and sets its value, if valid, in the given PDU structure..." alt="" coords="815,1211,921,1237"/><area shape="rect" id="node14" href="decoder_8c.html#aa34bd8632014a3a135df77c5786bda6d" title="Converts the content&#45;length field in the PDU to a string and sets the address of the given value para..." alt="" coords="815,1616,921,1643"/><area shape="rect" id="node15" href="decoder_8c.html#ace47761936ccffbfbac61e6905d8333d" title="Parses the given value to an onion address and sets its value , if valid, in the given PDU structure..." alt="" coords="813,1008,923,1035"/><area shape="rect" id="node17" href="decoder_8c.html#a019debfd4003c322fba5003b6c191129" title="Converts the onion&#45;id field in the PDU to a string and sets the address of the given value parameter ..." alt="" coords="813,1261,923,1288"/><area shape="rect" id="node18" href="decoder_8c.html#a93c5fb5eadf28693c56b187748a284b9" title="Parses the given value to a listening port and sets its value, if valid, in the given PDU structure..." alt="" coords="813,1312,923,1339"/><area shape="rect" id="node20" href="decoder_8c.html#ac89711a42de87d7b24f7e598b0167f85" title="Converts the listening&#45;port field in the PDU to a string and sets the address of the given value para..." alt="" coords="813,1413,923,1440"/><area shape="rect" id="node21" href="decoder_8c.html#a8a21bca3a0374aeda651aba069d0bfb4" title="Parses the given value to a nickname and sets its value, if valid, in the given PDU structure..." alt="" coords="813,1363,923,1389"/><area shape="rect" id="node22" href="decoder_8c.html#a5f3472fbd176480725e69578245d3c61" title="Converts the nickname field in the PDU to a string and sets the address of the given value parameter ..." alt="" coords="813,1667,923,1693"/><area shape="rect" id="node23" href="decoder_8c.html#ad1fb16f98ba7cba1d0e8394a0a825214" title="Parses the given value to a struct tm and sets its value, if valid, in the given PDU structure..." alt="" coords="813,1059,923,1085"/><area shape="rect" id="node24" href="decoder_8c.html#ab124906e75a01fb9448bf33eac5906da" title="Converts the sent field in the PDU to a string and sets the address of the given value parameter to t..." alt="" coords="813,1717,923,1744"/><area shape="rect" id="node25" href="decoder_8c.html#aa8ff1abc0a14ba58a3c7bfd5cc81fc1f" title="Parses the given value to a server field and sets its value, if valid, in the given PDU structure..." alt="" coords="813,1768,923,1795"/><area shape="rect" id="node26" href="decoder_8c.html#affa9e2c054d9f619c3cf426a4a2ed9c7" title="Converts the server field in the PDU to a string and sets the address of the given value parameter to..." alt="" coords="813,1464,923,1491"/><area shape="rect" id="node16" href="network_8c.html#a139629f69df293ba1da88fea96af5e5e" title="Checks wether the given onion&#45;id is a valid onion address. " alt="" coords="987,957,1093,984"/><area shape="rect" id="node19" href="network_8c.html#a53aa686284d28600afef0e06d7ab3d54" title="Checks wether the given port is a valid TCP port. " alt="" coords="991,1160,1089,1187"/><area shape="rect" id="node29" href="log_8c.html#aadc76aa2a75bd302883a2bb571a42033" title="Returns the ansi escape code string for clearing the current line in a terminal. " alt="" coords="411,195,522,221"/><area shape="rect" id="node30" href="log_8c.html#ae3ea2f374cda4c473cbd22f83dc6b64f" title="Retruns the ansi escape code string for carriage return . " alt="" coords="434,43,499,69"/><area shape="rect" id="node31" href="log_8c.html#a422252d31fec52cb84c60fc0c18bd93e" title="Returns the ansi escape code string for bold cyan color. " alt="" coords="391,93,542,120"/><area shape="rect" id="node32" href="log_8c.html#a18901a0772a8dd71781402b41579ec95" title="Returns the ansi escape code string for resetting attributes. " alt="" coords="394,144,539,171"/><area shape="rect" id="node34" href="contact_8c.html#a01eb319ee1d229714b6a20e144181a1a" title="Searches a contact in the local contactlist. " alt="" coords="420,755,513,781"/><area shape="rect" id="node35" href="contact_8c.html#ac15f4eb395316547db5ceba947a2f3b9" title="Converts a contact into a string. " alt="" coords="806,907,930,933"/><area shape="rect" id="node37" href="contact_8c.html#a0de7073d40f7447f933e334054d432d8" title="Resizes the contactlist. " alt="" coords="804,501,932,528"/><area shape="rect" id="node39" href="decoder_8c.html#ab4502d6fa3578ce5f3b4a92e5489c978" title="Extracts a fraction of the content. " alt="" coords="807,856,929,883"/><area shape="rect" id="node40" href="contact_8c.html#a5fc6d1fda23da9c12247773139cc9c74" title="Converts a string into a contact. " alt="" coords="806,451,930,477"/><area shape="rect" id="node41" href="dchat_8c.html#ae2c246a2244b6435d0b307f0e893b0c6" title="Handles local connection requests from the user. " alt="" coords="374,653,559,680"/><area shape="rect" id="node42" href="network_8c.html#abd951e9fd43b0ec9248ca6ec43398c6b" title="Creates a TOR socket. " alt="" coords="615,653,743,680"/><area shape="rect" id="node44" href="log_8c.html#aba81f1b639baac0f96848d9cb3a3b207" title="Log a message together with a string representation of errno as error. " alt="" coords="1001,603,1079,629"/><area shape="rect" id="node48" href="contact_8c.html#a6777b1a477207c7bbc9e560cf9caabed" title="Adds a new contact to the local contactlist. " alt="" coords="631,501,726,528"/><area shape="rect" id="node49" href="contact_8c.html#a625b0742c9e1cbd35146d35ecbf25282" title="Sends local contactlist to a contact. " alt="" coords="625,780,733,807"/><area shape="rect" id="node43" href="network_8c.html#a77de9c9eb5a8ea2a6da108270bd7417e" title="Connects to a remote socket using the given socket address. " alt="" coords="825,603,911,629"/><area shape="rect" id="node45" href="network_8c.html#abd49b4a8eb0f62dc3be6755729d672b8" title="Writes a SOCKS PDU to the given socket. " alt="" coords="815,704,921,731"/><area shape="rect" id="node46" href="network_8c.html#a0ace1062fab444c73177e0552e019425" title="Reads a SOCKS response PDU from the given socket. " alt="" coords="815,755,921,781"/><area shape="rect" id="node47" href="network_8c.html#abd3d58b10c19c6d550b6e6aa86c9dc5c" title="Parses given status and returns its corresponding status message. " alt="" coords="798,805,938,832"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a2933fe4bc8ee9a166f16bfedc289c200"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int init_global_config </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdchat__conf.html">dchat_conf_t</a> *&#160;</td>
          <td class="paramname"><em>cnf</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes basic fields of the global dchat configuration. </p>
<p>Input and output filedescriptor as well as initial values of the contactlist will be set. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cnf</td><td>Pointer to global config </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, -1 in case of error </dd></dl>

<p>Definition at line <a class="el" href="dchat_8c_source.html#l00257">257</a> of file <a class="el" href="dchat_8c_source.html">dchat.c</a>.</p>

</div>
</div>
<a class="anchor" id="a2e6eac0d08a08fc6a415f2b341f54719"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int init_listening </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdchat__conf.html">dchat_conf_t</a> *&#160;</td>
          <td class="paramname"><em>cnf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>address</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes the listening socket. </p>
<p>Binds to a socket address, creates a listening socket for this interface and the given port stored in the global dchat config. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cnf</td><td>Pointer to global configuration structure </td></tr>
    <tr><td class="paramname">address</td><td>IP Address for listening </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>socket descriptor or -1 if an error occurs </dd></dl>

<p>Definition at line <a class="el" href="dchat_8c_source.html#l00277">277</a> of file <a class="el" href="dchat_8c_source.html">dchat.c</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dchat_8c_a2e6eac0d08a08fc6a415f2b341f54719_cgraph.png" border="0" usemap="#dchat_8c_a2e6eac0d08a08fc6a415f2b341f54719_cgraph" alt=""/></div>
<map name="dchat_8c_a2e6eac0d08a08fc6a415f2b341f54719_cgraph" id="dchat_8c_a2e6eac0d08a08fc6a415f2b341f54719_cgraph">
<area shape="rect" id="node2" href="log_8c.html#a021b18b681712d42cb07c99171691a84" title="Log a message. " alt="" coords="153,5,225,32"/><area shape="rect" id="node4" href="log_8c.html#aba81f1b639baac0f96848d9cb3a3b207" title="Log a message together with a string representation of errno as error. " alt="" coords="150,56,229,83"/><area shape="rect" id="node3" href="log_8c.html#a38678da7483f269b8c96f83a8f45ef12" title="Log a message to a file. " alt="" coords="277,31,360,57"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a583f39d55fad939e8a234407340e92ca"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int init_threads </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdchat__conf.html">dchat_conf_t</a> *&#160;</td>
          <td class="paramname"><em>cnf</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes neccessary internal ressources like threads and pipes. </p>
<p>Initializes pipes and threads used for parallel processing of user input and handling data from a remote client and installs a signal handler to catch basic termination signals for proper program termination. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cnf</td><td>The global dchat config </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on successful initialization, -1 in case of error </dd></dl>

<p>Definition at line <a class="el" href="dchat_8c_source.html#l00351">351</a> of file <a class="el" href="dchat_8c_source.html">dchat.c</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dchat_8c_a583f39d55fad939e8a234407340e92ca_cgraph.png" border="0" usemap="#dchat_8c_a583f39d55fad939e8a234407340e92ca_cgraph" alt=""/></div>
<map name="dchat_8c_a583f39d55fad939e8a234407340e92ca_cgraph" id="dchat_8c_a583f39d55fad939e8a234407340e92ca_cgraph">
<area shape="rect" id="node2" href="dchat_8c.html#a7fbc5e4f614e5e82b3a1fc5224f1855a" title="Signal handler function used for termination. " alt="" coords="157,816,235,843"/><area shape="rect" id="node6" href="log_8c.html#aba81f1b639baac0f96848d9cb3a3b207" title="Log a message together with a string representation of errno as error. " alt="" coords="1321,1221,1399,1248"/><area shape="rect" id="node8" href="dchat_8c.html#a20c922556a3f5ba773faf2b38fc16750" title="Thread function that reads an onion address from a pipe and connects to this address. " alt="" coords="513,107,615,133"/><area shape="rect" id="node31" href="dchat_8c.html#a39d1655c3815d6db5026c52870b45776" title="Main chat loop of this client. " alt="" coords="145,385,247,412"/><area shape="rect" id="node3" href="dchat_8c.html#a103bc702ed34e7ba88e166b169cfe464" title="Frees all global config resources used. " alt="" coords="531,1019,597,1045"/><area shape="rect" id="node4" href="log_8c.html#aadc76aa2a75bd302883a2bb571a42033" title="Returns the ansi escape code string for clearing the current line in a terminal. " alt="" coords="713,1019,823,1045"/><area shape="rect" id="node5" href="log_8c.html#ae3ea2f374cda4c473cbd22f83dc6b64f" title="Retruns the ansi escape code string for carriage return . " alt="" coords="735,968,801,995"/><area shape="rect" id="node7" href="log_8c.html#a38678da7483f269b8c96f83a8f45ef12" title="Log a message to a file. " alt="" coords="1637,461,1720,488"/><area shape="rect" id="node9" href="dchat_8c.html#a297b3a9a3e921bc25e5559de4c7dcaea" title="Cleanup ressources used by the thread conn_th holded by the global config. " alt="" coords="690,56,846,83"/><area shape="rect" id="node10" href="log_8c.html#a021b18b681712d42cb07c99171691a84" title="Log a message. " alt="" coords="1324,360,1396,387"/><area shape="rect" id="node11" href="dchat_8c.html#ae2c246a2244b6435d0b307f0e893b0c6" title="Handles local connection requests from the user. " alt="" coords="675,621,861,648"/><area shape="rect" id="node12" href="network_8c.html#abd951e9fd43b0ec9248ca6ec43398c6b" title="Creates a TOR socket. " alt="" coords="912,917,1040,944"/><area shape="rect" id="node17" href="contact_8c.html#a6777b1a477207c7bbc9e560cf9caabed" title="Adds a new contact to the local contactlist. " alt="" coords="929,596,1023,623"/><area shape="rect" id="node20" href="contact_8c.html#a625b0742c9e1cbd35146d35ecbf25282" title="Sends local contactlist to a contact. " alt="" coords="922,647,1030,673"/><area shape="rect" id="node13" href="network_8c.html#a77de9c9eb5a8ea2a6da108270bd7417e" title="Connects to a remote socket using the given socket address. " alt="" coords="1118,1069,1205,1096"/><area shape="rect" id="node14" href="network_8c.html#abd49b4a8eb0f62dc3be6755729d672b8" title="Writes a SOCKS PDU to the given socket. " alt="" coords="1108,867,1215,893"/><area shape="rect" id="node15" href="network_8c.html#a0ace1062fab444c73177e0552e019425" title="Reads a SOCKS response PDU from the given socket. " alt="" coords="1109,917,1214,944"/><area shape="rect" id="node16" href="network_8c.html#abd3d58b10c19c6d550b6e6aa86c9dc5c" title="Parses given status and returns its corresponding status message. " alt="" coords="1091,968,1231,995"/><area shape="rect" id="node18" href="contact_8c.html#a0de7073d40f7447f933e334054d432d8" title="Resizes the contactlist. " alt="" coords="1097,664,1225,691"/><area shape="rect" id="node19" href="log_8c.html#a677da14e8c4326bde43622f233f1ead3" title="Prints an error message and terminates this program. " alt="" coords="1515,461,1562,488"/><area shape="rect" id="node21" href="decoder_8c.html#abaf80c220fd915287452a6baa5b05e2e" title="Initializes a DChat PDU with the given values. " alt="" coords="1107,715,1216,741"/><area shape="rect" id="node27" href="contact_8c.html#ac15f4eb395316547db5ceba947a2f3b9" title="Converts a contact into a string. " alt="" coords="1099,765,1223,792"/><area shape="rect" id="node28" href="decoder_8c.html#af4aaf258b8866187ed65d6d1c23083cb" title="Converts a PDU to a string that will be written to a file descriptor. " alt="" coords="1121,5,1201,32"/><area shape="rect" id="node22" href="decoder_8c.html#a8a64791a4f610ecaff285d91512ea927" title="Checks if the given version is a valid and supported DChat version. " alt="" coords="1301,563,1419,589"/><area shape="rect" id="node23" href="decoder_8c.html#a2960a3c598ee607801fc333b5d1cfce9" title="Checks if the given Content&#45;Type number is a valid DChat Content&#45;Type. " alt="" coords="1285,613,1435,640"/><area shape="rect" id="node24" href="network_8c.html#a139629f69df293ba1da88fea96af5e5e" title="Checks wether the given onion&#45;id is a valid onion address. " alt="" coords="1307,816,1413,843"/><area shape="rect" id="node25" href="network_8c.html#a53aa686284d28600afef0e06d7ab3d54" title="Checks wether the given port is a valid TCP port. " alt="" coords="1311,765,1409,792"/><area shape="rect" id="node26" href="decoder_8c.html#a338364bcfd88f32a9b162c4e12bd3cad" title="Checks if the given nickname is a valid DChat nickname. " alt="" coords="1295,664,1425,691"/><area shape="rect" id="node29" href="decoder_8c.html#aed8d6a7e8b9b368fa54d7af2f2a5231e" title="Initializes a DChat V1 structure containing all available and supported headers of the DChat V1 proto..." alt="" coords="1489,56,1589,83"/><area shape="rect" id="node30" href="decoder_8c.html#a92bdcc4d06ae8c3fb41f6f0489a44891" title="Crafts a DChat header string. " alt="" coords="1303,56,1417,83"/><area shape="rect" id="node32" href="dchat_8c.html#ab40992a684f2718a616237fd50fe9be5" title="Cleanup ressources used by the thread select_th holded by the global config. " alt="" coords="297,309,453,336"/><area shape="rect" id="node33" href="util_8c.html#af082905f7eac6d03e92015146bbc1925" title="Define the maximum of two given integers. " alt="" coords="351,411,398,437"/><area shape="rect" id="node34" href="dchat_8c.html#af26d1f15348f568261ddb15d886dbaff" title="Handles local user input. " alt="" coords="909,157,1043,184"/><area shape="rect" id="node39" href="dchat_8c.html#a5c79a63478c0df6d16f70940e53338d1" title="Handles connection requests from a remote client. " alt="" coords="695,555,841,597"/><area shape="rect" id="node40" href="dchat_8c.html#a2cbf2aad21d016dd4852369423d86270" title="Handles PDUs received from a remote client. " alt="" coords="301,461,448,488"/><area shape="rect" id="node49" href="contact_8c.html#a56a9992b188f855108c72588953fe8a6" title="Deletes a contact from the local contactlist. " alt="" coords="931,309,1021,336"/><area shape="rect" id="node35" href="cmdinterpreter_8c.html#a2fa3c6d0d37d8092bb7065361ac25bd0" title="Parses the given string and executes it if it is a command. " alt="" coords="1117,56,1205,83"/><area shape="rect" id="node37" href="decoder_8c.html#ac0e7619d80bc7c53c88b1e893eb00df5" title="Initializes the content of a DChat PDU with the given value. " alt="" coords="1280,296,1440,323"/><area shape="rect" id="node38" href="decoder_8c.html#ade270b4d1100adbdffbb22fdd5635737" title="Frees all resources dynamically allocated for a PDU structure. " alt="" coords="1124,259,1199,285"/><area shape="rect" id="node36" href="cmdinterpreter_8c.html#a910a5c62ab4a4c2976b6892e8c5e7cac" title="Initializes a commands structure with all available in&#45;chat commands and its executable functions..." alt="" coords="1321,157,1399,184"/><area shape="rect" id="node41" href="decoder_8c.html#ac5566b29faaf60fb8c68a3d97d3fadc3" title="Read a whole DChat PDU from a file descriptor. " alt="" coords="1122,613,1201,640"/><area shape="rect" id="node44" href="log_8c.html#ab43cc6f8c6c043d052ebcfebd33023e9" title="Prints a chat message to a file descriptor. " alt="" coords="504,917,624,944"/><area shape="rect" id="node47" href="contact_8c.html#aa0681254b16e6d20d63a03aed84c12e2" title="Checks the local contactlist for duplicates. " alt="" coords="502,612,626,639"/><area shape="rect" id="node50" href="contact_8c.html#a2161fbd1e0fc61c762f08bb102e54ab8" title="Contacts transferred via PDU will be added to the contactlist. " alt="" coords="503,528,625,555"/><area shape="rect" id="node42" href="decoder_8c.html#a9a4f2d2d79d140c5d1bcb5be3bc82e0e" title="Read a line terminated with \n from a file descriptor. " alt="" coords="1321,461,1399,488"/><area shape="rect" id="node43" href="decoder_8c.html#acdc394373c1cbcfa66f99a9a4579e5c8" title="Decodes a string into a DChat header. " alt="" coords="1303,411,1417,437"/><area shape="rect" id="node45" href="log_8c.html#a422252d31fec52cb84c60fc0c18bd93e" title="Returns the ansi escape code string for bold cyan color. " alt="" coords="693,917,843,944"/><area shape="rect" id="node46" href="log_8c.html#a18901a0772a8dd71781402b41579ec95" title="Returns the ansi escape code string for resetting attributes. " alt="" coords="695,867,841,893"/><area shape="rect" id="node48" href="contact_8c.html#a01eb319ee1d229714b6a20e144181a1a" title="Searches a contact in the local contactlist. " alt="" coords="721,672,815,699"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a7fbc5e4f614e5e82b3a1fc5224f1855a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void terminate </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>sig</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Signal handler function used for termination. </p>
<p>Signal handler function that will free all used resources like file descriptors, pipes, etc. and that terminates this process afterwards. This function will be called whenever this program should terminate (e.g SIGTERM, SIGQUIT, ...) or on EOF of stdin. Exit status of the process will be EXIT_SUCCESS </p><dl class="section see"><dt>See also</dt><dd><a class="el" href="dchat_8c.html#a103bc702ed34e7ba88e166b169cfe464" title="Frees all global config resources used. ">destroy()</a> </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sig</td><td>Type of signal (e.g SIGTERM, SIGQUIT, ...) </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="dchat_8c_source.html#l00465">465</a> of file <a class="el" href="dchat_8c_source.html">dchat.c</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dchat_8c_a7fbc5e4f614e5e82b3a1fc5224f1855a_cgraph.png" border="0" usemap="#dchat_8c_a7fbc5e4f614e5e82b3a1fc5224f1855a_cgraph" alt=""/></div>
<map name="dchat_8c_a7fbc5e4f614e5e82b3a1fc5224f1855a_cgraph" id="dchat_8c_a7fbc5e4f614e5e82b3a1fc5224f1855a_cgraph">
<area shape="rect" id="node2" href="dchat_8c.html#a103bc702ed34e7ba88e166b169cfe464" title="Frees all global config resources used. " alt="" coords="131,31,197,57"/><area shape="rect" id="node3" href="log_8c.html#aadc76aa2a75bd302883a2bb571a42033" title="Returns the ansi escape code string for clearing the current line in a terminal. " alt="" coords="246,5,357,32"/><area shape="rect" id="node4" href="log_8c.html#ae3ea2f374cda4c473cbd22f83dc6b64f" title="Retruns the ansi escape code string for carriage return . " alt="" coords="269,56,334,83"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a39d1655c3815d6db5026c52870b45776"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* th_main_loop </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdchat__conf.html">dchat_conf_t</a> *&#160;</td>
          <td class="paramname"><em>cnf</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Main chat loop of this client. </p>
<p>This function is the main loop of DChat that selects(2) certain file descriptors stored in the global configuration to read from. It waits for local userinput, PDUs from remote clients, local connection requests and remote connection requests. If select returns and a file descriptor can be read, this function will take action depending on which file descriptor is able to read from. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cnf</td><td>Pointer to global config holding all kind of file descriptors </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="dchat_8c_source.html#l00953">953</a> of file <a class="el" href="dchat_8c_source.html">dchat.c</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dchat_8c_a39d1655c3815d6db5026c52870b45776_cgraph.png" border="0" usemap="#dchat_8c_a39d1655c3815d6db5026c52870b45776_cgraph" alt=""/></div>
<map name="dchat_8c_a39d1655c3815d6db5026c52870b45776_cgraph" id="dchat_8c_a39d1655c3815d6db5026c52870b45776_cgraph">
<area shape="rect" id="node2" href="dchat_8c.html#ab40992a684f2718a616237fd50fe9be5" title="Cleanup ressources used by the thread select_th holded by the global config. " alt="" coords="158,5,314,32"/><area shape="rect" id="node3" href="util_8c.html#af082905f7eac6d03e92015146bbc1925" title="Define the maximum of two given integers. " alt="" coords="213,56,259,83"/><area shape="rect" id="node4" href="log_8c.html#aba81f1b639baac0f96848d9cb3a3b207" title="Log a message together with a string representation of errno as error. " alt="" coords="794,107,873,133"/><area shape="rect" id="node6" href="dchat_8c.html#af26d1f15348f568261ddb15d886dbaff" title="Handles local user input. " alt="" coords="363,464,496,491"/><area shape="rect" id="node30" href="dchat_8c.html#a5c79a63478c0df6d16f70940e53338d1" title="Handles connection requests from a remote client. " alt="" coords="564,461,711,502"/><area shape="rect" id="node35" href="dchat_8c.html#a2cbf2aad21d016dd4852369423d86270" title="Handles PDUs received from a remote client. " alt="" coords="163,1107,309,1133"/><area shape="rect" id="node46" href="contact_8c.html#a56a9992b188f855108c72588953fe8a6" title="Deletes a contact from the local contactlist. " alt="" coords="788,929,879,956"/><area shape="rect" id="node5" href="log_8c.html#a38678da7483f269b8c96f83a8f45ef12" title="Log a message to a file. " alt="" coords="1776,549,1859,576"/><area shape="rect" id="node7" href="cmdinterpreter_8c.html#a2fa3c6d0d37d8092bb7065361ac25bd0" title="Parses the given string and executes it if it is a command. " alt="" coords="593,548,681,575"/><area shape="rect" id="node10" href="log_8c.html#a021b18b681712d42cb07c99171691a84" title="Log a message. " alt="" coords="1152,853,1224,880"/><area shape="rect" id="node16" href="decoder_8c.html#abaf80c220fd915287452a6baa5b05e2e" title="Initializes a DChat PDU with the given values. " alt="" coords="945,372,1055,399"/><area shape="rect" id="node20" href="decoder_8c.html#ac0e7619d80bc7c53c88b1e893eb00df5" title="Initializes the content of a DChat PDU with the given value. " alt="" coords="1312,68,1472,95"/><area shape="rect" id="node21" href="decoder_8c.html#af4aaf258b8866187ed65d6d1c23083cb" title="Converts a PDU to a string that will be written to a file descriptor. " alt="" coords="960,321,1040,348"/><area shape="rect" id="node29" href="decoder_8c.html#ade270b4d1100adbdffbb22fdd5635737" title="Frees all resources dynamically allocated for a PDU structure. " alt="" coords="600,676,675,703"/><area shape="rect" id="node8" href="cmdinterpreter_8c.html#a910a5c62ab4a4c2976b6892e8c5e7cac" title="Initializes a commands structure with all available in&#45;chat commands and its executable functions..." alt="" coords="794,625,873,652"/><area shape="rect" id="node15" href="log_8c.html#a677da14e8c4326bde43622f233f1ead3" title="Prints an error message and terminates this program. " alt="" coords="1681,549,1727,576"/><area shape="rect" id="node9" href="cmdinterpreter_8c.html#afe98f05a74bf03fd79e915b594de9bb5" title="Prints help. " alt="" coords="962,727,1038,753"/><area shape="rect" id="node11" href="cmdinterpreter_8c.html#a81ef7494b366e90638a9cbd26a3c69c6" title="Connects to a remote host. " alt="" coords="961,524,1039,551"/><area shape="rect" id="node14" href="cmdinterpreter_8c.html#a6ca8cd86038b9b3a2bc718b17dd87c86" title="Lists alls contacts within the local contactlist. " alt="" coords="965,777,1035,804"/><area shape="rect" id="node12" href="network_8c.html#a53aa686284d28600afef0e06d7ab3d54" title="Checks wether the given port is a valid TCP port. " alt="" coords="1139,676,1237,703"/><area shape="rect" id="node13" href="network_8c.html#a139629f69df293ba1da88fea96af5e5e" title="Checks wether the given onion&#45;id is a valid onion address. " alt="" coords="1135,727,1241,753"/><area shape="rect" id="node17" href="decoder_8c.html#a8a64791a4f610ecaff285d91512ea927" title="Checks if the given version is a valid and supported DChat version. " alt="" coords="1129,372,1247,399"/><area shape="rect" id="node18" href="decoder_8c.html#a2960a3c598ee607801fc333b5d1cfce9" title="Checks if the given Content&#45;Type number is a valid DChat Content&#45;Type. " alt="" coords="1113,423,1263,449"/><area shape="rect" id="node19" href="decoder_8c.html#a338364bcfd88f32a9b162c4e12bd3cad" title="Checks if the given nickname is a valid DChat nickname. " alt="" coords="1123,473,1253,500"/><area shape="rect" id="node22" href="decoder_8c.html#aed8d6a7e8b9b368fa54d7af2f2a5231e" title="Initializes a DChat V1 structure containing all available and supported headers of the DChat V1 proto..." alt="" coords="1342,271,1442,297"/><area shape="rect" id="node28" href="decoder_8c.html#a92bdcc4d06ae8c3fb41f6f0489a44891" title="Crafts a DChat header string. " alt="" coords="1131,271,1245,297"/><area shape="rect" id="node23" href="decoder_8c.html#a42be8c12ff007b95a9a98175c1738d0c" title="Parses the given value to a supported version of DChat and sets, if valid, its value in the PDU struc..." alt="" coords="1521,220,1631,247"/><area shape="rect" id="node24" href="decoder_8c.html#ae08df473fb28e4f06044d50f8428eafc" title="Converts the version field in the PDU to a string and sets the address of the given value parameter t..." alt="" coords="1521,372,1631,399"/><area shape="rect" id="node25" href="decoder_8c.html#af7a1420a7b9ce8077005793d5baa48b3" title="Parses the given value to a supported content&#45;type of DChat and sets, if valid, its value in the PDU ..." alt="" coords="1523,271,1629,297"/><area shape="rect" id="node26" href="decoder_8c.html#a9ba39a2b36836a7dc2dbe548cd02c21f" title="Converts the content&#45;type field in the PDU to a string and sets the address of the given value parame..." alt="" coords="1523,321,1629,348"/><area shape="rect" id="node27" href="decoder_8c.html#a186b736b428ee1ba79bc538a560a9e28" title="Parses the given value to a content&#45;length and sets its value, if valid, in the given PDU structure..." alt="" coords="1523,169,1629,196"/><area shape="rect" id="node31" href="contact_8c.html#a6777b1a477207c7bbc9e560cf9caabed" title="Adds a new contact to the local contactlist. " alt="" coords="786,777,881,804"/><area shape="rect" id="node33" href="contact_8c.html#a625b0742c9e1cbd35146d35ecbf25282" title="Sends local contactlist to a contact. " alt="" coords="779,468,887,495"/><area shape="rect" id="node32" href="contact_8c.html#a0de7073d40f7447f933e334054d432d8" title="Resizes the contactlist. " alt="" coords="936,980,1064,1007"/><area shape="rect" id="node34" href="contact_8c.html#ac15f4eb395316547db5ceba947a2f3b9" title="Converts a contact into a string. " alt="" coords="938,473,1062,500"/><area shape="rect" id="node36" href="decoder_8c.html#ac5566b29faaf60fb8c68a3d97d3fadc3" title="Read a whole DChat PDU from a file descriptor. " alt="" coords="961,1233,1039,1260"/><area shape="rect" id="node39" href="log_8c.html#ab43cc6f8c6c043d052ebcfebd33023e9" title="Prints a chat message to a file descriptor. " alt="" coords="369,1107,489,1133"/><area shape="rect" id="node44" href="contact_8c.html#aa0681254b16e6d20d63a03aed84c12e2" title="Checks the local contactlist for duplicates. " alt="" coords="367,841,491,868"/><area shape="rect" id="node47" href="contact_8c.html#a2161fbd1e0fc61c762f08bb102e54ab8" title="Contacts transferred via PDU will be added to the contactlist. " alt="" coords="368,904,491,931"/><area shape="rect" id="node37" href="decoder_8c.html#a9a4f2d2d79d140c5d1bcb5be3bc82e0e" title="Read a line terminated with \n from a file descriptor. " alt="" coords="1353,1227,1431,1253"/><area shape="rect" id="node38" href="decoder_8c.html#acdc394373c1cbcfa66f99a9a4579e5c8" title="Decodes a string into a DChat header. " alt="" coords="1131,1173,1245,1200"/><area shape="rect" id="node40" href="log_8c.html#aadc76aa2a75bd302883a2bb571a42033" title="Returns the ansi escape code string for clearing the current line in a terminal. " alt="" coords="582,1081,693,1108"/><area shape="rect" id="node41" href="log_8c.html#ae3ea2f374cda4c473cbd22f83dc6b64f" title="Retruns the ansi escape code string for carriage return . " alt="" coords="605,1132,670,1159"/><area shape="rect" id="node42" href="log_8c.html#a422252d31fec52cb84c60fc0c18bd93e" title="Returns the ansi escape code string for bold cyan color. " alt="" coords="562,1183,713,1209"/><area shape="rect" id="node43" href="log_8c.html#a18901a0772a8dd71781402b41579ec95" title="Returns the ansi escape code string for resetting attributes. " alt="" coords="565,1031,710,1057"/><area shape="rect" id="node45" href="contact_8c.html#a01eb319ee1d229714b6a20e144181a1a" title="Searches a contact in the local contactlist. " alt="" coords="591,828,684,855"/><area shape="rect" id="node48" href="decoder_8c.html#ab4502d6fa3578ce5f3b4a92e5489c978" title="Extracts a fraction of the content. " alt="" coords="939,1132,1061,1159"/><area shape="rect" id="node49" href="contact_8c.html#a5fc6d1fda23da9c12247773139cc9c74" title="Converts a string into a contact. " alt="" coords="938,575,1062,601"/><area shape="rect" id="node50" href="dchat_8c.html#ae2c246a2244b6435d0b307f0e893b0c6" title="Handles local connection requests from the user. " alt="" coords="545,727,730,753"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a20c922556a3f5ba773faf2b38fc16750"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* th_new_conn </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdchat__conf.html">dchat_conf_t</a> *&#160;</td>
          <td class="paramname"><em>cnf</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Thread function that reads an onion address from a pipe and connects to this address. </p>
<p>Establishes new connections to the given addresses read from the global config pipe <code>connect_fd</code>. It reads an onion address and then connects to this address via TOR. If a connection has been established successfully, a new contact will be added and the contactlist will be sent to him. Furthermore the character '1' will be written to the global config pipe <code>cl_change</code>. </p><dl class="section see"><dt>See also</dt><dd><a class="el" href="dchat_8c.html#ae2c246a2244b6435d0b307f0e893b0c6" title="Handles local connection requests from the user. ">handle_local_conn_request()</a> </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cnf</td><td>Pointer to global config to read from the pipe connect_fd` </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="dchat_8c_source.html#l00778">778</a> of file <a class="el" href="dchat_8c_source.html">dchat.c</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dchat_8c_a20c922556a3f5ba773faf2b38fc16750_cgraph.png" border="0" usemap="#dchat_8c_a20c922556a3f5ba773faf2b38fc16750_cgraph" alt=""/></div>
<map name="dchat_8c_a20c922556a3f5ba773faf2b38fc16750_cgraph" id="dchat_8c_a20c922556a3f5ba773faf2b38fc16750_cgraph">
<area shape="rect" id="node2" href="dchat_8c.html#a297b3a9a3e921bc25e5559de4c7dcaea" title="Cleanup ressources used by the thread conn_th holded by the global config. " alt="" coords="170,5,326,32"/><area shape="rect" id="node3" href="log_8c.html#a021b18b681712d42cb07c99171691a84" title="Log a message. " alt="" coords="1288,171,1360,197"/><area shape="rect" id="node5" href="dchat_8c.html#ae2c246a2244b6435d0b307f0e893b0c6" title="Handles local connection requests from the user. " alt="" coords="155,335,341,361"/><area shape="rect" id="node4" href="log_8c.html#a38678da7483f269b8c96f83a8f45ef12" title="Log a message to a file. " alt="" coords="1453,917,1536,944"/><area shape="rect" id="node6" href="network_8c.html#abd951e9fd43b0ec9248ca6ec43398c6b" title="Creates a TOR socket. " alt="" coords="389,1171,517,1197"/><area shape="rect" id="node8" href="log_8c.html#aba81f1b639baac0f96848d9cb3a3b207" title="Log a message together with a string representation of errno as error. " alt="" coords="773,1323,851,1349"/><area shape="rect" id="node12" href="contact_8c.html#a6777b1a477207c7bbc9e560cf9caabed" title="Adds a new contact to the local contactlist. " alt="" coords="406,183,501,209"/><area shape="rect" id="node15" href="contact_8c.html#a625b0742c9e1cbd35146d35ecbf25282" title="Sends local contactlist to a contact. " alt="" coords="399,335,507,361"/><area shape="rect" id="node7" href="network_8c.html#a77de9c9eb5a8ea2a6da108270bd7417e" title="Connects to a remote socket using the given socket address. " alt="" coords="593,1221,679,1248"/><area shape="rect" id="node9" href="network_8c.html#abd49b4a8eb0f62dc3be6755729d672b8" title="Writes a SOCKS PDU to the given socket. " alt="" coords="583,1171,689,1197"/><area shape="rect" id="node10" href="network_8c.html#a0ace1062fab444c73177e0552e019425" title="Reads a SOCKS response PDU from the given socket. " alt="" coords="583,1272,689,1299"/><area shape="rect" id="node11" href="network_8c.html#abd3d58b10c19c6d550b6e6aa86c9dc5c" title="Parses given status and returns its corresponding status message. " alt="" coords="566,1120,706,1147"/><area shape="rect" id="node13" href="contact_8c.html#a0de7073d40f7447f933e334054d432d8" title="Resizes the contactlist. " alt="" coords="1067,157,1195,184"/><area shape="rect" id="node14" href="log_8c.html#a677da14e8c4326bde43622f233f1ead3" title="Prints an error message and terminates this program. " alt="" coords="1301,917,1347,944"/><area shape="rect" id="node16" href="decoder_8c.html#abaf80c220fd915287452a6baa5b05e2e" title="Initializes a DChat PDU with the given values. " alt="" coords="1076,259,1185,285"/><area shape="rect" id="node22" href="contact_8c.html#ac15f4eb395316547db5ceba947a2f3b9" title="Converts a contact into a string. " alt="" coords="1069,360,1193,387"/><area shape="rect" id="node23" href="decoder_8c.html#af4aaf258b8866187ed65d6d1c23083cb" title="Converts a PDU to a string that will be written to a file descriptor. " alt="" coords="596,791,676,817"/><area shape="rect" id="node17" href="decoder_8c.html#a8a64791a4f610ecaff285d91512ea927" title="Checks if the given version is a valid and supported DChat version. " alt="" coords="1265,297,1383,324"/><area shape="rect" id="node18" href="decoder_8c.html#a2960a3c598ee607801fc333b5d1cfce9" title="Checks if the given Content&#45;Type number is a valid DChat Content&#45;Type. " alt="" coords="1249,247,1399,273"/><area shape="rect" id="node19" href="network_8c.html#a139629f69df293ba1da88fea96af5e5e" title="Checks wether the given onion&#45;id is a valid onion address. " alt="" coords="1271,433,1377,460"/><area shape="rect" id="node20" href="network_8c.html#a53aa686284d28600afef0e06d7ab3d54" title="Checks wether the given port is a valid TCP port. " alt="" coords="1275,355,1373,381"/><area shape="rect" id="node21" href="decoder_8c.html#a338364bcfd88f32a9b162c4e12bd3cad" title="Checks if the given nickname is a valid DChat nickname. " alt="" coords="1259,532,1389,559"/><area shape="rect" id="node24" href="decoder_8c.html#aed8d6a7e8b9b368fa54d7af2f2a5231e" title="Initializes a DChat V1 structure containing all available and supported headers of the DChat V1 proto..." alt="" coords="918,765,1018,792"/><area shape="rect" id="node44" href="decoder_8c.html#a92bdcc4d06ae8c3fb41f6f0489a44891" title="Crafts a DChat header string. " alt="" coords="755,816,869,843"/><area shape="rect" id="node25" href="decoder_8c.html#a42be8c12ff007b95a9a98175c1738d0c" title="Parses the given value to a supported version of DChat and sets, if valid, its value in the PDU struc..." alt="" coords="1075,411,1186,437"/><area shape="rect" id="node26" href="decoder_8c.html#ae08df473fb28e4f06044d50f8428eafc" title="Converts the version field in the PDU to a string and sets the address of the given value parameter t..." alt="" coords="1075,968,1186,995"/><area shape="rect" id="node27" href="decoder_8c.html#af7a1420a7b9ce8077005793d5baa48b3" title="Parses the given value to a supported content&#45;type of DChat and sets, if valid, its value in the PDU ..." alt="" coords="1077,563,1184,589"/><area shape="rect" id="node29" href="decoder_8c.html#a9ba39a2b36836a7dc2dbe548cd02c21f" title="Converts the content&#45;type field in the PDU to a string and sets the address of the given value parame..." alt="" coords="1077,867,1184,893"/><area shape="rect" id="node30" href="decoder_8c.html#a186b736b428ee1ba79bc538a560a9e28" title="Parses the given value to a content&#45;length and sets its value, if valid, in the given PDU structure..." alt="" coords="1078,816,1183,843"/><area shape="rect" id="node32" href="decoder_8c.html#aa34bd8632014a3a135df77c5786bda6d" title="Converts the content&#45;length field in the PDU to a string and sets the address of the given value para..." alt="" coords="1078,917,1183,944"/><area shape="rect" id="node33" href="decoder_8c.html#ace47761936ccffbfbac61e6905d8333d" title="Parses the given value to an onion address and sets its value , if valid, in the given PDU structure..." alt="" coords="1075,461,1186,488"/><area shape="rect" id="node34" href="decoder_8c.html#a019debfd4003c322fba5003b6c191129" title="Converts the onion&#45;id field in the PDU to a string and sets the address of the given value parameter ..." alt="" coords="1075,613,1186,640"/><area shape="rect" id="node35" href="decoder_8c.html#a93c5fb5eadf28693c56b187748a284b9" title="Parses the given value to a listening port and sets its value, if valid, in the given PDU structure..." alt="" coords="1075,309,1186,336"/><area shape="rect" id="node36" href="decoder_8c.html#ac89711a42de87d7b24f7e598b0167f85" title="Converts the listening&#45;port field in the PDU to a string and sets the address of the given value para..." alt="" coords="1075,512,1186,539"/><area shape="rect" id="node37" href="decoder_8c.html#a8a21bca3a0374aeda651aba069d0bfb4" title="Parses the given value to a nickname and sets its value, if valid, in the given PDU structure..." alt="" coords="1076,664,1185,691"/><area shape="rect" id="node38" href="decoder_8c.html#a5f3472fbd176480725e69578245d3c61" title="Converts the nickname field in the PDU to a string and sets the address of the given value parameter ..." alt="" coords="1076,765,1185,792"/><area shape="rect" id="node39" href="decoder_8c.html#ad1fb16f98ba7cba1d0e8394a0a825214" title="Parses the given value to a struct tm and sets its value, if valid, in the given PDU structure..." alt="" coords="1075,715,1186,741"/><area shape="rect" id="node40" href="decoder_8c.html#ab124906e75a01fb9448bf33eac5906da" title="Converts the sent field in the PDU to a string and sets the address of the given value parameter to t..." alt="" coords="1075,1272,1186,1299"/><area shape="rect" id="node42" href="decoder_8c.html#aa8ff1abc0a14ba58a3c7bfd5cc81fc1f" title="Parses the given value to a server field and sets its value, if valid, in the given PDU structure..." alt="" coords="1075,1019,1186,1045"/><area shape="rect" id="node43" href="decoder_8c.html#affa9e2c054d9f619c3cf426a4a2ed9c7" title="Converts the server field in the PDU to a string and sets the address of the given value parameter to..." alt="" coords="1075,1069,1186,1096"/><area shape="rect" id="node28" href="decoder_8c.html#ab89ef1994dd9e9d401b4c0d5feb594b2" title="Initializes a content&#45;types structure with all available content&#45;types in DChat. " alt="" coords="1259,702,1389,743"/><area shape="rect" id="node31" href="decoder_8c.html#a4ecd7cbbbe72098afc1bd5508067d8e4" title="Checks if the given Content&#45;Length is a valid DChat Content&#45;Length. " alt="" coords="1243,841,1405,868"/><area shape="rect" id="node41" href="util_8c.html#a14252469532ecf356f22412644467eba" title="Checks wether n successive bytes in the memory pointed by ptr are 0. " alt="" coords="1295,1272,1353,1299"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a0a9fd273c9490e8cf99a08da3cfab690"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int th_new_input </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdchat__conf.html">dchat_conf_t</a> *&#160;</td>
          <td class="paramname"><em>cnf</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Thread function that reads from stdin until the user hits enter. </p>
<p>Waits for new user input on stdin using GNU readline. If the user has entered something, it will be written to the global config pipe <code>user_input</code>. First the length (int) of the string will be written to the pipe and then each byte of the string. On EOF of stdin 0 will be written </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cnf</td><td>Pointer to global config to write to the pipe <code>user_input</code> </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, -1 in case of error </dd></dl>

<p>Definition at line <a class="el" href="dchat_8c_source.html#l00849">849</a> of file <a class="el" href="dchat_8c_source.html">dchat.c</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dchat_8c_a0a9fd273c9490e8cf99a08da3cfab690_cgraph.png" border="0" usemap="#dchat_8c_a0a9fd273c9490e8cf99a08da3cfab690_cgraph" alt=""/></div>
<map name="dchat_8c_a0a9fd273c9490e8cf99a08da3cfab690_cgraph" id="dchat_8c_a0a9fd273c9490e8cf99a08da3cfab690_cgraph">
<area shape="rect" id="node2" href="log_8c.html#acda96afe4e46122c63830a774a5d1e1f" title="Returns the ansi escape code string for bold yellow color. " alt="" coords="155,5,315,32"/><area shape="rect" id="node3" href="log_8c.html#a18901a0772a8dd71781402b41579ec95" title="Returns the ansi escape code string for resetting attributes. " alt="" coords="162,56,307,83"/></map>
</div>
</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dchat_8c.html">dchat.c</a></li>
    <li class="footer">Generated on Tue Aug 12 2014 19:39:08 for DChat by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.7 </li>
  </ul>
</div>
</body>
</html>
