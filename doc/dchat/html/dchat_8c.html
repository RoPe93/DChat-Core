<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.7"/>
<title>DChat: src/dchat.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">DChat
   &#160;<span id="projectnumber">0.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.7 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('dchat_8c.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">dchat.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>This file is the main file for DChat and contains, besides the main function, several core functions.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdint.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;stdarg.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;arpa/inet.h&gt;</code><br />
<code>#include &lt;errno.h&gt;</code><br />
<code>#include &lt;netinet/in.h&gt;</code><br />
<code>#include &lt;pthread.h&gt;</code><br />
<code>#include &lt;readline/readline.h&gt;</code><br />
<code>#include &lt;sys/select.h&gt;</code><br />
<code>#include &lt;sys/socket.h&gt;</code><br />
<code>#include &lt;signal.h&gt;</code><br />
<code>#include &lt;unistd.h&gt;</code><br />
<code>#include &lt;getopt.h&gt;</code><br />
<code>#include &quot;dchat_h/dchat.h&quot;</code><br />
<code>#include &quot;dchat_h/types.h&quot;</code><br />
<code>#include &quot;dchat_h/decoder.h&quot;</code><br />
<code>#include &quot;dchat_h/contact.h&quot;</code><br />
<code>#include &quot;dchat_h/cmdinterpreter.h&quot;</code><br />
<code>#include &quot;dchat_h/network.h&quot;</code><br />
<code>#include &quot;dchat_h/log.h&quot;</code><br />
<code>#include &quot;dchat_h/util.h&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for dchat.c:</div>
<div class="dyncontent">
<div class="center"><img src="dchat_8c__incl.png" border="0" usemap="#src_2dchat_8c" alt=""/></div>
<map name="src_2dchat_8c" id="src_2dchat_8c">
<area shape="rect" id="node17" href="dchat_8h_source.html" title="dchat_h/dchat.h" alt="" coords="303,80,420,107"/><area shape="rect" id="node18" href="types_8h_source.html" title="types.h" alt="" coords="682,155,747,181"/><area shape="rect" id="node19" href="network_8h_source.html" title="network.h" alt="" coords="423,229,503,256"/><area shape="rect" id="node20" href="decoder_8h_source.html" title="dchat_h/decoder.h" alt="" coords="495,80,627,107"/><area shape="rect" id="node21" href="contact_8h_source.html" title="dchat_h/contact.h" alt="" coords="651,80,777,107"/><area shape="rect" id="node22" href="cmdinterpreter_8h_source.html" title="dchat_h/cmdinterpreter.h" alt="" coords="803,80,973,107"/><area shape="rect" id="node23" href="log_8h_source.html" title="dchat_h/log.h" alt="" coords="74,80,176,107"/><area shape="rect" id="node25" href="util_8h_source.html" title="dchat_h/util.h" alt="" coords="1099,80,1200,107"/></map>
</div>
</div>
<p><a href="dchat_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a3c04138a5bfe5d72780bb7e82a18e627"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a3c04138a5bfe5d72780bb7e82a18e627"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>main</b> (int argc, char **argv)</td></tr>
<tr class="separator:a3c04138a5bfe5d72780bb7e82a18e627"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1b4978ff6c451ebbc8ac7a7340c414b7"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dchat_8c.html#a1b4978ff6c451ebbc8ac7a7340c414b7">init</a> (<a class="el" href="structdchat__conf.html">dchat_conf_t</a> *<a class="el" href="dchat_8c.html#a5497dfcbcfecec06aaf63df011c70f83">cnf</a>, struct sockaddr_storage *sa, char *onion_id, char *nickname)</td></tr>
<tr class="memdesc:a1b4978ff6c451ebbc8ac7a7340c414b7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes neccessary internal ressources like threads and pipes.  <a href="#a1b4978ff6c451ebbc8ac7a7340c414b7">More...</a><br /></td></tr>
<tr class="separator:a1b4978ff6c451ebbc8ac7a7340c414b7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4c8f7778f9d784e724e3f987cb92edd0"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dchat_8c.html#a4c8f7778f9d784e724e3f987cb92edd0">init_global_config</a> (<a class="el" href="structdchat__conf.html">dchat_conf_t</a> *<a class="el" href="dchat_8c.html#a5497dfcbcfecec06aaf63df011c70f83">cnf</a>, struct sockaddr_storage *sa, char *onion_id, char *nickname)</td></tr>
<tr class="memdesc:a4c8f7778f9d784e724e3f987cb92edd0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes the global dchat configuration.  <a href="#a4c8f7778f9d784e724e3f987cb92edd0">More...</a><br /></td></tr>
<tr class="separator:a4c8f7778f9d784e724e3f987cb92edd0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a103bc702ed34e7ba88e166b169cfe464"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dchat_8c.html#a103bc702ed34e7ba88e166b169cfe464">destroy</a> (<a class="el" href="structdchat__conf.html">dchat_conf_t</a> *<a class="el" href="dchat_8c.html#a5497dfcbcfecec06aaf63df011c70f83">cnf</a>)</td></tr>
<tr class="memdesc:a103bc702ed34e7ba88e166b169cfe464"><td class="mdescLeft">&#160;</td><td class="mdescRight">Frees all global config resources used.  <a href="#a103bc702ed34e7ba88e166b169cfe464">More...</a><br /></td></tr>
<tr class="separator:a103bc702ed34e7ba88e166b169cfe464"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7fbc5e4f614e5e82b3a1fc5224f1855a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dchat_8c.html#a7fbc5e4f614e5e82b3a1fc5224f1855a">terminate</a> (int sig)</td></tr>
<tr class="memdesc:a7fbc5e4f614e5e82b3a1fc5224f1855a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Signal handler function used for termination.  <a href="#a7fbc5e4f614e5e82b3a1fc5224f1855a">More...</a><br /></td></tr>
<tr class="separator:a7fbc5e4f614e5e82b3a1fc5224f1855a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af26d1f15348f568261ddb15d886dbaff"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dchat_8c.html#af26d1f15348f568261ddb15d886dbaff">handle_local_input</a> (<a class="el" href="structdchat__conf.html">dchat_conf_t</a> *<a class="el" href="dchat_8c.html#a5497dfcbcfecec06aaf63df011c70f83">cnf</a>, char *line)</td></tr>
<tr class="memdesc:af26d1f15348f568261ddb15d886dbaff"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles local user input.  <a href="#af26d1f15348f568261ddb15d886dbaff">More...</a><br /></td></tr>
<tr class="separator:af26d1f15348f568261ddb15d886dbaff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2cbf2aad21d016dd4852369423d86270"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dchat_8c.html#a2cbf2aad21d016dd4852369423d86270">handle_remote_input</a> (<a class="el" href="structdchat__conf.html">dchat_conf_t</a> *<a class="el" href="dchat_8c.html#a5497dfcbcfecec06aaf63df011c70f83">cnf</a>, int n)</td></tr>
<tr class="memdesc:a2cbf2aad21d016dd4852369423d86270"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles PDUs received from a remote client.  <a href="#a2cbf2aad21d016dd4852369423d86270">More...</a><br /></td></tr>
<tr class="separator:a2cbf2aad21d016dd4852369423d86270"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae2c246a2244b6435d0b307f0e893b0c6"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dchat_8c.html#ae2c246a2244b6435d0b307f0e893b0c6">handle_local_conn_request</a> (<a class="el" href="structdchat__conf.html">dchat_conf_t</a> *<a class="el" href="dchat_8c.html#a5497dfcbcfecec06aaf63df011c70f83">cnf</a>, char *onion_id, uint16_t port)</td></tr>
<tr class="memdesc:ae2c246a2244b6435d0b307f0e893b0c6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles local connection requests from the user.  <a href="#ae2c246a2244b6435d0b307f0e893b0c6">More...</a><br /></td></tr>
<tr class="separator:ae2c246a2244b6435d0b307f0e893b0c6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5c79a63478c0df6d16f70940e53338d1"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dchat_8c.html#a5c79a63478c0df6d16f70940e53338d1">handle_remote_conn_request</a> (<a class="el" href="structdchat__conf.html">dchat_conf_t</a> *<a class="el" href="dchat_8c.html#a5497dfcbcfecec06aaf63df011c70f83">cnf</a>)</td></tr>
<tr class="memdesc:a5c79a63478c0df6d16f70940e53338d1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles connection requests from a remote client.  <a href="#a5c79a63478c0df6d16f70940e53338d1">More...</a><br /></td></tr>
<tr class="separator:a5c79a63478c0df6d16f70940e53338d1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a297b3a9a3e921bc25e5559de4c7dcaea"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dchat_8c.html#a297b3a9a3e921bc25e5559de4c7dcaea">cleanup_th_new_conn</a> (void *arg)</td></tr>
<tr class="memdesc:a297b3a9a3e921bc25e5559de4c7dcaea"><td class="mdescLeft">&#160;</td><td class="mdescRight">Cleanup ressources used by the thread <code>conn_th</code> holded by the global config.  <a href="#a297b3a9a3e921bc25e5559de4c7dcaea">More...</a><br /></td></tr>
<tr class="separator:a297b3a9a3e921bc25e5559de4c7dcaea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a20c922556a3f5ba773faf2b38fc16750"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dchat_8c.html#a20c922556a3f5ba773faf2b38fc16750">th_new_conn</a> (<a class="el" href="structdchat__conf.html">dchat_conf_t</a> *<a class="el" href="dchat_8c.html#a5497dfcbcfecec06aaf63df011c70f83">cnf</a>)</td></tr>
<tr class="memdesc:a20c922556a3f5ba773faf2b38fc16750"><td class="mdescLeft">&#160;</td><td class="mdescRight">Thread function that reads an onion address from a pipe and connects to this address.  <a href="#a20c922556a3f5ba773faf2b38fc16750">More...</a><br /></td></tr>
<tr class="separator:a20c922556a3f5ba773faf2b38fc16750"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0a9fd273c9490e8cf99a08da3cfab690"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dchat_8c.html#a0a9fd273c9490e8cf99a08da3cfab690">th_new_input</a> (<a class="el" href="structdchat__conf.html">dchat_conf_t</a> *<a class="el" href="dchat_8c.html#a5497dfcbcfecec06aaf63df011c70f83">cnf</a>)</td></tr>
<tr class="memdesc:a0a9fd273c9490e8cf99a08da3cfab690"><td class="mdescLeft">&#160;</td><td class="mdescRight">Thread function that reads from stdin until the user hits enter.  <a href="#a0a9fd273c9490e8cf99a08da3cfab690">More...</a><br /></td></tr>
<tr class="separator:a0a9fd273c9490e8cf99a08da3cfab690"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab40992a684f2718a616237fd50fe9be5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dchat_8c.html#ab40992a684f2718a616237fd50fe9be5">cleanup_th_main_loop</a> (void *arg)</td></tr>
<tr class="memdesc:ab40992a684f2718a616237fd50fe9be5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Cleanup ressources used by the thread <code>select_th</code> holded by the global config.  <a href="#ab40992a684f2718a616237fd50fe9be5">More...</a><br /></td></tr>
<tr class="separator:ab40992a684f2718a616237fd50fe9be5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a39d1655c3815d6db5026c52870b45776"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dchat_8c.html#a39d1655c3815d6db5026c52870b45776">th_main_loop</a> (<a class="el" href="structdchat__conf.html">dchat_conf_t</a> *<a class="el" href="dchat_8c.html#a5497dfcbcfecec06aaf63df011c70f83">cnf</a>)</td></tr>
<tr class="memdesc:a39d1655c3815d6db5026c52870b45776"><td class="mdescLeft">&#160;</td><td class="mdescRight">Main chat loop of this client.  <a href="#a39d1655c3815d6db5026c52870b45776">More...</a><br /></td></tr>
<tr class="separator:a39d1655c3815d6db5026c52870b45776"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a5497dfcbcfecec06aaf63df011c70f83"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a5497dfcbcfecec06aaf63df011c70f83"></a>
<a class="el" href="structdchat__conf.html">dchat_conf_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dchat_8c.html#a5497dfcbcfecec06aaf63df011c70f83">cnf</a></td></tr>
<tr class="memdesc:a5497dfcbcfecec06aaf63df011c70f83"><td class="mdescLeft">&#160;</td><td class="mdescRight">global dchat configuration structure <br /></td></tr>
<tr class="separator:a5497dfcbcfecec06aaf63df011c70f83"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This file is the main file for DChat and contains, besides the main function, several core functions. </p>
<p>Core functions are:</p>
<p>-) Handler for accepting connections</p>
<p>-) Handler for user input</p>
<p>-) Handler for remote data</p>
<p>-) Handler for file sharing </p>

<p>Definition in file <a class="el" href="dchat_8c_source.html">dchat.c</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ab40992a684f2718a616237fd50fe9be5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void cleanup_th_main_loop </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>arg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Cleanup ressources used by the thread <code>select_th</code> holded by the global config. </p>
<p>Closes the listening port, every contact file descriptor and the reading pipe end of <code>user_input</code> and <code>cl_change</code>. </p>

<p>Definition at line <a class="el" href="dchat_8c_source.html#l00907">907</a> of file <a class="el" href="dchat_8c_source.html">dchat.c</a>.</p>

</div>
</div>
<a class="anchor" id="a297b3a9a3e921bc25e5559de4c7dcaea"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void cleanup_th_new_conn </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>arg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Cleanup ressources used by the thread <code>conn_th</code> holded by the global config. </p>
<p>Closes the reading pipe <code>connect_fd</code> and the writing pipe end of <code>cl_change</code> stored in the global config. </p>
<p>close pipes used for in <code>th_new_conn</code> </p>

<p>Definition at line <a class="el" href="dchat_8c_source.html#l00745">745</a> of file <a class="el" href="dchat_8c_source.html">dchat.c</a>.</p>

</div>
</div>
<a class="anchor" id="a103bc702ed34e7ba88e166b169cfe464"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void destroy </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdchat__conf.html">dchat_conf_t</a> *&#160;</td>
          <td class="paramname"><em>cnf</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Frees all global config resources used. </p>
<p>Closes all open file descriptors, sockets, pipes and mutexes stored within the global config. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cnf</td><td>Global dchat config </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="dchat_8c_source.html#l00414">414</a> of file <a class="el" href="dchat_8c_source.html">dchat.c</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dchat_8c_a103bc702ed34e7ba88e166b169cfe464_cgraph.png" border="0" usemap="#dchat_8c_a103bc702ed34e7ba88e166b169cfe464_cgraph" alt=""/></div>
<map name="dchat_8c_a103bc702ed34e7ba88e166b169cfe464_cgraph" id="dchat_8c_a103bc702ed34e7ba88e166b169cfe464_cgraph">
<area shape="rect" id="node2" href="log_8c.html#aadc76aa2a75bd302883a2bb571a42033" title="Returns the ansi escape code string for clearing the current line in a terminal. " alt="" coords="121,5,231,32"/><area shape="rect" id="node3" href="log_8c.html#ae3ea2f374cda4c473cbd22f83dc6b64f" title="Retruns the ansi escape code string for carriage return . " alt="" coords="143,56,209,83"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ae2c246a2244b6435d0b307f0e893b0c6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int handle_local_conn_request </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdchat__conf.html">dchat_conf_t</a> *&#160;</td>
          <td class="paramname"><em>cnf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>onion_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>port</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handles local connection requests from the user. </p>
<p>Connects to the remote client with the given onion address, who will be added as contact. This new contact will be sent that all of our known contacts as specified in the DChat protocol. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cnf</td><td>Pointer to global configuration holding the contactlist </td></tr>
    <tr><td class="paramname">onion_id</td><td>Destination onion address to connect to </td></tr>
    <tr><td class="paramname">port</td><td>Destination port to connect to </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The index where the contact has been added in the contactlist, -1 on error </dd></dl>

<p>Definition at line <a class="el" href="dchat_8c_source.html#l00664">664</a> of file <a class="el" href="dchat_8c_source.html">dchat.c</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dchat_8c_ae2c246a2244b6435d0b307f0e893b0c6_cgraph.png" border="0" usemap="#dchat_8c_ae2c246a2244b6435d0b307f0e893b0c6_cgraph" alt=""/></div>
<map name="dchat_8c_ae2c246a2244b6435d0b307f0e893b0c6_cgraph" id="dchat_8c_ae2c246a2244b6435d0b307f0e893b0c6_cgraph">
<area shape="rect" id="node2" href="log_8c.html#a447124894e44d19ff906633927930c19" title="Log a message together with a string representation of errno as error. " alt="" coords="241,5,319,32"/><area shape="rect" id="node3" href="log_8c.html#a021b18b681712d42cb07c99171691a84" title="Log a message. " alt="" coords="368,5,440,32"/><area shape="rect" id="node4" href="log_8c.html#ac74eb6bdf382e22aec6303d2a1ea5802" title="Log a message to a file. " alt="" coords="488,5,571,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="af26d1f15348f568261ddb15d886dbaff"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int handle_local_input </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdchat__conf.html">dchat_conf_t</a> *&#160;</td>
          <td class="paramname"><em>cnf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>line</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handles local user input. </p>
<p>Interpretes the given line and reacts correspondently to it. If the line is a command it will be executed, otherwise it will be treated as text message and send to all known contacts stored in the contactlist in the global configuration. </p><dl class="section see"><dt>See also</dt><dd>write_pdu() </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cnf</td><td>Pointer to global configuration </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, -1 on error </dd></dl>

<p>Definition at line <a class="el" href="dchat_8c_source.html#l00467">467</a> of file <a class="el" href="dchat_8c_source.html">dchat.c</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dchat_8c_af26d1f15348f568261ddb15d886dbaff_cgraph.png" border="0" usemap="#dchat_8c_af26d1f15348f568261ddb15d886dbaff_cgraph" alt=""/></div>
<map name="dchat_8c_af26d1f15348f568261ddb15d886dbaff_cgraph" id="dchat_8c_af26d1f15348f568261ddb15d886dbaff_cgraph">
<area shape="rect" id="node2" href="log_8c.html#a021b18b681712d42cb07c99171691a84" title="Log a message. " alt="" coords="187,5,259,32"/><area shape="rect" id="node3" href="log_8c.html#ac74eb6bdf382e22aec6303d2a1ea5802" title="Log a message to a file. " alt="" coords="307,5,389,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a5c79a63478c0df6d16f70940e53338d1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int handle_remote_conn_request </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdchat__conf.html">dchat_conf_t</a> *&#160;</td>
          <td class="paramname"><em>cnf</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handles connection requests from a remote client. </p>
<p>Accepts a connection from a remote client and so that a new chat session will be established between this and the remote host. Moreover the remote host will be added as new contact in the contactlist and the local contactlist will be sent to him. </p><dl class="section see"><dt>See also</dt><dd>add_contact() </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cnf</td><td>Pointer to global configuration </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>return value of function add_contact, or -1 on error </dd></dl>

<p>Definition at line <a class="el" href="dchat_8c_source.html#l00709">709</a> of file <a class="el" href="dchat_8c_source.html">dchat.c</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dchat_8c_a5c79a63478c0df6d16f70940e53338d1_cgraph.png" border="0" usemap="#dchat_8c_a5c79a63478c0df6d16f70940e53338d1_cgraph" alt=""/></div>
<map name="dchat_8c_a5c79a63478c0df6d16f70940e53338d1_cgraph" id="dchat_8c_a5c79a63478c0df6d16f70940e53338d1_cgraph">
<area shape="rect" id="node2" href="log_8c.html#a447124894e44d19ff906633927930c19" title="Log a message together with a string representation of errno as error. " alt="" coords="201,5,279,32"/><area shape="rect" id="node3" href="log_8c.html#a021b18b681712d42cb07c99171691a84" title="Log a message. " alt="" coords="328,31,400,57"/><area shape="rect" id="node4" href="log_8c.html#ac74eb6bdf382e22aec6303d2a1ea5802" title="Log a message to a file. " alt="" coords="448,31,531,57"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a2cbf2aad21d016dd4852369423d86270"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int handle_remote_input </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdchat__conf.html">dchat_conf_t</a> *&#160;</td>
          <td class="paramname"><em>cnf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>n</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handles PDUs received from a remote client. </p>
<p>Reads in a PDU from a certain contact file descriptor and interpretes its headers and handles its content. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cnf</td><td>Pointer to global configuration holding the contactlist </td></tr>
    <tr><td class="paramname">n</td><td>Index of contact in the respective contactlist </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>length of bytes read, 0 on EOF or -1 in case of error </dd></dl>

<p>Definition at line <a class="el" href="dchat_8c_source.html#l00522">522</a> of file <a class="el" href="dchat_8c_source.html">dchat.c</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dchat_8c_a2cbf2aad21d016dd4852369423d86270_cgraph.png" border="0" usemap="#dchat_8c_a2cbf2aad21d016dd4852369423d86270_cgraph" alt=""/></div>
<map name="dchat_8c_a2cbf2aad21d016dd4852369423d86270_cgraph" id="dchat_8c_a2cbf2aad21d016dd4852369423d86270_cgraph">
<area shape="rect" id="node2" href="log_8c.html#a021b18b681712d42cb07c99171691a84" title="Log a message. " alt="" coords="224,5,296,32"/><area shape="rect" id="node4" href="log_8c.html#a677da14e8c4326bde43622f233f1ead3" title="Prints an error message and terminates this program. " alt="" coords="237,56,283,83"/><area shape="rect" id="node5" href="log_8c.html#ab43cc6f8c6c043d052ebcfebd33023e9" title="Prints a chat message to a file descriptor. " alt="" coords="200,107,320,133"/><area shape="rect" id="node3" href="log_8c.html#ac74eb6bdf382e22aec6303d2a1ea5802" title="Log a message to a file. " alt="" coords="403,5,485,32"/><area shape="rect" id="node6" href="log_8c.html#aadc76aa2a75bd302883a2bb571a42033" title="Returns the ansi escape code string for clearing the current line in a terminal. " alt="" coords="389,56,499,83"/><area shape="rect" id="node7" href="log_8c.html#ae3ea2f374cda4c473cbd22f83dc6b64f" title="Retruns the ansi escape code string for carriage return . " alt="" coords="411,107,477,133"/><area shape="rect" id="node8" href="log_8c.html#a422252d31fec52cb84c60fc0c18bd93e" title="Returns the ansi escape code string for bold cyan color. " alt="" coords="369,157,519,184"/><area shape="rect" id="node9" href="log_8c.html#a18901a0772a8dd71781402b41579ec95" title="Returns the ansi escape code string for resetting attributes. " alt="" coords="371,208,517,235"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a1b4978ff6c451ebbc8ac7a7340c414b7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdchat__conf.html">dchat_conf_t</a> *&#160;</td>
          <td class="paramname"><em>cnf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct sockaddr_storage *&#160;</td>
          <td class="paramname"><em>sa</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>onion_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>nickname</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes neccessary internal ressources like threads and pipes. </p>
<p>Initializes pipes and threads used for parallel processing of user input and handling data from a remote client and installs a signal handler to catch basic termination signals for proper program termination. Furtermore the global config gets initialized with the listening socket, nickname and other basic things. </p><dl class="section see"><dt>See also</dt><dd><a class="el" href="dchat_8c.html#a4c8f7778f9d784e724e3f987cb92edd0" title="Initializes the global dchat configuration. ">init_global_config()</a> </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cnf</td><td>The global dchat config </td></tr>
    <tr><td class="paramname">sa</td><td>Socket address containing the ip address to bind to </td></tr>
    <tr><td class="paramname">onion_id</td><td>Local onion address of hidden service </td></tr>
    <tr><td class="paramname">nickname</td><td>Nickname used for chatting </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on successful initialization, -1 in case of error </dd></dl>

<p>Definition at line <a class="el" href="dchat_8c_source.html#l00239">239</a> of file <a class="el" href="dchat_8c_source.html">dchat.c</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dchat_8c_a1b4978ff6c451ebbc8ac7a7340c414b7_cgraph.png" border="0" usemap="#dchat_8c_a1b4978ff6c451ebbc8ac7a7340c414b7_cgraph" alt=""/></div>
<map name="dchat_8c_a1b4978ff6c451ebbc8ac7a7340c414b7_cgraph" id="dchat_8c_a1b4978ff6c451ebbc8ac7a7340c414b7_cgraph">
<area shape="rect" id="node2" href="dchat_8c.html#a7fbc5e4f614e5e82b3a1fc5224f1855a" title="Signal handler function used for termination. " alt="" coords="107,540,184,566"/><area shape="rect" id="node6" href="dchat_8c.html#a4c8f7778f9d784e724e3f987cb92edd0" title="Initializes the global dchat configuration. " alt="" coords="276,194,401,221"/><area shape="rect" id="node7" href="log_8c.html#a447124894e44d19ff906633927930c19" title="Log a message together with a string representation of errno as error. " alt="" coords="507,250,586,277"/><area shape="rect" id="node8" href="log_8c.html#a021b18b681712d42cb07c99171691a84" title="Log a message. " alt="" coords="701,276,773,302"/><area shape="rect" id="node10" href="dchat_8c.html#a20c922556a3f5ba773faf2b38fc16750" title="Thread function that reads an onion address from a pipe and connects to this address. " alt="" coords="95,118,196,145"/><area shape="rect" id="node13" href="dchat_8c.html#a39d1655c3815d6db5026c52870b45776" title="Main chat loop of this client. " alt="" coords="94,413,197,440"/><area shape="rect" id="node3" href="dchat_8c.html#a103bc702ed34e7ba88e166b169cfe464" title="Frees all global config resources used. " alt="" coords="514,614,579,641"/><area shape="rect" id="node4" href="log_8c.html#aadc76aa2a75bd302883a2bb571a42033" title="Returns the ansi escape code string for clearing the current line in a terminal. " alt="" coords="682,564,793,590"/><area shape="rect" id="node5" href="log_8c.html#ae3ea2f374cda4c473cbd22f83dc6b64f" title="Retruns the ansi escape code string for carriage return . " alt="" coords="705,614,770,641"/><area shape="rect" id="node9" href="log_8c.html#ac74eb6bdf382e22aec6303d2a1ea5802" title="Log a message to a file. " alt="" coords="861,322,944,349"/><area shape="rect" id="node11" href="dchat_8c.html#a297b3a9a3e921bc25e5559de4c7dcaea" title="Cleanup ressources used by the thread conn_th holded by the global config. " alt="" coords="261,42,417,69"/><area shape="rect" id="node12" href="dchat_8c.html#ae2c246a2244b6435d0b307f0e893b0c6" title="Handles local connection requests from the user. " alt="" coords="246,144,431,170"/><area shape="rect" id="node14" href="dchat_8c.html#ab40992a684f2718a616237fd50fe9be5" title="Cleanup ressources used by the thread select_th holded by the global config. " alt="" coords="261,514,417,541"/><area shape="rect" id="node15" href="util_8c.html#af082905f7eac6d03e92015146bbc1925" title="Define the maximum of two given integers. " alt="" coords="315,565,362,592"/><area shape="rect" id="node16" href="dchat_8c.html#af26d1f15348f568261ddb15d886dbaff" title="Handles local user input. " alt="" coords="480,361,613,388"/><area shape="rect" id="node17" href="dchat_8c.html#a5c79a63478c0df6d16f70940e53338d1" title="Handles connection requests from a remote client. " alt="" coords="265,347,412,388"/><area shape="rect" id="node18" href="dchat_8c.html#a2cbf2aad21d016dd4852369423d86270" title="Handles PDUs received from a remote client. " alt="" coords="265,464,412,490"/><area shape="rect" id="node19" href="log_8c.html#a677da14e8c4326bde43622f233f1ead3" title="Prints an error message and terminates this program. " alt="" coords="523,462,570,489"/><area shape="rect" id="node20" href="log_8c.html#ab43cc6f8c6c043d052ebcfebd33023e9" title="Prints a chat message to a file descriptor. " alt="" coords="487,513,607,540"/><area shape="rect" id="node21" href="log_8c.html#a422252d31fec52cb84c60fc0c18bd93e" title="Returns the ansi escape code string for bold cyan color. " alt="" coords="662,513,813,540"/><area shape="rect" id="node22" href="log_8c.html#a18901a0772a8dd71781402b41579ec95" title="Returns the ansi escape code string for resetting attributes. " alt="" coords="665,462,810,489"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a4c8f7778f9d784e724e3f987cb92edd0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int init_global_config </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdchat__conf.html">dchat_conf_t</a> *&#160;</td>
          <td class="paramname"><em>cnf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct sockaddr_storage *&#160;</td>
          <td class="paramname"><em>sa</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>onion_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>nickname</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes the global dchat configuration. </p>
<p>Binds to a socket address, creates a listening socket for this interface and the given port and sets the nickname as well as the onion-id of the local hidden service. All configuration settings will be stored in the global config. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cnf</td><td>Pointer to global configuration structure </td></tr>
    <tr><td class="paramname">sa</td><td>Socket address containing the ip address to bind to </td></tr>
    <tr><td class="paramname">onion_id</td><td>Onion address of local hidden service </td></tr>
    <tr><td class="paramname">nickname</td><td>Nickname used for this chat session </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>socket descriptor or -1 if an error occurs </dd></dl>

<p>Definition at line <a class="el" href="dchat_8c_source.html#l00330">330</a> of file <a class="el" href="dchat_8c_source.html">dchat.c</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dchat_8c_a4c8f7778f9d784e724e3f987cb92edd0_cgraph.png" border="0" usemap="#dchat_8c_a4c8f7778f9d784e724e3f987cb92edd0_cgraph" alt=""/></div>
<map name="dchat_8c_a4c8f7778f9d784e724e3f987cb92edd0_cgraph" id="dchat_8c_a4c8f7778f9d784e724e3f987cb92edd0_cgraph">
<area shape="rect" id="node2" href="log_8c.html#a447124894e44d19ff906633927930c19" title="Log a message together with a string representation of errno as error. " alt="" coords="179,5,258,32"/><area shape="rect" id="node3" href="log_8c.html#a021b18b681712d42cb07c99171691a84" title="Log a message. " alt="" coords="307,31,379,57"/><area shape="rect" id="node4" href="log_8c.html#ac74eb6bdf382e22aec6303d2a1ea5802" title="Log a message to a file. " alt="" coords="427,31,509,57"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a7fbc5e4f614e5e82b3a1fc5224f1855a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void terminate </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>sig</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Signal handler function used for termination. </p>
<p>Signal handler function that will free all used resources like file descriptors, pipes, etc. and that terminates this process afterwards. This function will be called whenever this program should terminate (e.g SIGTERM, SIGQUIT, ...) or on EOF of stdin. Exit status of the process will be EXIT_SUCCESS </p><dl class="section see"><dt>See also</dt><dd><a class="el" href="dchat_8c.html#a103bc702ed34e7ba88e166b169cfe464" title="Frees all global config resources used. ">destroy()</a> </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sig</td><td>Type of signal (e.g SIGTERM, SIGQUIT, ...) </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="dchat_8c_source.html#l00448">448</a> of file <a class="el" href="dchat_8c_source.html">dchat.c</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dchat_8c_a7fbc5e4f614e5e82b3a1fc5224f1855a_cgraph.png" border="0" usemap="#dchat_8c_a7fbc5e4f614e5e82b3a1fc5224f1855a_cgraph" alt=""/></div>
<map name="dchat_8c_a7fbc5e4f614e5e82b3a1fc5224f1855a_cgraph" id="dchat_8c_a7fbc5e4f614e5e82b3a1fc5224f1855a_cgraph">
<area shape="rect" id="node2" href="dchat_8c.html#a103bc702ed34e7ba88e166b169cfe464" title="Frees all global config resources used. " alt="" coords="131,31,197,57"/><area shape="rect" id="node3" href="log_8c.html#aadc76aa2a75bd302883a2bb571a42033" title="Returns the ansi escape code string for clearing the current line in a terminal. " alt="" coords="246,5,357,32"/><area shape="rect" id="node4" href="log_8c.html#ae3ea2f374cda4c473cbd22f83dc6b64f" title="Retruns the ansi escape code string for carriage return . " alt="" coords="269,56,334,83"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a39d1655c3815d6db5026c52870b45776"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* th_main_loop </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdchat__conf.html">dchat_conf_t</a> *&#160;</td>
          <td class="paramname"><em>cnf</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Main chat loop of this client. </p>
<p>This function is the main loop of DChat that selects(2) certain file descriptors stored in the global configuration to read from. It waits for local userinput, PDUs from remote clients, local connection requests and remote connection requests. If select returns and a file descriptor can be read, this function will take action depending on which file descriptor is able to read from. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cnf</td><td>Pointer to global config holding all kind of file descriptors </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="dchat_8c_source.html#l00940">940</a> of file <a class="el" href="dchat_8c_source.html">dchat.c</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dchat_8c_a39d1655c3815d6db5026c52870b45776_cgraph.png" border="0" usemap="#dchat_8c_a39d1655c3815d6db5026c52870b45776_cgraph" alt=""/></div>
<map name="dchat_8c_a39d1655c3815d6db5026c52870b45776_cgraph" id="dchat_8c_a39d1655c3815d6db5026c52870b45776_cgraph">
<area shape="rect" id="node2" href="dchat_8c.html#ab40992a684f2718a616237fd50fe9be5" title="Cleanup ressources used by the thread select_th holded by the global config. " alt="" coords="158,5,314,32"/><area shape="rect" id="node3" href="util_8c.html#af082905f7eac6d03e92015146bbc1925" title="Define the maximum of two given integers. " alt="" coords="213,56,259,83"/><area shape="rect" id="node4" href="log_8c.html#a447124894e44d19ff906633927930c19" title="Log a message together with a string representation of errno as error. " alt="" coords="397,123,475,149"/><area shape="rect" id="node7" href="dchat_8c.html#af26d1f15348f568261ddb15d886dbaff" title="Handles local user input. " alt="" coords="369,224,503,251"/><area shape="rect" id="node8" href="dchat_8c.html#a5c79a63478c0df6d16f70940e53338d1" title="Handles connection requests from a remote client. " alt="" coords="163,158,309,199"/><area shape="rect" id="node9" href="dchat_8c.html#a2cbf2aad21d016dd4852369423d86270" title="Handles PDUs received from a remote client. " alt="" coords="363,275,509,301"/><area shape="rect" id="node5" href="log_8c.html#a021b18b681712d42cb07c99171691a84" title="Log a message. " alt="" coords="581,199,653,225"/><area shape="rect" id="node6" href="log_8c.html#ac74eb6bdf382e22aec6303d2a1ea5802" title="Log a message to a file. " alt="" coords="760,199,843,225"/><area shape="rect" id="node10" href="log_8c.html#a677da14e8c4326bde43622f233f1ead3" title="Prints an error message and terminates this program. " alt="" coords="594,249,641,276"/><area shape="rect" id="node11" href="log_8c.html#ab43cc6f8c6c043d052ebcfebd33023e9" title="Prints a chat message to a file descriptor. " alt="" coords="557,300,677,327"/><area shape="rect" id="node12" href="log_8c.html#aadc76aa2a75bd302883a2bb571a42033" title="Returns the ansi escape code string for clearing the current line in a terminal. " alt="" coords="746,249,857,276"/><area shape="rect" id="node13" href="log_8c.html#ae3ea2f374cda4c473cbd22f83dc6b64f" title="Retruns the ansi escape code string for carriage return . " alt="" coords="769,300,834,327"/><area shape="rect" id="node14" href="log_8c.html#a422252d31fec52cb84c60fc0c18bd93e" title="Returns the ansi escape code string for bold cyan color. " alt="" coords="726,351,877,377"/><area shape="rect" id="node15" href="log_8c.html#a18901a0772a8dd71781402b41579ec95" title="Returns the ansi escape code string for resetting attributes. " alt="" coords="729,401,874,428"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a20c922556a3f5ba773faf2b38fc16750"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* th_new_conn </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdchat__conf.html">dchat_conf_t</a> *&#160;</td>
          <td class="paramname"><em>cnf</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Thread function that reads an onion address from a pipe and connects to this address. </p>
<p>Establishes new connections to the given addresses read from the global config pipe <code>connect_fd</code>. It reads an onion address and then connects to this address via TOR. If a connection has been established successfully, a new contact will be added and the contactlist will be sent to him. Furthermore the character '1' will be written to the global config pipe <code>cl_change</code>. </p><dl class="section see"><dt>See also</dt><dd><a class="el" href="dchat_8c.html#ae2c246a2244b6435d0b307f0e893b0c6" title="Handles local connection requests from the user. ">handle_local_conn_request()</a> </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cnf</td><td>Pointer to global config to read from the pipe connect_fd` </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="dchat_8c_source.html#l00765">765</a> of file <a class="el" href="dchat_8c_source.html">dchat.c</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dchat_8c_a20c922556a3f5ba773faf2b38fc16750_cgraph.png" border="0" usemap="#dchat_8c_a20c922556a3f5ba773faf2b38fc16750_cgraph" alt=""/></div>
<map name="dchat_8c_a20c922556a3f5ba773faf2b38fc16750_cgraph" id="dchat_8c_a20c922556a3f5ba773faf2b38fc16750_cgraph">
<area shape="rect" id="node2" href="dchat_8c.html#a297b3a9a3e921bc25e5559de4c7dcaea" title="Cleanup ressources used by the thread conn_th holded by the global config. " alt="" coords="170,5,326,32"/><area shape="rect" id="node3" href="log_8c.html#a021b18b681712d42cb07c99171691a84" title="Log a message. " alt="" coords="517,81,589,108"/><area shape="rect" id="node5" href="dchat_8c.html#ae2c246a2244b6435d0b307f0e893b0c6" title="Handles local connection requests from the user. " alt="" coords="155,107,341,133"/><area shape="rect" id="node4" href="log_8c.html#ac74eb6bdf382e22aec6303d2a1ea5802" title="Log a message to a file. " alt="" coords="637,81,720,108"/><area shape="rect" id="node6" href="log_8c.html#a447124894e44d19ff906633927930c19" title="Log a message together with a string representation of errno as error. " alt="" coords="390,107,469,133"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a0a9fd273c9490e8cf99a08da3cfab690"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int th_new_input </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdchat__conf.html">dchat_conf_t</a> *&#160;</td>
          <td class="paramname"><em>cnf</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Thread function that reads from stdin until the user hits enter. </p>
<p>Waits for new user input on stdin using GNU readline. If the user has entered something, it will be written to the global config pipe <code>user_input</code>. First the length (int) of the string will be written to the pipe and then each byte of the string. On EOF of stdin 0 will be written </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cnf</td><td>Pointer to global config to write to the pipe <code>user_input</code> </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, -1 in case of error </dd></dl>

<p>Definition at line <a class="el" href="dchat_8c_source.html#l00836">836</a> of file <a class="el" href="dchat_8c_source.html">dchat.c</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dchat_8c_a0a9fd273c9490e8cf99a08da3cfab690_cgraph.png" border="0" usemap="#dchat_8c_a0a9fd273c9490e8cf99a08da3cfab690_cgraph" alt=""/></div>
<map name="dchat_8c_a0a9fd273c9490e8cf99a08da3cfab690_cgraph" id="dchat_8c_a0a9fd273c9490e8cf99a08da3cfab690_cgraph">
<area shape="rect" id="node2" href="log_8c.html#acda96afe4e46122c63830a774a5d1e1f" title="Returns the ansi escape code string for bold yellow color. " alt="" coords="155,5,315,32"/><area shape="rect" id="node3" href="log_8c.html#a18901a0772a8dd71781402b41579ec95" title="Returns the ansi escape code string for resetting attributes. " alt="" coords="162,56,307,83"/></map>
</div>
</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dchat_8c.html">dchat.c</a></li>
    <li class="footer">Generated on Fri Jun 27 2014 15:22:33 for DChat by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.7 </li>
  </ul>
</div>
</body>
</html>
