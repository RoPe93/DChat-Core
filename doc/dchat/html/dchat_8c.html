<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.7"/>
<title>DChat: src/dchat.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">DChat
   &#160;<span id="projectnumber">0.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.7 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('dchat_8c.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">dchat.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>This file is the main file for DChat and contains, besides the main function, several core functions.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdint.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;arpa/inet.h&gt;</code><br />
<code>#include &lt;errno.h&gt;</code><br />
<code>#include &lt;libgen.h&gt;</code><br />
<code>#include &lt;netinet/in.h&gt;</code><br />
<code>#include &lt;pthread.h&gt;</code><br />
<code>#include &lt;readline/readline.h&gt;</code><br />
<code>#include &lt;readline/history.h&gt;</code><br />
<code>#include &lt;sys/select.h&gt;</code><br />
<code>#include &lt;sys/socket.h&gt;</code><br />
<code>#include &lt;signal.h&gt;</code><br />
<code>#include &lt;ifaddrs.h&gt;</code><br />
<code>#include &lt;unistd.h&gt;</code><br />
<code>#include &lt;getopt.h&gt;</code><br />
<code>#include &quot;dchat_h/dchat.h&quot;</code><br />
<code>#include &quot;dchat_h/dchat_types.h&quot;</code><br />
<code>#include &quot;dchat_h/dchat_decoder.h&quot;</code><br />
<code>#include &quot;dchat_h/dchat_contact.h&quot;</code><br />
<code>#include &quot;dchat_h/dchat_cmd.h&quot;</code><br />
<code>#include &quot;dchat_h/dchat_network.h&quot;</code><br />
<code>#include &quot;dchat_h/log.h&quot;</code><br />
<code>#include &quot;dchat_h/util.h&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for dchat.c:</div>
<div class="dyncontent">
<div class="center"><img src="dchat_8c__incl.png" border="0" usemap="#src_2dchat_8c" alt=""/></div>
<map name="src_2dchat_8c" id="src_2dchat_8c">
<area shape="rect" id="node19" href="dchat_8h_source.html" title="dchat_h/dchat.h" alt="" coords="243,80,360,107"/><area shape="rect" id="node20" href="dchat__types_8h_source.html" title="dchat_types.h" alt="" coords="469,155,573,181"/><area shape="rect" id="node21" href="dchat__network_8h_source.html" title="dchat_network.h" alt="" coords="363,229,483,256"/><area shape="rect" id="node22" href="dchat__decoder_8h_source.html" title="dchat_h/dchat_decoder.h" alt="" coords="435,80,607,107"/><area shape="rect" id="node23" href="dchat__contact_8h_source.html" title="dchat_h/dchat_contact.h" alt="" coords="631,80,797,107"/><area shape="rect" id="node24" href="dchat__cmd_8h_source.html" title="dchat_h/dchat_cmd.h" alt="" coords="823,80,972,107"/><area shape="rect" id="node25" href="log_8h_source.html" title="dchat_h/log.h" alt="" coords="2543,80,2645,107"/><area shape="rect" id="node27" href="util_8h_source.html" title="dchat_h/util.h" alt="" coords="1047,80,1148,107"/></map>
</div>
</div>
<p><a href="dchat_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a3c04138a5bfe5d72780bb7e82a18e627"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a3c04138a5bfe5d72780bb7e82a18e627"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>main</b> (int argc, char **argv)</td></tr>
<tr class="separator:a3c04138a5bfe5d72780bb7e82a18e627"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1b4978ff6c451ebbc8ac7a7340c414b7"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dchat_8c.html#a1b4978ff6c451ebbc8ac7a7340c414b7">init</a> (<a class="el" href="structdchat__conf.html">dchat_conf_t</a> *<a class="el" href="dchat_8c.html#a5497dfcbcfecec06aaf63df011c70f83">cnf</a>, struct sockaddr_storage *sa, char *onion_id, char *nickname)</td></tr>
<tr class="memdesc:a1b4978ff6c451ebbc8ac7a7340c414b7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes neccessary internal ressources like threads and pipes.  <a href="#a1b4978ff6c451ebbc8ac7a7340c414b7">More...</a><br /></td></tr>
<tr class="separator:a1b4978ff6c451ebbc8ac7a7340c414b7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4c8f7778f9d784e724e3f987cb92edd0"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dchat_8c.html#a4c8f7778f9d784e724e3f987cb92edd0">init_global_config</a> (<a class="el" href="structdchat__conf.html">dchat_conf_t</a> *<a class="el" href="dchat_8c.html#a5497dfcbcfecec06aaf63df011c70f83">cnf</a>, struct sockaddr_storage *sa, char *onion_id, char *nickname)</td></tr>
<tr class="memdesc:a4c8f7778f9d784e724e3f987cb92edd0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes the global dchat configuration.  <a href="#a4c8f7778f9d784e724e3f987cb92edd0">More...</a><br /></td></tr>
<tr class="separator:a4c8f7778f9d784e724e3f987cb92edd0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a103bc702ed34e7ba88e166b169cfe464"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dchat_8c.html#a103bc702ed34e7ba88e166b169cfe464">destroy</a> (<a class="el" href="structdchat__conf.html">dchat_conf_t</a> *<a class="el" href="dchat_8c.html#a5497dfcbcfecec06aaf63df011c70f83">cnf</a>)</td></tr>
<tr class="memdesc:a103bc702ed34e7ba88e166b169cfe464"><td class="mdescLeft">&#160;</td><td class="mdescRight">Frees all global config resources used.  <a href="#a103bc702ed34e7ba88e166b169cfe464">More...</a><br /></td></tr>
<tr class="separator:a103bc702ed34e7ba88e166b169cfe464"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7fbc5e4f614e5e82b3a1fc5224f1855a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dchat_8c.html#a7fbc5e4f614e5e82b3a1fc5224f1855a">terminate</a> (int sig)</td></tr>
<tr class="memdesc:a7fbc5e4f614e5e82b3a1fc5224f1855a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Signal handler function used for termination.  <a href="#a7fbc5e4f614e5e82b3a1fc5224f1855a">More...</a><br /></td></tr>
<tr class="separator:a7fbc5e4f614e5e82b3a1fc5224f1855a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af26d1f15348f568261ddb15d886dbaff"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dchat_8c.html#af26d1f15348f568261ddb15d886dbaff">handle_local_input</a> (<a class="el" href="structdchat__conf.html">dchat_conf_t</a> *<a class="el" href="dchat_8c.html#a5497dfcbcfecec06aaf63df011c70f83">cnf</a>, char *line)</td></tr>
<tr class="memdesc:af26d1f15348f568261ddb15d886dbaff"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles local user input.  <a href="#af26d1f15348f568261ddb15d886dbaff">More...</a><br /></td></tr>
<tr class="separator:af26d1f15348f568261ddb15d886dbaff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2cbf2aad21d016dd4852369423d86270"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dchat_8c.html#a2cbf2aad21d016dd4852369423d86270">handle_remote_input</a> (<a class="el" href="structdchat__conf.html">dchat_conf_t</a> *<a class="el" href="dchat_8c.html#a5497dfcbcfecec06aaf63df011c70f83">cnf</a>, int n)</td></tr>
<tr class="memdesc:a2cbf2aad21d016dd4852369423d86270"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles PDUs received from a remote client.  <a href="#a2cbf2aad21d016dd4852369423d86270">More...</a><br /></td></tr>
<tr class="separator:a2cbf2aad21d016dd4852369423d86270"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae2c246a2244b6435d0b307f0e893b0c6"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dchat_8c.html#ae2c246a2244b6435d0b307f0e893b0c6">handle_local_conn_request</a> (<a class="el" href="structdchat__conf.html">dchat_conf_t</a> *<a class="el" href="dchat_8c.html#a5497dfcbcfecec06aaf63df011c70f83">cnf</a>, char *onion_id, uint16_t port)</td></tr>
<tr class="memdesc:ae2c246a2244b6435d0b307f0e893b0c6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles local connection requests from the user.  <a href="#ae2c246a2244b6435d0b307f0e893b0c6">More...</a><br /></td></tr>
<tr class="separator:ae2c246a2244b6435d0b307f0e893b0c6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5c79a63478c0df6d16f70940e53338d1"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dchat_8c.html#a5c79a63478c0df6d16f70940e53338d1">handle_remote_conn_request</a> (<a class="el" href="structdchat__conf.html">dchat_conf_t</a> *<a class="el" href="dchat_8c.html#a5497dfcbcfecec06aaf63df011c70f83">cnf</a>)</td></tr>
<tr class="memdesc:a5c79a63478c0df6d16f70940e53338d1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles connection requests from a remote client.  <a href="#a5c79a63478c0df6d16f70940e53338d1">More...</a><br /></td></tr>
<tr class="separator:a5c79a63478c0df6d16f70940e53338d1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a297b3a9a3e921bc25e5559de4c7dcaea"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dchat_8c.html#a297b3a9a3e921bc25e5559de4c7dcaea">cleanup_th_new_conn</a> (void *arg)</td></tr>
<tr class="memdesc:a297b3a9a3e921bc25e5559de4c7dcaea"><td class="mdescLeft">&#160;</td><td class="mdescRight">Cleanup ressources used by the thread <code>conn_th</code> holded by the global config.  <a href="#a297b3a9a3e921bc25e5559de4c7dcaea">More...</a><br /></td></tr>
<tr class="separator:a297b3a9a3e921bc25e5559de4c7dcaea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a20c922556a3f5ba773faf2b38fc16750"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dchat_8c.html#a20c922556a3f5ba773faf2b38fc16750">th_new_conn</a> (<a class="el" href="structdchat__conf.html">dchat_conf_t</a> *<a class="el" href="dchat_8c.html#a5497dfcbcfecec06aaf63df011c70f83">cnf</a>)</td></tr>
<tr class="memdesc:a20c922556a3f5ba773faf2b38fc16750"><td class="mdescLeft">&#160;</td><td class="mdescRight">Thread function that reads a onion address from a pipe and connects to this address.  <a href="#a20c922556a3f5ba773faf2b38fc16750">More...</a><br /></td></tr>
<tr class="separator:a20c922556a3f5ba773faf2b38fc16750"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0a9fd273c9490e8cf99a08da3cfab690"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dchat_8c.html#a0a9fd273c9490e8cf99a08da3cfab690">th_new_input</a> (<a class="el" href="structdchat__conf.html">dchat_conf_t</a> *<a class="el" href="dchat_8c.html#a5497dfcbcfecec06aaf63df011c70f83">cnf</a>)</td></tr>
<tr class="memdesc:a0a9fd273c9490e8cf99a08da3cfab690"><td class="mdescLeft">&#160;</td><td class="mdescRight">Thread function that reads from stdin until the user hits enter.  <a href="#a0a9fd273c9490e8cf99a08da3cfab690">More...</a><br /></td></tr>
<tr class="separator:a0a9fd273c9490e8cf99a08da3cfab690"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab40992a684f2718a616237fd50fe9be5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dchat_8c.html#ab40992a684f2718a616237fd50fe9be5">cleanup_th_main_loop</a> (void *arg)</td></tr>
<tr class="memdesc:ab40992a684f2718a616237fd50fe9be5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Cleanup ressources used by the thread <code>select_th</code> holded by the global config.  <a href="#ab40992a684f2718a616237fd50fe9be5">More...</a><br /></td></tr>
<tr class="separator:ab40992a684f2718a616237fd50fe9be5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a39d1655c3815d6db5026c52870b45776"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dchat_8c.html#a39d1655c3815d6db5026c52870b45776">th_main_loop</a> (<a class="el" href="structdchat__conf.html">dchat_conf_t</a> *<a class="el" href="dchat_8c.html#a5497dfcbcfecec06aaf63df011c70f83">cnf</a>)</td></tr>
<tr class="memdesc:a39d1655c3815d6db5026c52870b45776"><td class="mdescLeft">&#160;</td><td class="mdescRight">Main chat loop of this client.  <a href="#a39d1655c3815d6db5026c52870b45776">More...</a><br /></td></tr>
<tr class="separator:a39d1655c3815d6db5026c52870b45776"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2ef30c42cbc289d899a8be5d2d8f77d0"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a2ef30c42cbc289d899a8be5d2d8f77d0"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dchat_8c.html#a2ef30c42cbc289d899a8be5d2d8f77d0">usage</a> ()</td></tr>
<tr class="memdesc:a2ef30c42cbc289d899a8be5d2d8f77d0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prints usage of this program. <br /></td></tr>
<tr class="separator:a2ef30c42cbc289d899a8be5d2d8f77d0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a5497dfcbcfecec06aaf63df011c70f83"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a5497dfcbcfecec06aaf63df011c70f83"></a>
<a class="el" href="structdchat__conf.html">dchat_conf_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dchat_8c.html#a5497dfcbcfecec06aaf63df011c70f83">cnf</a></td></tr>
<tr class="memdesc:a5497dfcbcfecec06aaf63df011c70f83"><td class="mdescLeft">&#160;</td><td class="mdescRight">global dchat configuration structure <br /></td></tr>
<tr class="separator:a5497dfcbcfecec06aaf63df011c70f83"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This file is the main file for DChat and contains, besides the main function, several core functions. </p>
<p>Core functions are:</p>
<p>-) Handler for accepting connections</p>
<p>-) Handler for user input</p>
<p>-) Handler for remote data</p>
<p>-) Handler for file sharing </p>

<p>Definition in file <a class="el" href="dchat_8c_source.html">dchat.c</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ab40992a684f2718a616237fd50fe9be5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void cleanup_th_main_loop </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>arg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Cleanup ressources used by the thread <code>select_th</code> holded by the global config. </p>
<p>Closes the listening port, every contact file descriptor and the reading pipe end of <code>user_input</code> and <code>cl_change</code>. </p>

<p>Definition at line <a class="el" href="dchat_8c_source.html#l00893">893</a> of file <a class="el" href="dchat_8c_source.html">dchat.c</a>.</p>

</div>
</div>
<a class="anchor" id="a297b3a9a3e921bc25e5559de4c7dcaea"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void cleanup_th_new_conn </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>arg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Cleanup ressources used by the thread <code>conn_th</code> holded by the global config. </p>
<p>Closes the reading pipe <code>connect_fd</code> and the writing pipe end of <code>cl_change</code> stored in the global config. </p>
<p>close pipes used for in <code>th_new_conn</code> </p>

<p>Definition at line <a class="el" href="dchat_8c_source.html#l00733">733</a> of file <a class="el" href="dchat_8c_source.html">dchat.c</a>.</p>

</div>
</div>
<a class="anchor" id="a103bc702ed34e7ba88e166b169cfe464"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void destroy </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdchat__conf.html">dchat_conf_t</a> *&#160;</td>
          <td class="paramname"><em>cnf</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Frees all global config resources used. </p>
<p>Closes all open file descriptors, sockets, pipes and mutexes stored within the global config. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cnf</td><td>Global dchat config </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="dchat_8c_source.html#l00385">385</a> of file <a class="el" href="dchat_8c_source.html">dchat.c</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dchat_8c_a103bc702ed34e7ba88e166b169cfe464_cgraph.png" border="0" usemap="#dchat_8c_a103bc702ed34e7ba88e166b169cfe464_cgraph" alt=""/></div>
<map name="dchat_8c_a103bc702ed34e7ba88e166b169cfe464_cgraph" id="dchat_8c_a103bc702ed34e7ba88e166b169cfe464_cgraph">
<area shape="rect" id="node2" href="util_8c.html#aadc76aa2a75bd302883a2bb571a42033" title="Returns the ansi escape code string for clearing the current line in a terminal. " alt="" coords="121,5,231,32"/><area shape="rect" id="node3" href="util_8c.html#ae3ea2f374cda4c473cbd22f83dc6b64f" title="Retruns the ansi escape code string for carriage return . " alt="" coords="143,56,209,83"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ae2c246a2244b6435d0b307f0e893b0c6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int handle_local_conn_request </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdchat__conf.html">dchat_conf_t</a> *&#160;</td>
          <td class="paramname"><em>cnf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>onion_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>port</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handles local connection requests from the user. </p>
<p>Connects to the remote client with the given onion address, who will be added as contact. This new contact will be sent that all of our known contacts as specified in the DChat protocol. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cnf</td><td>Pointer to global configuration holding the contactlist </td></tr>
    <tr><td class="paramname">onion_id</td><td>Destination onion address to connect to </td></tr>
    <tr><td class="paramname">port</td><td>Destination port to connect to </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The index where the contact has been added in the contactlist, -1 on error </dd></dl>

<p>Definition at line <a class="el" href="dchat_8c_source.html#l00647">647</a> of file <a class="el" href="dchat_8c_source.html">dchat.c</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dchat_8c_ae2c246a2244b6435d0b307f0e893b0c6_cgraph.png" border="0" usemap="#dchat_8c_ae2c246a2244b6435d0b307f0e893b0c6_cgraph" alt=""/></div>
<map name="dchat_8c_ae2c246a2244b6435d0b307f0e893b0c6_cgraph" id="dchat_8c_ae2c246a2244b6435d0b307f0e893b0c6_cgraph">
<area shape="rect" id="node2" href="dchat__network_8c.html#abd951e9fd43b0ec9248ca6ec43398c6b" title="Creates a TOR socket. " alt="" coords="240,136,368,162"/><area shape="rect" id="node5" href="log_8c.html#a447124894e44d19ff906633927930c19" title="Log a message together with a string representation of errno as error. " alt="" coords="630,148,709,174"/><area shape="rect" id="node9" href="dchat__contact_8c.html#a6777b1a477207c7bbc9e560cf9caabed" title="Adds a new contact to the local contactlist. " alt="" coords="257,338,351,365"/><area shape="rect" id="node11" href="dchat__contact_8c.html#a625b0742c9e1cbd35146d35ecbf25282" title="Sends local contactlist to a contact. " alt="" coords="433,389,541,416"/><area shape="rect" id="node3" href="log_8c.html#a021b18b681712d42cb07c99171691a84" title="Log a message. " alt="" coords="803,288,875,314"/><area shape="rect" id="node4" href="util_8c.html#a77de9c9eb5a8ea2a6da108270bd7417e" title="Connects to a remote socket using the given socket address. " alt="" coords="443,34,530,61"/><area shape="rect" id="node6" href="dchat__network_8c.html#abd49b4a8eb0f62dc3be6755729d672b8" title="Writes a SOCKS PDU to the given socket. " alt="" coords="433,136,540,162"/><area shape="rect" id="node7" href="dchat__network_8c.html#a0ace1062fab444c73177e0552e019425" title="Reads a SOCKS response PDU from the given socket. " alt="" coords="434,186,539,213"/><area shape="rect" id="node8" href="dchat__network_8c.html#abd3d58b10c19c6d550b6e6aa86c9dc5c" title="Parses given status and returns its corresponding status message. " alt="" coords="417,237,557,264"/><area shape="rect" id="node10" href="dchat__contact_8c.html#a0de7073d40f7447f933e334054d432d8" title="Resizes the contactlist. " alt="" coords="605,262,733,289"/><area shape="rect" id="node12" href="dchat__contact_8c.html#ac15f4eb395316547db5ceba947a2f3b9" title="Converts a contact into a string. " alt="" coords="607,364,731,390"/><area shape="rect" id="node13" href="dchat__decoder_8c.html#af4aaf258b8866187ed65d6d1c23083cb" title="Converts a PDU to a string that will be written to a file descriptor. " alt="" coords="629,414,709,441"/><area shape="rect" id="node14" href="dchat__decoder_8c.html#ae5745b50cd3cc0aa6228e35d08690fdc" title="Crafts a DChat header string. " alt="" coords="781,414,896,441"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="af26d1f15348f568261ddb15d886dbaff"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int handle_local_input </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdchat__conf.html">dchat_conf_t</a> *&#160;</td>
          <td class="paramname"><em>cnf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>line</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handles local user input. </p>
<p>Interpretes the given line and reacts correspondently to it. If the line is a command it will be executed, otherwise it will be treated as text message and send to all known contacts stored in the contactlist in the global configuration. </p><dl class="section see"><dt>See also</dt><dd><a class="el" href="dchat__decoder_8c.html#af4aaf258b8866187ed65d6d1c23083cb" title="Converts a PDU to a string that will be written to a file descriptor. ">write_pdu()</a> </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cnf</td><td>Pointer to global configuration </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>-2 on warning, -1 on error, 0 on success </dd></dl>

<p>Definition at line <a class="el" href="dchat_8c_source.html#l00438">438</a> of file <a class="el" href="dchat_8c_source.html">dchat.c</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dchat_8c_af26d1f15348f568261ddb15d886dbaff_cgraph.png" border="0" usemap="#dchat_8c_af26d1f15348f568261ddb15d886dbaff_cgraph" alt=""/></div>
<map name="dchat_8c_af26d1f15348f568261ddb15d886dbaff_cgraph" id="dchat_8c_af26d1f15348f568261ddb15d886dbaff_cgraph">
<area shape="rect" id="node2" href="dchat__cmd_8c.html#a02a55875d8dace649fd51091f9a4dc0b" title="Parses the given string and executes it if it is a command. " alt="" coords="187,107,275,133"/><area shape="rect" id="node4" href="log_8c.html#a021b18b681712d42cb07c99171691a84" title="Log a message. " alt="" coords="515,183,587,209"/><area shape="rect" id="node7" href="log_8c.html#a447124894e44d19ff906633927930c19" title="Log a message together with a string representation of errno as error. " alt="" coords="191,259,270,285"/><area shape="rect" id="node8" href="dchat__decoder_8c.html#af4aaf258b8866187ed65d6d1c23083cb" title="Converts a PDU to a string that will be written to a file descriptor. " alt="" coords="191,309,271,336"/><area shape="rect" id="node3" href="dchat__cmd_8c.html#a704170b8cd6bd8927f648bdcb7510452" title="In&#45;chat command to establish a new connection. " alt="" coords="323,5,466,32"/><area shape="rect" id="node5" href="dchat__cmd_8c.html#a69b01cf50ab64d9d015318477cbe11c1" title="In&#45;chat command to show all available commands. " alt="" coords="335,107,455,133"/><area shape="rect" id="node6" href="dchat__cmd_8c.html#a9fac2cb40531bc95aff82930b92efd16" title="In&#45;chat command to list contacts of local contactlist. " alt="" coords="339,157,451,184"/><area shape="rect" id="node9" href="dchat__decoder_8c.html#ae5745b50cd3cc0aa6228e35d08690fdc" title="Crafts a DChat header string. " alt="" coords="337,360,452,387"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a5c79a63478c0df6d16f70940e53338d1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int handle_remote_conn_request </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdchat__conf.html">dchat_conf_t</a> *&#160;</td>
          <td class="paramname"><em>cnf</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handles connection requests from a remote client. </p>
<p>Accepts a connection from a remote client and so that a new TCP connection will be established between this and the remote client. Moreover the remote client will be added as new contact in the contactlist and the local contactlist will be sent to him. </p><dl class="section see"><dt>See also</dt><dd><a class="el" href="dchat__contact_8c.html#a6777b1a477207c7bbc9e560cf9caabed" title="Adds a new contact to the local contactlist. ">add_contact()</a> </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cnf</td><td>Pointer to global configuration </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>return value of function add_contact, or -1 on error </dd></dl>

<p>Definition at line <a class="el" href="dchat_8c_source.html#l00695">695</a> of file <a class="el" href="dchat_8c_source.html">dchat.c</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dchat_8c_a5c79a63478c0df6d16f70940e53338d1_cgraph.png" border="0" usemap="#dchat_8c_a5c79a63478c0df6d16f70940e53338d1_cgraph" alt=""/></div>
<map name="dchat_8c_a5c79a63478c0df6d16f70940e53338d1_cgraph" id="dchat_8c_a5c79a63478c0df6d16f70940e53338d1_cgraph">
<area shape="rect" id="node2" href="log_8c.html#a447124894e44d19ff906633927930c19" title="Log a message together with a string representation of errno as error. " alt="" coords="215,5,294,32"/><area shape="rect" id="node3" href="log_8c.html#a021b18b681712d42cb07c99171691a84" title="Log a message. " alt="" coords="555,132,627,159"/><area shape="rect" id="node4" href="dchat__contact_8c.html#a6777b1a477207c7bbc9e560cf9caabed" title="Adds a new contact to the local contactlist. " alt="" coords="207,107,302,133"/><area shape="rect" id="node6" href="dchat__contact_8c.html#a625b0742c9e1cbd35146d35ecbf25282" title="Sends local contactlist to a contact. " alt="" coords="201,183,309,209"/><area shape="rect" id="node5" href="dchat__contact_8c.html#a0de7073d40f7447f933e334054d432d8" title="Resizes the contactlist. " alt="" coords="357,107,485,133"/><area shape="rect" id="node7" href="dchat__contact_8c.html#ac15f4eb395316547db5ceba947a2f3b9" title="Converts a contact into a string. " alt="" coords="359,208,483,235"/><area shape="rect" id="node8" href="dchat__decoder_8c.html#af4aaf258b8866187ed65d6d1c23083cb" title="Converts a PDU to a string that will be written to a file descriptor. " alt="" coords="381,259,461,285"/><area shape="rect" id="node9" href="dchat__decoder_8c.html#ae5745b50cd3cc0aa6228e35d08690fdc" title="Crafts a DChat header string. " alt="" coords="533,259,648,285"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a2cbf2aad21d016dd4852369423d86270"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int handle_remote_input </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdchat__conf.html">dchat_conf_t</a> *&#160;</td>
          <td class="paramname"><em>cnf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>n</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handles PDUs received from a remote client. </p>
<p>Reads in a PDU from a certain contact file descriptor and interpretes its headers and handles its content. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cnf</td><td>Pointer to global configuration holding the contactlist </td></tr>
    <tr><td class="paramname">n</td><td>Index of contact in the respective contactlist </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>length of bytes read, 0 on EOF or -1 in case of error </dd></dl>

<p>Definition at line <a class="el" href="dchat_8c_source.html#l00512">512</a> of file <a class="el" href="dchat_8c_source.html">dchat.c</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dchat_8c_a2cbf2aad21d016dd4852369423d86270_cgraph.png" border="0" usemap="#dchat_8c_a2cbf2aad21d016dd4852369423d86270_cgraph" alt=""/></div>
<map name="dchat_8c_a2cbf2aad21d016dd4852369423d86270_cgraph" id="dchat_8c_a2cbf2aad21d016dd4852369423d86270_cgraph">
<area shape="rect" id="node2" href="dchat__decoder_8c.html#ae0ceb4d749dc162f86d73d4f08ed5fa4" title="Read a whole DChat PDU from a file descriptor. " alt="" coords="633,119,711,145"/><area shape="rect" id="node3" href="log_8c.html#a447124894e44d19ff906633927930c19" title="Log a message together with a string representation of errno as error. " alt="" coords="997,220,1075,247"/><area shape="rect" id="node4" href="log_8c.html#a021b18b681712d42cb07c99171691a84" title="Log a message. " alt="" coords="1168,701,1240,728"/><area shape="rect" id="node7" href="dchat__decoder_8c.html#ade270b4d1100adbdffbb22fdd5635737" title="Frees all resources dynamically allocated for a PDU structure. " alt="" coords="225,625,300,652"/><area shape="rect" id="node8" href="util_8c.html#ab43cc6f8c6c043d052ebcfebd33023e9" title="Prints a chat message to a file descriptor. " alt="" coords="203,1005,323,1032"/><area shape="rect" id="node13" href="dchat__contact_8c.html#aa0681254b16e6d20d63a03aed84c12e2" title="Checks the local contactlist for duplicates. " alt="" coords="201,575,325,601"/><area shape="rect" id="node16" href="dchat__contact_8c.html#a56a9992b188f855108c72588953fe8a6" title="Deletes a contact from the local contactlist. " alt="" coords="627,397,717,424"/><area shape="rect" id="node18" href="dchat__contact_8c.html#a2161fbd1e0fc61c762f08bb102e54ab8" title="Contacts transferred via PDU will be added to the contactlist. " alt="" coords="201,524,324,551"/><area shape="rect" id="node5" href="dchat__decoder_8c.html#a9a4f2d2d79d140c5d1bcb5be3bc82e0e" title="Read a line terminated with \n from a file descriptor. " alt="" coords="816,144,893,171"/><area shape="rect" id="node6" href="dchat__decoder_8c.html#acdc394373c1cbcfa66f99a9a4579e5c8" title="Decodes a string into a DChat header. " alt="" coords="797,43,912,69"/><area shape="rect" id="node9" href="util_8c.html#aadc76aa2a75bd302883a2bb571a42033" title="Returns the ansi escape code string for clearing the current line in a terminal. " alt="" coords="411,1107,522,1133"/><area shape="rect" id="node10" href="util_8c.html#ae3ea2f374cda4c473cbd22f83dc6b64f" title="Retruns the ansi escape code string for carriage return . " alt="" coords="434,955,499,981"/><area shape="rect" id="node11" href="util_8c.html#a422252d31fec52cb84c60fc0c18bd93e" title="Returns the ansi escape code string for bold cyan color. " alt="" coords="391,1005,542,1032"/><area shape="rect" id="node12" href="util_8c.html#a18901a0772a8dd71781402b41579ec95" title="Returns the ansi escape code string for resetting attributes. " alt="" coords="394,1056,539,1083"/><area shape="rect" id="node14" href="dchat__contact_8c.html#a01eb319ee1d229714b6a20e144181a1a" title="Searches a contact in the local contactlist. " alt="" coords="420,828,513,855"/><area shape="rect" id="node15" href="dchat__contact_8c.html#ac15f4eb395316547db5ceba947a2f3b9" title="Converts a contact into a string. " alt="" coords="974,803,1098,829"/><area shape="rect" id="node17" href="dchat__contact_8c.html#a0de7073d40f7447f933e334054d432d8" title="Resizes the contactlist. " alt="" coords="791,397,919,424"/><area shape="rect" id="node19" href="dchat__decoder_8c.html#ab4502d6fa3578ce5f3b4a92e5489c978" title="Extracts a fraction of the content. " alt="" coords="975,955,1097,981"/><area shape="rect" id="node20" href="dchat__contact_8c.html#a5fc6d1fda23da9c12247773139cc9c74" title="Converts a string into a contact. " alt="" coords="610,448,734,475"/><area shape="rect" id="node21" href="dchat_8c.html#ae2c246a2244b6435d0b307f0e893b0c6" title="Handles local connection requests from the user. " alt="" coords="374,524,559,551"/><area shape="rect" id="node22" href="dchat__network_8c.html#abd951e9fd43b0ec9248ca6ec43398c6b" title="Creates a TOR socket. " alt="" coords="608,549,736,576"/><area shape="rect" id="node27" href="dchat__contact_8c.html#a6777b1a477207c7bbc9e560cf9caabed" title="Adds a new contact to the local contactlist. " alt="" coords="625,499,719,525"/><area shape="rect" id="node28" href="dchat__contact_8c.html#a625b0742c9e1cbd35146d35ecbf25282" title="Sends local contactlist to a contact. " alt="" coords="801,752,909,779"/><area shape="rect" id="node23" href="util_8c.html#a77de9c9eb5a8ea2a6da108270bd7417e" title="Connects to a remote socket using the given socket address. " alt="" coords="811,448,898,475"/><area shape="rect" id="node24" href="dchat__network_8c.html#abd49b4a8eb0f62dc3be6755729d672b8" title="Writes a SOCKS PDU to the given socket. " alt="" coords="801,549,908,576"/><area shape="rect" id="node25" href="dchat__network_8c.html#a0ace1062fab444c73177e0552e019425" title="Reads a SOCKS response PDU from the given socket. " alt="" coords="802,600,907,627"/><area shape="rect" id="node26" href="dchat__network_8c.html#abd3d58b10c19c6d550b6e6aa86c9dc5c" title="Parses given status and returns its corresponding status message. " alt="" coords="785,651,925,677"/><area shape="rect" id="node29" href="dchat__decoder_8c.html#af4aaf258b8866187ed65d6d1c23083cb" title="Converts a PDU to a string that will be written to a file descriptor. " alt="" coords="996,904,1076,931"/><area shape="rect" id="node30" href="dchat__decoder_8c.html#ae5745b50cd3cc0aa6228e35d08690fdc" title="Crafts a DChat header string. " alt="" coords="1147,904,1261,931"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a1b4978ff6c451ebbc8ac7a7340c414b7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdchat__conf.html">dchat_conf_t</a> *&#160;</td>
          <td class="paramname"><em>cnf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct sockaddr_storage *&#160;</td>
          <td class="paramname"><em>sa</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>onion_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>nickname</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes neccessary internal ressources like threads and pipes. </p>
<p>Initializes pipes and threads used for parallel processing of user input and and handling data from a remote client. Furtermore the global config gets initialized with the listening socket, nickname and other basic things. </p><dl class="section see"><dt>See also</dt><dd><a class="el" href="dchat_8c.html#a4c8f7778f9d784e724e3f987cb92edd0" title="Initializes the global dchat configuration. ">init_global_config()</a> </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cnf</td><td>The global dchat config </td></tr>
    <tr><td class="paramname">sa</td><td>Socket address containing the ip address to bind to </td></tr>
    <tr><td class="paramname">onion_id</td><td>Local onion address of hidden service </td></tr>
    <tr><td class="paramname">nickname</td><td>Nickname used for chatting </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on successful initialization, -1 in case of error </dd></dl>

<p>Definition at line <a class="el" href="dchat_8c_source.html#l00217">217</a> of file <a class="el" href="dchat_8c_source.html">dchat.c</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dchat_8c_a1b4978ff6c451ebbc8ac7a7340c414b7_cgraph.png" border="0" usemap="#dchat_8c_a1b4978ff6c451ebbc8ac7a7340c414b7_cgraph" alt=""/></div>
<map name="dchat_8c_a1b4978ff6c451ebbc8ac7a7340c414b7_cgraph" id="dchat_8c_a1b4978ff6c451ebbc8ac7a7340c414b7_cgraph">
<area shape="rect" id="node2" href="dchat_8c.html#a7fbc5e4f614e5e82b3a1fc5224f1855a" title="Signal handler function used for termination. " alt="" coords="107,423,184,449"/><area shape="rect" id="node6" href="dchat_8c.html#a4c8f7778f9d784e724e3f987cb92edd0" title="Initializes the global dchat configuration. " alt="" coords="1048,56,1173,83"/><area shape="rect" id="node7" href="log_8c.html#a447124894e44d19ff906633927930c19" title="Log a message together with a string representation of errno as error. " alt="" coords="1262,689,1341,716"/><area shape="rect" id="node10" href="dchat_8c.html#a20c922556a3f5ba773faf2b38fc16750" title="Thread function that reads a onion address from a pipe and connects to this address. " alt="" coords="463,208,564,235"/><area shape="rect" id="node24" href="dchat_8c.html#a39d1655c3815d6db5026c52870b45776" title="Main chat loop of this client. " alt="" coords="94,1179,197,1205"/><area shape="rect" id="node3" href="dchat_8c.html#a103bc702ed34e7ba88e166b169cfe464" title="Frees all global config resources used. " alt="" coords="481,664,546,691"/><area shape="rect" id="node4" href="util_8c.html#aadc76aa2a75bd302883a2bb571a42033" title="Returns the ansi escape code string for clearing the current line in a terminal. " alt="" coords="662,664,773,691"/><area shape="rect" id="node5" href="util_8c.html#ae3ea2f374cda4c473cbd22f83dc6b64f" title="Retruns the ansi escape code string for carriage return . " alt="" coords="685,715,750,741"/><area shape="rect" id="node8" href="log_8c.html#a021b18b681712d42cb07c99171691a84" title="Log a message. " alt="" coords="1421,1221,1493,1248"/><area shape="rect" id="node9" href="util_8c.html#a279f65250f814269adbaadf7f94680c5" title="Determines the address family of the given socket address structure. " alt="" coords="1260,5,1343,32"/><area shape="rect" id="node11" href="dchat_8c.html#a297b3a9a3e921bc25e5559de4c7dcaea" title="Cleanup ressources used by the thread conn_th holded by the global config. " alt="" coords="639,157,795,184"/><area shape="rect" id="node12" href="dchat_8c.html#ae2c246a2244b6435d0b307f0e893b0c6" title="Handles local connection requests from the user. " alt="" coords="625,765,810,792"/><area shape="rect" id="node13" href="dchat__network_8c.html#abd951e9fd43b0ec9248ca6ec43398c6b" title="Creates a TOR socket. " alt="" coords="861,563,989,589"/><area shape="rect" id="node18" href="dchat__contact_8c.html#a6777b1a477207c7bbc9e560cf9caabed" title="Adds a new contact to the local contactlist. " alt="" coords="878,1280,973,1307"/><area shape="rect" id="node20" href="dchat__contact_8c.html#a625b0742c9e1cbd35146d35ecbf25282" title="Sends local contactlist to a contact. " alt="" coords="871,1171,979,1197"/><area shape="rect" id="node14" href="util_8c.html#a77de9c9eb5a8ea2a6da108270bd7417e" title="Connects to a remote socket using the given socket address. " alt="" coords="1067,664,1154,691"/><area shape="rect" id="node15" href="dchat__network_8c.html#abd49b4a8eb0f62dc3be6755729d672b8" title="Writes a SOCKS PDU to the given socket. " alt="" coords="1057,461,1164,488"/><area shape="rect" id="node16" href="dchat__network_8c.html#a0ace1062fab444c73177e0552e019425" title="Reads a SOCKS response PDU from the given socket. " alt="" coords="1058,512,1163,539"/><area shape="rect" id="node17" href="dchat__network_8c.html#abd3d58b10c19c6d550b6e6aa86c9dc5c" title="Parses given status and returns its corresponding status message. " alt="" coords="1041,563,1181,589"/><area shape="rect" id="node19" href="dchat__contact_8c.html#a0de7073d40f7447f933e334054d432d8" title="Resizes the contactlist. " alt="" coords="1047,1323,1175,1349"/><area shape="rect" id="node21" href="dchat__contact_8c.html#ac15f4eb395316547db5ceba947a2f3b9" title="Converts a contact into a string. " alt="" coords="1049,1069,1173,1096"/><area shape="rect" id="node22" href="dchat__decoder_8c.html#af4aaf258b8866187ed65d6d1c23083cb" title="Converts a PDU to a string that will be written to a file descriptor. " alt="" coords="1071,1272,1151,1299"/><area shape="rect" id="node23" href="dchat__decoder_8c.html#ae5745b50cd3cc0aa6228e35d08690fdc" title="Crafts a DChat header string. " alt="" coords="1244,1221,1359,1248"/><area shape="rect" id="node25" href="dchat_8c.html#ab40992a684f2718a616237fd50fe9be5" title="Cleanup ressources used by the thread select_th holded by the global config. " alt="" coords="246,1541,402,1568"/><area shape="rect" id="node26" href="util_8c.html#af082905f7eac6d03e92015146bbc1925" title="Define the maximum of two given integers. " alt="" coords="301,943,347,969"/><area shape="rect" id="node27" href="dchat_8c.html#af26d1f15348f568261ddb15d886dbaff" title="Handles local user input. " alt="" coords="859,1389,992,1416"/><area shape="rect" id="node32" href="dchat_8c.html#a5c79a63478c0df6d16f70940e53338d1" title="Handles connection requests from a remote client. " alt="" coords="644,1273,791,1314"/><area shape="rect" id="node33" href="dchat_8c.html#a2cbf2aad21d016dd4852369423d86270" title="Handles PDUs received from a remote client. " alt="" coords="251,993,397,1020"/><area shape="rect" id="node43" href="dchat__contact_8c.html#a56a9992b188f855108c72588953fe8a6" title="Deletes a contact from the local contactlist. " alt="" coords="880,1728,971,1755"/><area shape="rect" id="node28" href="dchat__cmd_8c.html#a02a55875d8dace649fd51091f9a4dc0b" title="Parses the given string and executes it if it is a command. " alt="" coords="1067,1475,1155,1501"/><area shape="rect" id="node29" href="dchat__cmd_8c.html#a704170b8cd6bd8927f648bdcb7510452" title="In&#45;chat command to establish a new connection. " alt="" coords="1230,1576,1373,1603"/><area shape="rect" id="node30" href="dchat__cmd_8c.html#a69b01cf50ab64d9d015318477cbe11c1" title="In&#45;chat command to show all available commands. " alt="" coords="1241,1424,1361,1451"/><area shape="rect" id="node31" href="dchat__cmd_8c.html#a9fac2cb40531bc95aff82930b92efd16" title="In&#45;chat command to list contacts of local contactlist. " alt="" coords="1245,1475,1357,1501"/><area shape="rect" id="node34" href="dchat__decoder_8c.html#ae0ceb4d749dc162f86d73d4f08ed5fa4" title="Read a whole DChat PDU from a file descriptor. " alt="" coords="886,791,965,817"/><area shape="rect" id="node37" href="dchat__decoder_8c.html#ade270b4d1100adbdffbb22fdd5635737" title="Frees all resources dynamically allocated for a PDU structure. " alt="" coords="476,791,551,817"/><area shape="rect" id="node38" href="util_8c.html#ab43cc6f8c6c043d052ebcfebd33023e9" title="Prints a chat message to a file descriptor. " alt="" coords="453,841,573,868"/><area shape="rect" id="node41" href="dchat__contact_8c.html#aa0681254b16e6d20d63a03aed84c12e2" title="Checks the local contactlist for duplicates. " alt="" coords="451,1019,575,1045"/><area shape="rect" id="node44" href="dchat__contact_8c.html#a2161fbd1e0fc61c762f08bb102e54ab8" title="Contacts transferred via PDU will be added to the contactlist. " alt="" coords="452,968,575,995"/><area shape="rect" id="node35" href="dchat__decoder_8c.html#a9a4f2d2d79d140c5d1bcb5be3bc82e0e" title="Read a line terminated with \n from a file descriptor. " alt="" coords="1072,765,1149,792"/><area shape="rect" id="node36" href="dchat__decoder_8c.html#acdc394373c1cbcfa66f99a9a4579e5c8" title="Decodes a string into a DChat header. " alt="" coords="1053,816,1168,843"/><area shape="rect" id="node39" href="util_8c.html#a422252d31fec52cb84c60fc0c18bd93e" title="Returns the ansi escape code string for bold cyan color. " alt="" coords="642,816,793,843"/><area shape="rect" id="node40" href="util_8c.html#a18901a0772a8dd71781402b41579ec95" title="Returns the ansi escape code string for resetting attributes. " alt="" coords="645,867,790,893"/><area shape="rect" id="node42" href="dchat__contact_8c.html#a01eb319ee1d229714b6a20e144181a1a" title="Searches a contact in the local contactlist. " alt="" coords="671,1019,764,1045"/><area shape="rect" id="node45" href="dchat__decoder_8c.html#ab4502d6fa3578ce5f3b4a92e5489c978" title="Extracts a fraction of the content. " alt="" coords="864,968,987,995"/><area shape="rect" id="node46" href="dchat__contact_8c.html#a5fc6d1fda23da9c12247773139cc9c74" title="Converts a string into a contact. " alt="" coords="1239,1171,1363,1197"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a4c8f7778f9d784e724e3f987cb92edd0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int init_global_config </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdchat__conf.html">dchat_conf_t</a> *&#160;</td>
          <td class="paramname"><em>cnf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct sockaddr_storage *&#160;</td>
          <td class="paramname"><em>sa</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>onion_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>nickname</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes the global dchat configuration. </p>
<p>Binds to a network interface, creates a listening socket for this interface and the given port and sets the nickname. All configuration settings will be stored in the global config. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cnf</td><td>Pointer to global configuration structure </td></tr>
    <tr><td class="paramname">sa</td><td>Socket address containing the ip address to bind to </td></tr>
    <tr><td class="paramname">onion_id</td><td>Local onion address of hidden service </td></tr>
    <tr><td class="paramname">nickname</td><td>Nickname used for this chat session </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>socket descriptor or -1 if an error occurs </dd></dl>

<p>Definition at line <a class="el" href="dchat_8c_source.html#l00305">305</a> of file <a class="el" href="dchat_8c_source.html">dchat.c</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dchat_8c_a4c8f7778f9d784e724e3f987cb92edd0_cgraph.png" border="0" usemap="#dchat_8c_a4c8f7778f9d784e724e3f987cb92edd0_cgraph" alt=""/></div>
<map name="dchat_8c_a4c8f7778f9d784e724e3f987cb92edd0_cgraph" id="dchat_8c_a4c8f7778f9d784e724e3f987cb92edd0_cgraph">
<area shape="rect" id="node2" href="log_8c.html#a447124894e44d19ff906633927930c19" title="Log a message together with a string representation of errno as error. " alt="" coords="181,5,259,32"/><area shape="rect" id="node3" href="log_8c.html#a021b18b681712d42cb07c99171691a84" title="Log a message. " alt="" coords="309,31,381,57"/><area shape="rect" id="node4" href="util_8c.html#a279f65250f814269adbaadf7f94680c5" title="Determines the address family of the given socket address structure. " alt="" coords="179,107,261,133"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a7fbc5e4f614e5e82b3a1fc5224f1855a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void terminate </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>sig</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Signal handler function used for termination. </p>
<p>Signal handler function that will free all used resources like file descriptors, pipes, etc... and that terminates this process afterwards. This function will be called whenever this program should terminate (e.g SIGTERM, SIGQUIT, ...) or on EOF of stdin. Exit status of the process will be EXIT_SUCCESS </p><dl class="section see"><dt>See also</dt><dd><a class="el" href="dchat_8c.html#a103bc702ed34e7ba88e166b169cfe464" title="Frees all global config resources used. ">destroy()</a> </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sig</td><td>Type of signal (e.g SIGTERM, SIGQUIT, ...) </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="dchat_8c_source.html#l00419">419</a> of file <a class="el" href="dchat_8c_source.html">dchat.c</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dchat_8c_a7fbc5e4f614e5e82b3a1fc5224f1855a_cgraph.png" border="0" usemap="#dchat_8c_a7fbc5e4f614e5e82b3a1fc5224f1855a_cgraph" alt=""/></div>
<map name="dchat_8c_a7fbc5e4f614e5e82b3a1fc5224f1855a_cgraph" id="dchat_8c_a7fbc5e4f614e5e82b3a1fc5224f1855a_cgraph">
<area shape="rect" id="node2" href="dchat_8c.html#a103bc702ed34e7ba88e166b169cfe464" title="Frees all global config resources used. " alt="" coords="131,31,197,57"/><area shape="rect" id="node3" href="util_8c.html#aadc76aa2a75bd302883a2bb571a42033" title="Returns the ansi escape code string for clearing the current line in a terminal. " alt="" coords="246,5,357,32"/><area shape="rect" id="node4" href="util_8c.html#ae3ea2f374cda4c473cbd22f83dc6b64f" title="Retruns the ansi escape code string for carriage return . " alt="" coords="269,56,334,83"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a39d1655c3815d6db5026c52870b45776"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* th_main_loop </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdchat__conf.html">dchat_conf_t</a> *&#160;</td>
          <td class="paramname"><em>cnf</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Main chat loop of this client. </p>
<p>This function is the main loop of DChat that selects(2) certain file descriptors stored in the global configuration to read from. It waits for local userinput, PDUs from remote clients, local connection requests and remote connection requests. If select returns and a file descriptor can be read, this function will take action depending on which file descriptor is able to read from. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cnf</td><td>Pointer to global config holding all kind of file descriptors </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="dchat_8c_source.html#l00926">926</a> of file <a class="el" href="dchat_8c_source.html">dchat.c</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dchat_8c_a39d1655c3815d6db5026c52870b45776_cgraph.png" border="0" usemap="#dchat_8c_a39d1655c3815d6db5026c52870b45776_cgraph" alt=""/></div>
<map name="dchat_8c_a39d1655c3815d6db5026c52870b45776_cgraph" id="dchat_8c_a39d1655c3815d6db5026c52870b45776_cgraph">
<area shape="rect" id="node2" href="dchat_8c.html#ab40992a684f2718a616237fd50fe9be5" title="Cleanup ressources used by the thread select_th holded by the global config. " alt="" coords="158,107,314,133"/><area shape="rect" id="node3" href="util_8c.html#af082905f7eac6d03e92015146bbc1925" title="Define the maximum of two given integers. " alt="" coords="213,157,259,184"/><area shape="rect" id="node4" href="log_8c.html#a447124894e44d19ff906633927930c19" title="Log a message together with a string representation of errno as error. " alt="" coords="1174,816,1253,843"/><area shape="rect" id="node6" href="dchat_8c.html#af26d1f15348f568261ddb15d886dbaff" title="Handles local user input. " alt="" coords="771,208,904,235"/><area shape="rect" id="node13" href="dchat_8c.html#a5c79a63478c0df6d16f70940e53338d1" title="Handles connection requests from a remote client. " alt="" coords="556,479,703,521"/><area shape="rect" id="node18" href="dchat_8c.html#a2cbf2aad21d016dd4852369423d86270" title="Handles PDUs received from a remote client. " alt="" coords="163,697,309,724"/><area shape="rect" id="node30" href="dchat__contact_8c.html#a56a9992b188f855108c72588953fe8a6" title="Deletes a contact from the local contactlist. " alt="" coords="380,276,471,303"/><area shape="rect" id="node5" href="log_8c.html#a021b18b681712d42cb07c99171691a84" title="Log a message. " alt="" coords="1333,487,1405,513"/><area shape="rect" id="node7" href="dchat__cmd_8c.html#a02a55875d8dace649fd51091f9a4dc0b" title="Parses the given string and executes it if it is a command. " alt="" coords="979,107,1067,133"/><area shape="rect" id="node11" href="dchat__decoder_8c.html#af4aaf258b8866187ed65d6d1c23083cb" title="Converts a PDU to a string that will be written to a file descriptor. " alt="" coords="983,360,1063,387"/><area shape="rect" id="node8" href="dchat__cmd_8c.html#a704170b8cd6bd8927f648bdcb7510452" title="In&#45;chat command to establish a new connection. " alt="" coords="1142,56,1285,83"/><area shape="rect" id="node9" href="dchat__cmd_8c.html#a69b01cf50ab64d9d015318477cbe11c1" title="In&#45;chat command to show all available commands. " alt="" coords="1153,5,1273,32"/><area shape="rect" id="node10" href="dchat__cmd_8c.html#a9fac2cb40531bc95aff82930b92efd16" title="In&#45;chat command to list contacts of local contactlist. " alt="" coords="1157,107,1269,133"/><area shape="rect" id="node12" href="dchat__decoder_8c.html#ae5745b50cd3cc0aa6228e35d08690fdc" title="Crafts a DChat header string. " alt="" coords="1156,360,1271,387"/><area shape="rect" id="node14" href="dchat__contact_8c.html#a6777b1a477207c7bbc9e560cf9caabed" title="Adds a new contact to the local contactlist. " alt="" coords="790,512,885,539"/><area shape="rect" id="node16" href="dchat__contact_8c.html#a625b0742c9e1cbd35146d35ecbf25282" title="Sends local contactlist to a contact. " alt="" coords="783,563,891,589"/><area shape="rect" id="node15" href="dchat__contact_8c.html#a0de7073d40f7447f933e334054d432d8" title="Resizes the contactlist. " alt="" coords="959,512,1087,539"/><area shape="rect" id="node17" href="dchat__contact_8c.html#ac15f4eb395316547db5ceba947a2f3b9" title="Converts a contact into a string. " alt="" coords="961,613,1085,640"/><area shape="rect" id="node19" href="dchat__decoder_8c.html#ae0ceb4d749dc162f86d73d4f08ed5fa4" title="Read a whole DChat PDU from a file descriptor. " alt="" coords="798,845,877,872"/><area shape="rect" id="node22" href="dchat__decoder_8c.html#ade270b4d1100adbdffbb22fdd5635737" title="Frees all resources dynamically allocated for a PDU structure. " alt="" coords="388,697,463,724"/><area shape="rect" id="node23" href="util_8c.html#ab43cc6f8c6c043d052ebcfebd33023e9" title="Prints a chat message to a file descriptor. " alt="" coords="365,647,485,673"/><area shape="rect" id="node28" href="dchat__contact_8c.html#aa0681254b16e6d20d63a03aed84c12e2" title="Checks the local contactlist for duplicates. " alt="" coords="363,748,487,775"/><area shape="rect" id="node31" href="dchat__contact_8c.html#a2161fbd1e0fc61c762f08bb102e54ab8" title="Contacts transferred via PDU will be added to the contactlist. " alt="" coords="364,1145,487,1172"/><area shape="rect" id="node20" href="dchat__decoder_8c.html#a9a4f2d2d79d140c5d1bcb5be3bc82e0e" title="Read a line terminated with \n from a file descriptor. " alt="" coords="984,765,1061,792"/><area shape="rect" id="node21" href="dchat__decoder_8c.html#acdc394373c1cbcfa66f99a9a4579e5c8" title="Decodes a string into a DChat header. " alt="" coords="965,816,1080,843"/><area shape="rect" id="node24" href="util_8c.html#aadc76aa2a75bd302883a2bb571a42033" title="Returns the ansi escape code string for clearing the current line in a terminal. " alt="" coords="574,596,685,623"/><area shape="rect" id="node25" href="util_8c.html#ae3ea2f374cda4c473cbd22f83dc6b64f" title="Retruns the ansi escape code string for carriage return . " alt="" coords="597,647,662,673"/><area shape="rect" id="node26" href="util_8c.html#a422252d31fec52cb84c60fc0c18bd93e" title="Returns the ansi escape code string for bold cyan color. " alt="" coords="554,697,705,724"/><area shape="rect" id="node27" href="util_8c.html#a18901a0772a8dd71781402b41579ec95" title="Returns the ansi escape code string for resetting attributes. " alt="" coords="557,545,702,572"/><area shape="rect" id="node29" href="dchat__contact_8c.html#a01eb319ee1d229714b6a20e144181a1a" title="Searches a contact in the local contactlist. " alt="" coords="583,748,676,775"/><area shape="rect" id="node32" href="dchat__decoder_8c.html#ab4502d6fa3578ce5f3b4a92e5489c978" title="Extracts a fraction of the content. " alt="" coords="776,1323,899,1349"/><area shape="rect" id="node33" href="dchat__contact_8c.html#a5fc6d1fda23da9c12247773139cc9c74" title="Converts a string into a contact. " alt="" coords="1151,1399,1275,1425"/><area shape="rect" id="node34" href="dchat_8c.html#ae2c246a2244b6435d0b307f0e893b0c6" title="Handles local connection requests from the user. " alt="" coords="537,1044,722,1071"/><area shape="rect" id="node35" href="dchat__network_8c.html#abd951e9fd43b0ec9248ca6ec43398c6b" title="Creates a TOR socket. " alt="" coords="773,1044,901,1071"/><area shape="rect" id="node36" href="util_8c.html#a77de9c9eb5a8ea2a6da108270bd7417e" title="Connects to a remote socket using the given socket address. " alt="" coords="979,1120,1066,1147"/><area shape="rect" id="node37" href="dchat__network_8c.html#abd49b4a8eb0f62dc3be6755729d672b8" title="Writes a SOCKS PDU to the given socket. " alt="" coords="969,1069,1076,1096"/><area shape="rect" id="node38" href="dchat__network_8c.html#a0ace1062fab444c73177e0552e019425" title="Reads a SOCKS response PDU from the given socket. " alt="" coords="970,968,1075,995"/><area shape="rect" id="node39" href="dchat__network_8c.html#abd3d58b10c19c6d550b6e6aa86c9dc5c" title="Parses given status and returns its corresponding status message. " alt="" coords="953,1019,1093,1045"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a20c922556a3f5ba773faf2b38fc16750"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* th_new_conn </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdchat__conf.html">dchat_conf_t</a> *&#160;</td>
          <td class="paramname"><em>cnf</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Thread function that reads a onion address from a pipe and connects to this address. </p>
<p>Establishes new connections to the given addresses read from the global config pipe <code>connect_fd</code>. It reads an onion address and then connects to this address via TOR. If a connection has been established successfully, a new contact will be added and the contactlist will be sent to him. Furthermore the character '1' will be written to the global config pipe <code>cl_change</code>. </p><dl class="section see"><dt>See also</dt><dd><a class="el" href="dchat_8c.html#ae2c246a2244b6435d0b307f0e893b0c6" title="Handles local connection requests from the user. ">handle_local_conn_request()</a> </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cnf</td><td>Pointer to global config to read from the pipe connect_fd` </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="dchat_8c_source.html#l00753">753</a> of file <a class="el" href="dchat_8c_source.html">dchat.c</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dchat_8c_a20c922556a3f5ba773faf2b38fc16750_cgraph.png" border="0" usemap="#dchat_8c_a20c922556a3f5ba773faf2b38fc16750_cgraph" alt=""/></div>
<map name="dchat_8c_a20c922556a3f5ba773faf2b38fc16750_cgraph" id="dchat_8c_a20c922556a3f5ba773faf2b38fc16750_cgraph">
<area shape="rect" id="node2" href="dchat_8c.html#a297b3a9a3e921bc25e5559de4c7dcaea" title="Cleanup ressources used by the thread conn_th holded by the global config. " alt="" coords="170,5,326,32"/><area shape="rect" id="node3" href="log_8c.html#a021b18b681712d42cb07c99171691a84" title="Log a message. " alt="" coords="952,411,1024,437"/><area shape="rect" id="node4" href="dchat_8c.html#ae2c246a2244b6435d0b307f0e893b0c6" title="Handles local connection requests from the user. " alt="" coords="155,284,341,311"/><area shape="rect" id="node7" href="log_8c.html#a447124894e44d19ff906633927930c19" title="Log a message together with a string representation of errno as error. " alt="" coords="779,411,858,437"/><area shape="rect" id="node5" href="dchat__network_8c.html#abd951e9fd43b0ec9248ca6ec43398c6b" title="Creates a TOR socket. " alt="" coords="389,284,517,311"/><area shape="rect" id="node11" href="dchat__contact_8c.html#a6777b1a477207c7bbc9e560cf9caabed" title="Adds a new contact to the local contactlist. " alt="" coords="406,183,501,209"/><area shape="rect" id="node13" href="dchat__contact_8c.html#a625b0742c9e1cbd35146d35ecbf25282" title="Sends local contactlist to a contact. " alt="" coords="582,563,690,589"/><area shape="rect" id="node6" href="util_8c.html#a77de9c9eb5a8ea2a6da108270bd7417e" title="Connects to a remote socket using the given socket address. " alt="" coords="593,411,679,437"/><area shape="rect" id="node8" href="dchat__network_8c.html#abd49b4a8eb0f62dc3be6755729d672b8" title="Writes a SOCKS PDU to the given socket. " alt="" coords="583,157,689,184"/><area shape="rect" id="node9" href="dchat__network_8c.html#a0ace1062fab444c73177e0552e019425" title="Reads a SOCKS response PDU from the given socket. " alt="" coords="583,259,689,285"/><area shape="rect" id="node10" href="dchat__network_8c.html#abd3d58b10c19c6d550b6e6aa86c9dc5c" title="Parses given status and returns its corresponding status message. " alt="" coords="566,309,706,336"/><area shape="rect" id="node12" href="dchat__contact_8c.html#a0de7073d40f7447f933e334054d432d8" title="Resizes the contactlist. " alt="" coords="755,132,883,159"/><area shape="rect" id="node14" href="dchat__contact_8c.html#ac15f4eb395316547db5ceba947a2f3b9" title="Converts a contact into a string. " alt="" coords="757,512,881,539"/><area shape="rect" id="node15" href="dchat__decoder_8c.html#af4aaf258b8866187ed65d6d1c23083cb" title="Converts a PDU to a string that will be written to a file descriptor. " alt="" coords="779,563,859,589"/><area shape="rect" id="node16" href="dchat__decoder_8c.html#ae5745b50cd3cc0aa6228e35d08690fdc" title="Crafts a DChat header string. " alt="" coords="931,563,1045,589"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a0a9fd273c9490e8cf99a08da3cfab690"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int th_new_input </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdchat__conf.html">dchat_conf_t</a> *&#160;</td>
          <td class="paramname"><em>cnf</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Thread function that reads from stdin until the user hits enter. </p>
<p>Waits for new user input on stdin using GNU readline. If the user has entered something, it will be written to the global config pipe <code>user_input</code>. First the length (int) of the string will be written to the pipe and then each byte of the string. On EOF of stdin 0 will be written </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cnf</td><td>Pointer to global config to write to the pipe <code>user_input</code> </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, -1 in case of error </dd></dl>

<p>Definition at line <a class="el" href="dchat_8c_source.html#l00822">822</a> of file <a class="el" href="dchat_8c_source.html">dchat.c</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dchat_8c_a0a9fd273c9490e8cf99a08da3cfab690_cgraph.png" border="0" usemap="#dchat_8c_a0a9fd273c9490e8cf99a08da3cfab690_cgraph" alt=""/></div>
<map name="dchat_8c_a0a9fd273c9490e8cf99a08da3cfab690_cgraph" id="dchat_8c_a0a9fd273c9490e8cf99a08da3cfab690_cgraph">
<area shape="rect" id="node2" href="util_8c.html#acda96afe4e46122c63830a774a5d1e1f" title="Returns the ansi escape code string for bold yellow color. " alt="" coords="155,5,315,32"/><area shape="rect" id="node3" href="util_8c.html#a18901a0772a8dd71781402b41579ec95" title="Returns the ansi escape code string for resetting attributes. " alt="" coords="162,56,307,83"/></map>
</div>
</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dchat_8c.html">dchat.c</a></li>
    <li class="footer">Generated on Thu Jun 26 2014 15:44:00 for DChat by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.7 </li>
  </ul>
</div>
</body>
</html>
