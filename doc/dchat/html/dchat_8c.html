<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.7"/>
<title>DChat: src/dchat.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">DChat
   &#160;<span id="projectnumber">0.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.7 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('dchat_8c.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">dchat.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>This file is the main file for DChat and contains, besides the main function, several core functions.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdint.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;arpa/inet.h&gt;</code><br />
<code>#include &lt;errno.h&gt;</code><br />
<code>#include &lt;libgen.h&gt;</code><br />
<code>#include &lt;netinet/in.h&gt;</code><br />
<code>#include &lt;pthread.h&gt;</code><br />
<code>#include &lt;readline/readline.h&gt;</code><br />
<code>#include &lt;readline/history.h&gt;</code><br />
<code>#include &lt;sys/select.h&gt;</code><br />
<code>#include &lt;sys/socket.h&gt;</code><br />
<code>#include &lt;signal.h&gt;</code><br />
<code>#include &lt;ifaddrs.h&gt;</code><br />
<code>#include &lt;unistd.h&gt;</code><br />
<code>#include &quot;dchat_h/dchat.h&quot;</code><br />
<code>#include &quot;dchat_h/dchat_types.h&quot;</code><br />
<code>#include &quot;dchat_h/dchat_decoder.h&quot;</code><br />
<code>#include &quot;dchat_h/dchat_contact.h&quot;</code><br />
<code>#include &quot;dchat_h/dchat_cmd.h&quot;</code><br />
<code>#include &quot;dchat_h/log.h&quot;</code><br />
<code>#include &quot;dchat_h/util.h&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for dchat.c:</div>
<div class="dyncontent">
<div class="center"><img src="dchat_8c__incl.png" border="0" usemap="#src_2dchat_8c" alt=""/></div>
<map name="src_2dchat_8c" id="src_2dchat_8c">
<area shape="rect" id="node18" href="dchat_8h_source.html" title="dchat_h/dchat.h" alt="" coords="1560,80,1677,107"/><area shape="rect" id="node19" href="dchat__types_8h_source.html" title="dchat_types.h" alt="" coords="1786,155,1891,181"/><area shape="rect" id="node20" href="dchat__decoder_8h_source.html" title="dchat_h/dchat_decoder.h" alt="" coords="1753,80,1924,107"/><area shape="rect" id="node21" href="dchat__contact_8h_source.html" title="dchat_h/dchat_contact.h" alt="" coords="1949,80,2115,107"/><area shape="rect" id="node22" href="dchat__cmd_8h_source.html" title="dchat_h/dchat_cmd.h" alt="" coords="2140,80,2289,107"/><area shape="rect" id="node23" href="log_8h_source.html" title="dchat_h/log.h" alt="" coords="2314,80,2416,107"/><area shape="rect" id="node25" href="util_8h_source.html" title="dchat_h/util.h" alt="" coords="2441,80,2543,107"/></map>
</div>
</div>
<p><a href="dchat_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a3c04138a5bfe5d72780bb7e82a18e627"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a3c04138a5bfe5d72780bb7e82a18e627"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>main</b> (int argc, char **argv)</td></tr>
<tr class="separator:a3c04138a5bfe5d72780bb7e82a18e627"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab456cfb1c47daaa4cede138fd667eb01"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dchat_8c.html#ab456cfb1c47daaa4cede138fd667eb01">init</a> (<a class="el" href="structdchat__conf.html">dchat_conf_t</a> *<a class="el" href="dchat_8c.html#a5497dfcbcfecec06aaf63df011c70f83">cnf</a>, char *interface, int acpt_port, char *nickname)</td></tr>
<tr class="memdesc:ab456cfb1c47daaa4cede138fd667eb01"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes neccessary internal ressources like threads and pipes.  <a href="#ab456cfb1c47daaa4cede138fd667eb01">More...</a><br /></td></tr>
<tr class="separator:ab456cfb1c47daaa4cede138fd667eb01"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2d3e74951e8b1e59cc8cfae2fc510ec7"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dchat_8c.html#a2d3e74951e8b1e59cc8cfae2fc510ec7">init_global_config</a> (<a class="el" href="structdchat__conf.html">dchat_conf_t</a> *<a class="el" href="dchat_8c.html#a5497dfcbcfecec06aaf63df011c70f83">cnf</a>, char *interface, int acpt_port, char *nickname)</td></tr>
<tr class="memdesc:a2d3e74951e8b1e59cc8cfae2fc510ec7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes the global dchat configuration.  <a href="#a2d3e74951e8b1e59cc8cfae2fc510ec7">More...</a><br /></td></tr>
<tr class="separator:a2d3e74951e8b1e59cc8cfae2fc510ec7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a103bc702ed34e7ba88e166b169cfe464"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dchat_8c.html#a103bc702ed34e7ba88e166b169cfe464">destroy</a> (<a class="el" href="structdchat__conf.html">dchat_conf_t</a> *<a class="el" href="dchat_8c.html#a5497dfcbcfecec06aaf63df011c70f83">cnf</a>)</td></tr>
<tr class="memdesc:a103bc702ed34e7ba88e166b169cfe464"><td class="mdescLeft">&#160;</td><td class="mdescRight">Frees all global config resources used.  <a href="#a103bc702ed34e7ba88e166b169cfe464">More...</a><br /></td></tr>
<tr class="separator:a103bc702ed34e7ba88e166b169cfe464"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7fbc5e4f614e5e82b3a1fc5224f1855a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dchat_8c.html#a7fbc5e4f614e5e82b3a1fc5224f1855a">terminate</a> (int sig)</td></tr>
<tr class="memdesc:a7fbc5e4f614e5e82b3a1fc5224f1855a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Signal handler function used for termination.  <a href="#a7fbc5e4f614e5e82b3a1fc5224f1855a">More...</a><br /></td></tr>
<tr class="separator:a7fbc5e4f614e5e82b3a1fc5224f1855a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af26d1f15348f568261ddb15d886dbaff"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dchat_8c.html#af26d1f15348f568261ddb15d886dbaff">handle_local_input</a> (<a class="el" href="structdchat__conf.html">dchat_conf_t</a> *<a class="el" href="dchat_8c.html#a5497dfcbcfecec06aaf63df011c70f83">cnf</a>, char *line)</td></tr>
<tr class="memdesc:af26d1f15348f568261ddb15d886dbaff"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles local user input.  <a href="#af26d1f15348f568261ddb15d886dbaff">More...</a><br /></td></tr>
<tr class="separator:af26d1f15348f568261ddb15d886dbaff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2cbf2aad21d016dd4852369423d86270"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dchat_8c.html#a2cbf2aad21d016dd4852369423d86270">handle_remote_input</a> (<a class="el" href="structdchat__conf.html">dchat_conf_t</a> *<a class="el" href="dchat_8c.html#a5497dfcbcfecec06aaf63df011c70f83">cnf</a>, int n)</td></tr>
<tr class="memdesc:a2cbf2aad21d016dd4852369423d86270"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles PDUs received from a remote client.  <a href="#a2cbf2aad21d016dd4852369423d86270">More...</a><br /></td></tr>
<tr class="separator:a2cbf2aad21d016dd4852369423d86270"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa192202231a392d88dd4c1460b82affe"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dchat_8c.html#aa192202231a392d88dd4c1460b82affe">handle_local_conn_request</a> (<a class="el" href="structdchat__conf.html">dchat_conf_t</a> *<a class="el" href="dchat_8c.html#a5497dfcbcfecec06aaf63df011c70f83">cnf</a>, struct sockaddr_storage *da)</td></tr>
<tr class="memdesc:aa192202231a392d88dd4c1460b82affe"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles local connection requests from the user.  <a href="#aa192202231a392d88dd4c1460b82affe">More...</a><br /></td></tr>
<tr class="separator:aa192202231a392d88dd4c1460b82affe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5c79a63478c0df6d16f70940e53338d1"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dchat_8c.html#a5c79a63478c0df6d16f70940e53338d1">handle_remote_conn_request</a> (<a class="el" href="structdchat__conf.html">dchat_conf_t</a> *<a class="el" href="dchat_8c.html#a5497dfcbcfecec06aaf63df011c70f83">cnf</a>)</td></tr>
<tr class="memdesc:a5c79a63478c0df6d16f70940e53338d1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles connection requests from a remote client.  <a href="#a5c79a63478c0df6d16f70940e53338d1">More...</a><br /></td></tr>
<tr class="separator:a5c79a63478c0df6d16f70940e53338d1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a20c922556a3f5ba773faf2b38fc16750"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dchat_8c.html#a20c922556a3f5ba773faf2b38fc16750">th_new_conn</a> (<a class="el" href="structdchat__conf.html">dchat_conf_t</a> *<a class="el" href="dchat_8c.html#a5497dfcbcfecec06aaf63df011c70f83">cnf</a>)</td></tr>
<tr class="memdesc:a20c922556a3f5ba773faf2b38fc16750"><td class="mdescLeft">&#160;</td><td class="mdescRight">Thread function that reads a socket address from a pipe and connects to this address.  <a href="#a20c922556a3f5ba773faf2b38fc16750">More...</a><br /></td></tr>
<tr class="separator:a20c922556a3f5ba773faf2b38fc16750"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae8472bf8f90c3c69078ec8e8067f52e5"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dchat_8c.html#ae8472bf8f90c3c69078ec8e8067f52e5">th_new_input</a> (<a class="el" href="structdchat__conf.html">dchat_conf_t</a> *<a class="el" href="dchat_8c.html#a5497dfcbcfecec06aaf63df011c70f83">cnf</a>)</td></tr>
<tr class="memdesc:ae8472bf8f90c3c69078ec8e8067f52e5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Thread function that reads from stdin until the user hits enter.  <a href="#ae8472bf8f90c3c69078ec8e8067f52e5">More...</a><br /></td></tr>
<tr class="separator:ae8472bf8f90c3c69078ec8e8067f52e5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad8c1b17ce583581429cb6a0fbc9f5e84"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dchat_8c.html#ad8c1b17ce583581429cb6a0fbc9f5e84">th_main_loop</a> (<a class="el" href="structdchat__conf.html">dchat_conf_t</a> *<a class="el" href="dchat_8c.html#a5497dfcbcfecec06aaf63df011c70f83">cnf</a>)</td></tr>
<tr class="memdesc:ad8c1b17ce583581429cb6a0fbc9f5e84"><td class="mdescLeft">&#160;</td><td class="mdescRight">Main chat loop of this client.  <a href="#ad8c1b17ce583581429cb6a0fbc9f5e84">More...</a><br /></td></tr>
<tr class="separator:ad8c1b17ce583581429cb6a0fbc9f5e84"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2ef30c42cbc289d899a8be5d2d8f77d0"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a2ef30c42cbc289d899a8be5d2d8f77d0"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dchat_8c.html#a2ef30c42cbc289d899a8be5d2d8f77d0">usage</a> ()</td></tr>
<tr class="memdesc:a2ef30c42cbc289d899a8be5d2d8f77d0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prints usage of this program. <br /></td></tr>
<tr class="separator:a2ef30c42cbc289d899a8be5d2d8f77d0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a5497dfcbcfecec06aaf63df011c70f83"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a5497dfcbcfecec06aaf63df011c70f83"></a>
<a class="el" href="structdchat__conf.html">dchat_conf_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dchat_8c.html#a5497dfcbcfecec06aaf63df011c70f83">cnf</a></td></tr>
<tr class="memdesc:a5497dfcbcfecec06aaf63df011c70f83"><td class="mdescLeft">&#160;</td><td class="mdescRight">global dchat configuration structure <br /></td></tr>
<tr class="separator:a5497dfcbcfecec06aaf63df011c70f83"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1a44d9786bbef5722c072846e656cb38"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a1a44d9786bbef5722c072846e656cb38"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dchat_8c.html#a1a44d9786bbef5722c072846e656cb38">ret_exit_</a> = EXIT_SUCCESS</td></tr>
<tr class="memdesc:a1a44d9786bbef5722c072846e656cb38"><td class="mdescLeft">&#160;</td><td class="mdescRight">return value on termination <br /></td></tr>
<tr class="separator:a1a44d9786bbef5722c072846e656cb38"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This file is the main file for DChat and contains, besides the main function, several core functions. </p>
<p>Core functions are:</p>
<p>-) Handler for accepting connections</p>
<p>-) Handler for user input</p>
<p>-) Handler for remote data</p>
<p>-) Handler for file sharing </p>

<p>Definition in file <a class="el" href="dchat_8c_source.html">dchat.c</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a103bc702ed34e7ba88e166b169cfe464"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void destroy </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdchat__conf.html">dchat_conf_t</a> *&#160;</td>
          <td class="paramname"><em>cnf</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Frees all global config resources used. </p>
<p>Closes all open file descriptors, sockets, pipes and mutexes stored within the global config. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cnf</td><td>Global dchat config </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="dchat_8c_source.html#l00370">370</a> of file <a class="el" href="dchat_8c_source.html">dchat.c</a>.</p>

</div>
</div>
<a class="anchor" id="aa192202231a392d88dd4c1460b82affe"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int handle_local_conn_request </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdchat__conf.html">dchat_conf_t</a> *&#160;</td>
          <td class="paramname"><em>cnf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct sockaddr_storage *&#160;</td>
          <td class="paramname"><em>da</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handles local connection requests from the user. </p>
<p>Connects to the remote client with the given socket address, who will be added as contact. This new contact will be sent that all of our known contacts as specified in the DChat protocol. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cnf</td><td>Pointer to global configuration holding the contactlist </td></tr>
    <tr><td class="paramname">da</td><td>Destination address to connect to </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The index where the contact has been added in the contactlist, -1 on error </dd></dl>

<p>Definition at line <a class="el" href="dchat_8c_source.html#l00631">631</a> of file <a class="el" href="dchat_8c_source.html">dchat.c</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dchat_8c_aa192202231a392d88dd4c1460b82affe_cgraph.png" border="0" usemap="#dchat_8c_aa192202231a392d88dd4c1460b82affe_cgraph" alt=""/></div>
<map name="dchat_8c_aa192202231a392d88dd4c1460b82affe_cgraph" id="dchat_8c_aa192202231a392d88dd4c1460b82affe_cgraph">
<area shape="rect" id="node2" href="util_8c.html#a77de9c9eb5a8ea2a6da108270bd7417e" title="Connects to a remote socket using the given socket address. " alt="" coords="251,5,338,32"/><area shape="rect" id="node3" href="log_8c.html#a447124894e44d19ff906633927930c19" title="Log a message together with a string representation of errno as error. " alt="" coords="422,5,501,32"/><area shape="rect" id="node5" href="dchat__contact_8c.html#a1440cfddd2b95761ff972d50e0e0f2c6" title="Adds a new contact to the local contactlist. " alt="" coords="247,107,342,133"/><area shape="rect" id="node7" href="util_8c.html#a279f65250f814269adbaadf7f94680c5" title="Determines the address family of the given socket address structure. " alt="" coords="589,233,672,260"/><area shape="rect" id="node8" href="dchat__contact_8c.html#a625b0742c9e1cbd35146d35ecbf25282" title="Sends local contactlist to a contact. " alt="" coords="241,157,349,184"/><area shape="rect" id="node4" href="log_8c.html#a021b18b681712d42cb07c99171691a84" title="Log a message. " alt="" coords="595,107,667,133"/><area shape="rect" id="node6" href="dchat__contact_8c.html#a0de7073d40f7447f933e334054d432d8" title="Resizes the contactlist. " alt="" coords="397,56,525,83"/><area shape="rect" id="node9" href="dchat__contact_8c.html#ac15f4eb395316547db5ceba947a2f3b9" title="Converts a contact into a string. " alt="" coords="399,208,523,235"/><area shape="rect" id="node10" href="dchat__decoder_8c.html#af4aaf258b8866187ed65d6d1c23083cb" title="Converts a PDU to a string that will be written to a file descriptor. " alt="" coords="421,157,501,184"/><area shape="rect" id="node11" href="dchat__decoder_8c.html#ae5745b50cd3cc0aa6228e35d08690fdc" title="Crafts a DChat header string. " alt="" coords="573,157,688,184"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="af26d1f15348f568261ddb15d886dbaff"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int handle_local_input </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdchat__conf.html">dchat_conf_t</a> *&#160;</td>
          <td class="paramname"><em>cnf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>line</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handles local user input. </p>
<p>Interpretes the given line and reacts correspondently to it. If the line is a command it will be executed, otherwise it will be treated as text message and send to all known contacts stored in the contactlist in the global configuration. </p><dl class="section see"><dt>See also</dt><dd><a class="el" href="dchat__decoder_8c.html#af4aaf258b8866187ed65d6d1c23083cb" title="Converts a PDU to a string that will be written to a file descriptor. ">write_pdu()</a> </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cnf</td><td>Pointer to global configuration </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>-2 on warning, -1 on error, 0 on success </dd></dl>

<p>Definition at line <a class="el" href="dchat_8c_source.html#l00432">432</a> of file <a class="el" href="dchat_8c_source.html">dchat.c</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dchat_8c_af26d1f15348f568261ddb15d886dbaff_cgraph.png" border="0" usemap="#dchat_8c_af26d1f15348f568261ddb15d886dbaff_cgraph" alt=""/></div>
<map name="dchat_8c_af26d1f15348f568261ddb15d886dbaff_cgraph" id="dchat_8c_af26d1f15348f568261ddb15d886dbaff_cgraph">
<area shape="rect" id="node2" href="dchat__cmd_8c.html#a02a55875d8dace649fd51091f9a4dc0b" title="Parses the given string and executes it if it is a command. " alt="" coords="187,107,275,133"/><area shape="rect" id="node4" href="log_8c.html#a021b18b681712d42cb07c99171691a84" title="Log a message. " alt="" coords="520,183,592,209"/><area shape="rect" id="node8" href="log_8c.html#a447124894e44d19ff906633927930c19" title="Log a message together with a string representation of errno as error. " alt="" coords="191,259,270,285"/><area shape="rect" id="node9" href="dchat__decoder_8c.html#af4aaf258b8866187ed65d6d1c23083cb" title="Converts a PDU to a string that will be written to a file descriptor. " alt="" coords="191,309,271,336"/><area shape="rect" id="node3" href="dchat__cmd_8c.html#a704170b8cd6bd8927f648bdcb7510452" title="In&#45;chat command to establish a new connection. " alt="" coords="323,5,466,32"/><area shape="rect" id="node5" href="dchat__cmd_8c.html#a69b01cf50ab64d9d015318477cbe11c1" title="In&#45;chat command to show all available commands. " alt="" coords="335,157,455,184"/><area shape="rect" id="node6" href="dchat__cmd_8c.html#a2a8ff695818e8d48087afa6b9fe27e14" title="In&#45;chat command to list contacts of local contactlist. " alt="" coords="339,56,451,83"/><area shape="rect" id="node7" href="util_8c.html#a279f65250f814269adbaadf7f94680c5" title="Determines the address family of the given socket address structure. " alt="" coords="515,56,597,83"/><area shape="rect" id="node10" href="dchat__decoder_8c.html#ae5745b50cd3cc0aa6228e35d08690fdc" title="Crafts a DChat header string. " alt="" coords="337,360,452,387"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a5c79a63478c0df6d16f70940e53338d1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int handle_remote_conn_request </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdchat__conf.html">dchat_conf_t</a> *&#160;</td>
          <td class="paramname"><em>cnf</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handles connection requests from a remote client. </p>
<p>Accepts a connection from a remote client and so that a new TCP connection will be established between this and the remote client. Moreover the remote client will be added as new contact in the contactlist. </p><dl class="section see"><dt>See also</dt><dd><a class="el" href="dchat__contact_8c.html#a1440cfddd2b95761ff972d50e0e0f2c6" title="Adds a new contact to the local contactlist. ">add_contact()</a> </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cnf</td><td>Pointer to global configuration </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>return value of function add_contact, or -1 on error </dd></dl>

<p>Definition at line <a class="el" href="dchat_8c_source.html#l00684">684</a> of file <a class="el" href="dchat_8c_source.html">dchat.c</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dchat_8c_a5c79a63478c0df6d16f70940e53338d1_cgraph.png" border="0" usemap="#dchat_8c_a5c79a63478c0df6d16f70940e53338d1_cgraph" alt=""/></div>
<map name="dchat_8c_a5c79a63478c0df6d16f70940e53338d1_cgraph" id="dchat_8c_a5c79a63478c0df6d16f70940e53338d1_cgraph">
<area shape="rect" id="node2" href="log_8c.html#a447124894e44d19ff906633927930c19" title="Log a message together with a string representation of errno as error. " alt="" coords="369,5,447,32"/><area shape="rect" id="node3" href="log_8c.html#a021b18b681712d42cb07c99171691a84" title="Log a message. " alt="" coords="520,56,592,83"/><area shape="rect" id="node4" href="dchat__contact_8c.html#a1440cfddd2b95761ff972d50e0e0f2c6" title="Adds a new contact to the local contactlist. " alt="" coords="201,107,295,133"/><area shape="rect" id="node5" href="dchat__contact_8c.html#a0de7073d40f7447f933e334054d432d8" title="Resizes the contactlist. " alt="" coords="344,107,472,133"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a2cbf2aad21d016dd4852369423d86270"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int handle_remote_input </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdchat__conf.html">dchat_conf_t</a> *&#160;</td>
          <td class="paramname"><em>cnf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>n</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handles PDUs received from a remote client. </p>
<p>Reads in a PDU from a certain contact file descriptor and interpretes its headers and handles its content. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cnf</td><td>Pointer to global configuration holding the contactlist </td></tr>
    <tr><td class="paramname">n</td><td>Index of contact in the respective contactlist </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>length of bytes read, 0 on EOF or -1 in case of error </dd></dl>

<p>Definition at line <a class="el" href="dchat_8c_source.html#l00507">507</a> of file <a class="el" href="dchat_8c_source.html">dchat.c</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dchat_8c_a2cbf2aad21d016dd4852369423d86270_cgraph.png" border="0" usemap="#dchat_8c_a2cbf2aad21d016dd4852369423d86270_cgraph" alt=""/></div>
<map name="dchat_8c_a2cbf2aad21d016dd4852369423d86270_cgraph" id="dchat_8c_a2cbf2aad21d016dd4852369423d86270_cgraph">
<area shape="rect" id="node2" href="dchat__decoder_8c.html#ae0ceb4d749dc162f86d73d4f08ed5fa4" title="Read a whole DChat PDU from a file descriptor. " alt="" coords="425,69,503,96"/><area shape="rect" id="node3" href="log_8c.html#a447124894e44d19ff906633927930c19" title="Log a message together with a string representation of errno as error. " alt="" coords="793,183,871,209"/><area shape="rect" id="node4" href="log_8c.html#a021b18b681712d42cb07c99171691a84" title="Log a message. " alt="" coords="965,512,1037,539"/><area shape="rect" id="node7" href="dchat__decoder_8c.html#ade270b4d1100adbdffbb22fdd5635737" title="Frees all resources dynamically allocated for a PDU structure. " alt="" coords="224,563,299,589"/><area shape="rect" id="node8" href="util_8c.html#ac6b338a9b634516fb1535404d12ba9c6" title="Prints a chat message to a file descriptor. " alt="" coords="201,765,321,792"/><area shape="rect" id="node11" href="dchat__contact_8c.html#aa0681254b16e6d20d63a03aed84c12e2" title="Checks the local contactlist for duplicates. " alt="" coords="402,715,526,741"/><area shape="rect" id="node15" href="dchat__contact_8c.html#a56a9992b188f855108c72588953fe8a6" title="Deletes a contact from the local contactlist. " alt="" coords="617,360,708,387"/><area shape="rect" id="node17" href="dchat__contact_8c.html#a2161fbd1e0fc61c762f08bb102e54ab8" title="Contacts transferred via PDU will be added to the contactlist. " alt="" coords="200,461,323,488"/><area shape="rect" id="node5" href="dchat__decoder_8c.html#a9a4f2d2d79d140c5d1bcb5be3bc82e0e" title="Read a line terminated with \n from a file descriptor. " alt="" coords="624,56,701,83"/><area shape="rect" id="node6" href="dchat__decoder_8c.html#acdc394373c1cbcfa66f99a9a4579e5c8" title="Decodes a string into a DChat header. " alt="" coords="605,5,720,32"/><area shape="rect" id="node9" href="util_8c.html#a9b2b1cd61b591b14b2abf2cedb0cac30" title="Prints the ansi escape code for clearing the current line in a terminal. " alt="" coords="391,765,537,792"/><area shape="rect" id="node10" href="util_8c.html#a50e43a9ed79e266413404db5c414b92c" title="Prints the ansi escape code for carriage return in a terminal. " alt="" coords="415,816,513,843"/><area shape="rect" id="node12" href="dchat__contact_8c.html#a01eb319ee1d229714b6a20e144181a1a" title="Searches a contact in the local contactlist. " alt="" coords="616,765,709,792"/><area shape="rect" id="node14" href="util_8c.html#a279f65250f814269adbaadf7f94680c5" title="Determines the address family of the given socket address structure. " alt="" coords="960,816,1043,843"/><area shape="rect" id="node13" href="dchat__contact_8c.html#ac15f4eb395316547db5ceba947a2f3b9" title="Converts a contact into a string. " alt="" coords="770,765,894,792"/><area shape="rect" id="node16" href="dchat__contact_8c.html#a0de7073d40f7447f933e334054d432d8" title="Resizes the contactlist. " alt="" coords="768,411,896,437"/><area shape="rect" id="node18" href="dchat__decoder_8c.html#ab4502d6fa3578ce5f3b4a92e5489c978" title="Extracts a fraction of the content. " alt="" coords="771,563,893,589"/><area shape="rect" id="node19" href="dchat__contact_8c.html#a5fc6d1fda23da9c12247773139cc9c74" title="Converts a string into a contact. " alt="" coords="770,461,894,488"/><area shape="rect" id="node20" href="dchat_8c.html#aa192202231a392d88dd4c1460b82affe" title="Handles local connection requests from the user. " alt="" coords="371,411,557,437"/><area shape="rect" id="node21" href="util_8c.html#a77de9c9eb5a8ea2a6da108270bd7417e" title="Connects to a remote socket using the given socket address. " alt="" coords="619,208,706,235"/><area shape="rect" id="node22" href="dchat__contact_8c.html#a1440cfddd2b95761ff972d50e0e0f2c6" title="Adds a new contact to the local contactlist. " alt="" coords="615,411,710,437"/><area shape="rect" id="node23" href="dchat__contact_8c.html#a625b0742c9e1cbd35146d35ecbf25282" title="Sends local contactlist to a contact. " alt="" coords="609,613,717,640"/><area shape="rect" id="node24" href="dchat__decoder_8c.html#af4aaf258b8866187ed65d6d1c23083cb" title="Converts a PDU to a string that will be written to a file descriptor. " alt="" coords="792,715,872,741"/><area shape="rect" id="node25" href="dchat__decoder_8c.html#ae5745b50cd3cc0aa6228e35d08690fdc" title="Crafts a DChat header string. " alt="" coords="944,715,1059,741"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ab456cfb1c47daaa4cede138fd667eb01"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdchat__conf.html">dchat_conf_t</a> *&#160;</td>
          <td class="paramname"><em>cnf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>interface</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>acpt_port</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>nickname</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes neccessary internal ressources like threads and pipes. </p>
<p>Initializes pipes and threads used for parallel processing of user input and and handling data from a remote client. Furtermore the global config gets initialized with the listening socket, nickname and other basic things. </p><dl class="section see"><dt>See also</dt><dd><a class="el" href="dchat_8c.html#a2d3e74951e8b1e59cc8cfae2fc510ec7" title="Initializes the global dchat configuration. ">init_global_config()</a> </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cnf</td><td>The global dchat config </td></tr>
    <tr><td class="paramname">interface</td><td>Interface to bind to (e.g. eth0) </td></tr>
    <tr><td class="paramname">acpt_port</td><td>Local listening port </td></tr>
    <tr><td class="paramname">nickname</td><td>Nickname used for chatting </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on successful initialization, -1 in case of error </dd></dl>

<p>Definition at line <a class="el" href="dchat_8c_source.html#l00146">146</a> of file <a class="el" href="dchat_8c_source.html">dchat.c</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dchat_8c_ab456cfb1c47daaa4cede138fd667eb01_cgraph.png" border="0" usemap="#dchat_8c_ab456cfb1c47daaa4cede138fd667eb01_cgraph" alt=""/></div>
<map name="dchat_8c_ab456cfb1c47daaa4cede138fd667eb01_cgraph" id="dchat_8c_ab456cfb1c47daaa4cede138fd667eb01_cgraph">
<area shape="rect" id="node2" href="dchat_8c.html#a7fbc5e4f614e5e82b3a1fc5224f1855a" title="Signal handler function used for termination. " alt="" coords="105,140,183,167"/><area shape="rect" id="node6" href="log_8c.html#a021b18b681712d42cb07c99171691a84" title="Log a message. " alt="" coords="848,242,920,268"/><area shape="rect" id="node7" href="dchat_8c.html#a2d3e74951e8b1e59cc8cfae2fc510ec7" title="Initializes the global dchat configuration. " alt="" coords="477,267,603,294"/><area shape="rect" id="node8" href="log_8c.html#a447124894e44d19ff906633927930c19" title="Log a message together with a string representation of errno as error. " alt="" coords="675,394,754,420"/><area shape="rect" id="node10" href="dchat_8c.html#a20c922556a3f5ba773faf2b38fc16750" title="Thread function that reads a socket address from a pipe and connects to this address. " alt="" coords="93,419,195,446"/><area shape="rect" id="node19" href="dchat_8c.html#ae8472bf8f90c3c69078ec8e8067f52e5" title="Thread function that reads from stdin until the user hits enter. " alt="" coords="93,571,195,598"/><area shape="rect" id="node3" href="dchat_8c.html#a103bc702ed34e7ba88e166b169cfe464" title="Frees all global config resources used. " alt="" coords="303,64,369,91"/><area shape="rect" id="node4" href="util_8c.html#a9b2b1cd61b591b14b2abf2cedb0cac30" title="Prints the ansi escape code for clearing the current line in a terminal. " alt="" coords="263,115,409,142"/><area shape="rect" id="node5" href="util_8c.html#a50e43a9ed79e266413404db5c414b92c" title="Prints the ansi escape code for carriage return in a terminal. " alt="" coords="287,166,385,192"/><area shape="rect" id="node9" href="util_8c.html#a279f65250f814269adbaadf7f94680c5" title="Determines the address family of the given socket address structure. " alt="" coords="843,14,925,40"/><area shape="rect" id="node11" href="dchat_8c.html#aa192202231a392d88dd4c1460b82affe" title="Handles local connection requests from the user. " alt="" coords="243,356,429,383"/><area shape="rect" id="node12" href="util_8c.html#a77de9c9eb5a8ea2a6da108270bd7417e" title="Connects to a remote socket using the given socket address. " alt="" coords="497,368,583,395"/><area shape="rect" id="node13" href="dchat__contact_8c.html#a1440cfddd2b95761ff972d50e0e0f2c6" title="Adds a new contact to the local contactlist. " alt="" coords="493,318,587,344"/><area shape="rect" id="node15" href="dchat__contact_8c.html#a625b0742c9e1cbd35146d35ecbf25282" title="Sends local contactlist to a contact. " alt="" coords="486,140,594,167"/><area shape="rect" id="node14" href="dchat__contact_8c.html#a0de7073d40f7447f933e334054d432d8" title="Resizes the contactlist. " alt="" coords="651,318,779,344"/><area shape="rect" id="node16" href="dchat__contact_8c.html#ac15f4eb395316547db5ceba947a2f3b9" title="Converts a contact into a string. " alt="" coords="653,64,777,91"/><area shape="rect" id="node17" href="dchat__decoder_8c.html#af4aaf258b8866187ed65d6d1c23083cb" title="Converts a PDU to a string that will be written to a file descriptor. " alt="" coords="675,115,755,142"/><area shape="rect" id="node18" href="dchat__decoder_8c.html#ae5745b50cd3cc0aa6228e35d08690fdc" title="Crafts a DChat header string. " alt="" coords="827,115,941,142"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a2d3e74951e8b1e59cc8cfae2fc510ec7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int init_global_config </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdchat__conf.html">dchat_conf_t</a> *&#160;</td>
          <td class="paramname"><em>cnf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>interface</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>acpt_port</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>nickname</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes the global dchat configuration. </p>
<p>Binds to a network interface, creates a listening socket for this interface and the given port and sets the nickname. All configuration settings will be stored in the global config. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cnf</td><td>Pointer to global configuration structure </td></tr>
    <tr><td class="paramname">interface</td><td>Network interface to bind to </td></tr>
    <tr><td class="paramname">acpt_port</td><td>Port to bind to and listen for incoming connetion requests </td></tr>
    <tr><td class="paramname">nickname</td><td>Nickname used for this chat session </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>socket descriptor or -1 if an error occurs </dd></dl>

<p>Definition at line <a class="el" href="dchat_8c_source.html#l00230">230</a> of file <a class="el" href="dchat_8c_source.html">dchat.c</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dchat_8c_a2d3e74951e8b1e59cc8cfae2fc510ec7_cgraph.png" border="0" usemap="#dchat_8c_a2d3e74951e8b1e59cc8cfae2fc510ec7_cgraph" alt=""/></div>
<map name="dchat_8c_a2d3e74951e8b1e59cc8cfae2fc510ec7_cgraph" id="dchat_8c_a2d3e74951e8b1e59cc8cfae2fc510ec7_cgraph">
<area shape="rect" id="node2" href="log_8c.html#a447124894e44d19ff906633927930c19" title="Log a message together with a string representation of errno as error. " alt="" coords="181,5,259,32"/><area shape="rect" id="node3" href="log_8c.html#a021b18b681712d42cb07c99171691a84" title="Log a message. " alt="" coords="309,31,381,57"/><area shape="rect" id="node4" href="util_8c.html#a279f65250f814269adbaadf7f94680c5" title="Determines the address family of the given socket address structure. " alt="" coords="179,107,261,133"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a7fbc5e4f614e5e82b3a1fc5224f1855a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void terminate </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>sig</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Signal handler function used for termination. </p>
<p>Signal handler function that will free all used resources like file descriptors, pipes, etc... and that terminates this process afterwards. This function will be called whenever this program should terminate (e.g SIGTERM, SIGQUIT, ...) or on EOF of stdin. Exit status of the process will be 0 on success, or a non-zero value in case of error. </p><dl class="section see"><dt>See also</dt><dd><a class="el" href="dchat_8c.html#a103bc702ed34e7ba88e166b169cfe464" title="Frees all global config resources used. ">destroy()</a> </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sig</td><td>Type of signal (e.g SIGTERM, SIGQUIT, ...) </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="dchat_8c_source.html#l00408">408</a> of file <a class="el" href="dchat_8c_source.html">dchat.c</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dchat_8c_a7fbc5e4f614e5e82b3a1fc5224f1855a_cgraph.png" border="0" usemap="#dchat_8c_a7fbc5e4f614e5e82b3a1fc5224f1855a_cgraph" alt=""/></div>
<map name="dchat_8c_a7fbc5e4f614e5e82b3a1fc5224f1855a_cgraph" id="dchat_8c_a7fbc5e4f614e5e82b3a1fc5224f1855a_cgraph">
<area shape="rect" id="node2" href="dchat_8c.html#a103bc702ed34e7ba88e166b169cfe464" title="Frees all global config resources used. " alt="" coords="171,5,237,32"/><area shape="rect" id="node3" href="util_8c.html#a9b2b1cd61b591b14b2abf2cedb0cac30" title="Prints the ansi escape code for clearing the current line in a terminal. " alt="" coords="131,56,277,83"/><area shape="rect" id="node4" href="util_8c.html#a50e43a9ed79e266413404db5c414b92c" title="Prints the ansi escape code for carriage return in a terminal. " alt="" coords="155,107,253,133"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ad8c1b17ce583581429cb6a0fbc9f5e84"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int th_main_loop </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdchat__conf.html">dchat_conf_t</a> *&#160;</td>
          <td class="paramname"><em>cnf</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Main chat loop of this client. </p>
<p>This function is the main loop of DChat that selects(2) certain file descriptors stored in the global configuration to read from. It waits for local userinput, PDUs from remote clients, local connection requests and remote connection requests. If select returns and a file descriptor can be read, this function will take action depending on which file descriptor is able to read from. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cnf</td><td>Pointer to global config holding all kind of file descriptors </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 or -1 in case of error </dd></dl>

<p>Definition at line <a class="el" href="dchat_8c_source.html#l00838">838</a> of file <a class="el" href="dchat_8c_source.html">dchat.c</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dchat_8c_ad8c1b17ce583581429cb6a0fbc9f5e84_cgraph.png" border="0" usemap="#dchat_8c_ad8c1b17ce583581429cb6a0fbc9f5e84_cgraph" alt=""/></div>
<map name="dchat_8c_ad8c1b17ce583581429cb6a0fbc9f5e84_cgraph" id="dchat_8c_ad8c1b17ce583581429cb6a0fbc9f5e84_cgraph">
<area shape="rect" id="node2" href="util_8c.html#af082905f7eac6d03e92015146bbc1925" title="Define the maximum of two given integers. " alt="" coords="207,302,254,329"/><area shape="rect" id="node3" href="log_8c.html#a447124894e44d19ff906633927930c19" title="Log a message together with a string representation of errno as error. " alt="" coords="961,783,1039,810"/><area shape="rect" id="node5" href="dchat_8c.html#af26d1f15348f568261ddb15d886dbaff" title="Handles local user input. " alt="" coords="549,454,683,481"/><area shape="rect" id="node13" href="dchat_8c.html#a5c79a63478c0df6d16f70940e53338d1" title="Handles connection requests from a remote client. " alt="" coords="543,1139,689,1180"/><area shape="rect" id="node16" href="dchat__contact_8c.html#a625b0742c9e1cbd35146d35ecbf25282" title="Sends local contactlist to a contact. " alt="" coords="765,175,873,202"/><area shape="rect" id="node18" href="dchat_8c.html#a2cbf2aad21d016dd4852369423d86270" title="Handles PDUs received from a remote client. " alt="" coords="157,873,304,899"/><area shape="rect" id="node28" href="dchat__contact_8c.html#a56a9992b188f855108c72588953fe8a6" title="Deletes a contact from the local contactlist. " alt="" coords="368,1230,459,1257"/><area shape="rect" id="node4" href="log_8c.html#a021b18b681712d42cb07c99171691a84" title="Log a message. " alt="" coords="1141,505,1213,531"/><area shape="rect" id="node6" href="dchat__cmd_8c.html#a02a55875d8dace649fd51091f9a4dc0b" title="Parses the given string and executes it if it is a command. " alt="" coords="775,327,863,354"/><area shape="rect" id="node11" href="dchat__decoder_8c.html#af4aaf258b8866187ed65d6d1c23083cb" title="Converts a PDU to a string that will be written to a file descriptor. " alt="" coords="960,125,1040,151"/><area shape="rect" id="node7" href="dchat__cmd_8c.html#a704170b8cd6bd8927f648bdcb7510452" title="In&#45;chat command to establish a new connection. " alt="" coords="929,226,1071,253"/><area shape="rect" id="node8" href="dchat__cmd_8c.html#a69b01cf50ab64d9d015318477cbe11c1" title="In&#45;chat command to show all available commands. " alt="" coords="940,327,1060,354"/><area shape="rect" id="node9" href="dchat__cmd_8c.html#a2a8ff695818e8d48087afa6b9fe27e14" title="In&#45;chat command to list contacts of local contactlist. " alt="" coords="944,277,1056,303"/><area shape="rect" id="node10" href="util_8c.html#a279f65250f814269adbaadf7f94680c5" title="Determines the address family of the given socket address structure. " alt="" coords="1136,49,1219,75"/><area shape="rect" id="node12" href="dchat__decoder_8c.html#ae5745b50cd3cc0aa6228e35d08690fdc" title="Crafts a DChat header string. " alt="" coords="1120,125,1235,151"/><area shape="rect" id="node14" href="dchat__contact_8c.html#a1440cfddd2b95761ff972d50e0e0f2c6" title="Adds a new contact to the local contactlist. " alt="" coords="771,1189,866,1215"/><area shape="rect" id="node15" href="dchat__contact_8c.html#a0de7073d40f7447f933e334054d432d8" title="Resizes the contactlist. " alt="" coords="936,1189,1064,1215"/><area shape="rect" id="node17" href="dchat__contact_8c.html#ac15f4eb395316547db5ceba947a2f3b9" title="Converts a contact into a string. " alt="" coords="938,74,1062,101"/><area shape="rect" id="node19" href="dchat__decoder_8c.html#ae0ceb4d749dc162f86d73d4f08ed5fa4" title="Read a whole DChat PDU from a file descriptor. " alt="" coords="577,923,655,950"/><area shape="rect" id="node22" href="dchat__decoder_8c.html#ade270b4d1100adbdffbb22fdd5635737" title="Frees all resources dynamically allocated for a PDU structure. " alt="" coords="376,822,451,849"/><area shape="rect" id="node23" href="util_8c.html#ac6b338a9b634516fb1535404d12ba9c6" title="Prints a chat message to a file descriptor. " alt="" coords="353,974,473,1001"/><area shape="rect" id="node26" href="dchat__contact_8c.html#aa0681254b16e6d20d63a03aed84c12e2" title="Checks the local contactlist for duplicates. " alt="" coords="554,163,678,190"/><area shape="rect" id="node29" href="dchat__contact_8c.html#a2161fbd1e0fc61c762f08bb102e54ab8" title="Contacts transferred via PDU will be added to the contactlist. " alt="" coords="352,625,475,651"/><area shape="rect" id="node20" href="dchat__decoder_8c.html#a9a4f2d2d79d140c5d1bcb5be3bc82e0e" title="Read a line terminated with \n from a file descriptor. " alt="" coords="780,986,857,1013"/><area shape="rect" id="node21" href="dchat__decoder_8c.html#acdc394373c1cbcfa66f99a9a4579e5c8" title="Decodes a string into a DChat header. " alt="" coords="761,885,876,911"/><area shape="rect" id="node24" href="util_8c.html#a9b2b1cd61b591b14b2abf2cedb0cac30" title="Prints the ansi escape code for clearing the current line in a terminal. " alt="" coords="543,1025,689,1051"/><area shape="rect" id="node25" href="util_8c.html#a50e43a9ed79e266413404db5c414b92c" title="Prints the ansi escape code for carriage return in a terminal. " alt="" coords="567,974,665,1001"/><area shape="rect" id="node27" href="dchat__contact_8c.html#a01eb319ee1d229714b6a20e144181a1a" title="Searches a contact in the local contactlist. " alt="" coords="772,23,865,50"/><area shape="rect" id="node30" href="dchat__decoder_8c.html#ab4502d6fa3578ce5f3b4a92e5489c978" title="Extracts a fraction of the content. " alt="" coords="757,631,880,658"/><area shape="rect" id="node31" href="dchat__contact_8c.html#a5fc6d1fda23da9c12247773139cc9c74" title="Converts a string into a contact. " alt="" coords="938,530,1062,557"/><area shape="rect" id="node32" href="dchat_8c.html#aa192202231a392d88dd4c1460b82affe" title="Handles local connection requests from the user. " alt="" coords="523,682,709,709"/><area shape="rect" id="node33" href="util_8c.html#a77de9c9eb5a8ea2a6da108270bd7417e" title="Connects to a remote socket using the given socket address. " alt="" coords="775,733,862,759"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a20c922556a3f5ba773faf2b38fc16750"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* th_new_conn </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdchat__conf.html">dchat_conf_t</a> *&#160;</td>
          <td class="paramname"><em>cnf</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Thread function that reads a socket address from a pipe and connects to this address. </p>
<p>Establishes new connections to the given addresses read from the global config pipe <code>connect_fd</code>. It reads a sockaddr_storage structure and then connects to this socket address. If a connection has been established successfully, a new contact will be added and our contactlist will be sent to him. Furthermore the character '1' will be written to the global config pipe <code>cl_change</code>. </p><dl class="section see"><dt>See also</dt><dd><a class="el" href="dchat_8c.html#aa192202231a392d88dd4c1460b82affe" title="Handles local connection requests from the user. ">handle_local_conn_request()</a> </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cnf</td><td>Pointer to global config to read from the pipe connect_fd` </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="dchat_8c_source.html#l00723">723</a> of file <a class="el" href="dchat_8c_source.html">dchat.c</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="dchat_8c_a20c922556a3f5ba773faf2b38fc16750_cgraph.png" border="0" usemap="#dchat_8c_a20c922556a3f5ba773faf2b38fc16750_cgraph" alt=""/></div>
<map name="dchat_8c_a20c922556a3f5ba773faf2b38fc16750_cgraph" id="dchat_8c_a20c922556a3f5ba773faf2b38fc16750_cgraph">
<area shape="rect" id="node2" href="log_8c.html#a021b18b681712d42cb07c99171691a84" title="Log a message. " alt="" coords="744,157,816,184"/><area shape="rect" id="node3" href="dchat_8c.html#aa192202231a392d88dd4c1460b82affe" title="Handles local connection requests from the user. " alt="" coords="155,157,341,184"/><area shape="rect" id="node5" href="log_8c.html#a447124894e44d19ff906633927930c19" title="Log a message together with a string representation of errno as error. " alt="" coords="571,233,650,260"/><area shape="rect" id="node4" href="util_8c.html#a77de9c9eb5a8ea2a6da108270bd7417e" title="Connects to a remote socket using the given socket address. " alt="" coords="401,183,487,209"/><area shape="rect" id="node6" href="dchat__contact_8c.html#a1440cfddd2b95761ff972d50e0e0f2c6" title="Adds a new contact to the local contactlist. " alt="" coords="397,132,491,159"/><area shape="rect" id="node8" href="util_8c.html#a279f65250f814269adbaadf7f94680c5" title="Determines the address family of the given socket address structure. " alt="" coords="739,5,821,32"/><area shape="rect" id="node9" href="dchat__contact_8c.html#a625b0742c9e1cbd35146d35ecbf25282" title="Sends local contactlist to a contact. " alt="" coords="390,81,498,108"/><area shape="rect" id="node7" href="dchat__contact_8c.html#a0de7073d40f7447f933e334054d432d8" title="Resizes the contactlist. " alt="" coords="547,183,675,209"/><area shape="rect" id="node10" href="dchat__contact_8c.html#ac15f4eb395316547db5ceba947a2f3b9" title="Converts a contact into a string. " alt="" coords="549,31,673,57"/><area shape="rect" id="node11" href="dchat__decoder_8c.html#af4aaf258b8866187ed65d6d1c23083cb" title="Converts a PDU to a string that will be written to a file descriptor. " alt="" coords="571,81,651,108"/><area shape="rect" id="node12" href="dchat__decoder_8c.html#ae5745b50cd3cc0aa6228e35d08690fdc" title="Crafts a DChat header string. " alt="" coords="723,81,837,108"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ae8472bf8f90c3c69078ec8e8067f52e5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* th_new_input </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdchat__conf.html">dchat_conf_t</a> *&#160;</td>
          <td class="paramname"><em>cnf</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Thread function that reads from stdin until the user hits enter. </p>
<p>Waits for new user input on stdin using GNU readline. If the user has entered something, it will be written to the global config pipe <code>user_input</code>. First the length (int) of the string will be written to the pipe and then each byte of the string. On EOF of stdin 0 will be written </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cnf</td><td>Pointer to global config to write to the pipe <code>user_input</code> </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="dchat_8c_source.html#l00775">775</a> of file <a class="el" href="dchat_8c_source.html">dchat.c</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dchat_8c.html">dchat.c</a></li>
    <li class="footer">Generated on Wed Jun 18 2014 11:15:39 for DChat by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.7 </li>
  </ul>
</div>
</body>
</html>
